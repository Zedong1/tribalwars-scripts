/*! Relaxeaza Tribal Wars Advanced v1.3.1 | 24/02/12. */
(function(){var l=game_data.player.id+"relaxeazaTWAdvanced",m=eval("("+localStorage[l]+")");(function(){if($.isPlainObject(m)){if(m.data||m._data&&"1.3.1"!=m._data.version)return!0}else return!0;return!1})()&&(localStorage[l]=JSON.stringify({mapPlayers:!0,mapPlayersMin:0,mapPlayersMax:1E3,profileCoords:!0,profileCoordsMin:0,profileCoordsMax:12500,mapAbandoneds:!0,mapAbandonedsMin:0,mapAbandonedsMax:12500,mapIdentify:!0,mapManual:!0,lastAttack:!0,rankingGraphic:!0,allyGraphic:!0,profileStats:!0,reportFilter:!0,
villageFilter:!0,reportRename:!0,villageRename:!0,commandRename:!0,troopCounter:!0,mapGenerator:!0,reportCalc:!0,assistentFarm:!0,placeFarm:!1,_placeFarmProtect:!0,_placeFarmReplace:!1,_placeFarmIndex:0,_placeFarmUnits:{},_placeFarmCoords:[],building:!0,_buildingBuild:{main:20,barracks:25,stable:20,garage:10,snob:1,smith:20,place:1,statue:1,market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,wall:20},_buildingDestroy:{main:20,barracks:25,stable:20,garage:10,snob:1,smith:20,place:1,statue:1,
market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,wall:20},_buildingMaxOrders:5,selectVillages:!0,research:!0,_data:{builds:{},world:{},units:{},version:"1.3.1"}}));var a={config:eval("("+localStorage[l]+")"),linkbase:function(a){return game_data.link_base_pure.replace("screen=","screen="+a)},ready:function(d){function b(b){b===c&&(h&&(localStorage[l]=JSON.stringify(a.config)),d())}var c=0,e=0,h=!1;if($.isEmptyObject(a.config._data.builds)){c++;var h=!0,f=function(){$.get(a.linkbase("main"),
function(d){if($("#hide_completed:checked",d).length)return $.post($("#hide_completed",d).attr("onclick").toString().split("'")[1],{hide_completed:!1},f);$("#buildings a:has(img)",d).each(function(){a.config._data.builds[$(this).text().trim()]=this.href.match(/\=(\w+)$/)[1]});b(++e)})};f()}$.isEmptyObject(a.config._data.world)&&(c++,h=!0,$.get("interface.php?func=get_config",function(d){$("config > *",d).each(function(d,b){4>d?a.config._data.world[b.nodeName]=$(b).text():$("*",b).each(function(){a.config._data.world[this.nodeName]=
$(this).text()})});b(++e)}));$.isEmptyObject(a.config._data.units)&&(c++,h=!0,$.get("interface.php?func=get_unit_info",function(d){$("config > *",d).each(function(){"militia"!==this.nodeName&&(a.config._data.units[this.nodeName]={speed:60*Math.round(Number($("speed",this).text())),carry:Number($("carry",this).text()),pop:Number($("pop",this).text())})});b(++e)}));b(0)},displayConfig:function(){$("head").append('<style>#di textarea {border:1px solid #999;width:280px;height:80px;font-size:12px}#di input[type="text"],#di select {border:1px solid #999;width:70px;margin:0 2px;font-size:12px}#di button {border:1px solid #999;margin:3px}#di {background:#c1d9ff;border:1px solid #3a5774;font-family:arial;font-size:12px;padding:4px;position:absolute;right:150px;top:150px;z-index:999}#di .di {background:#fff;padding:5px}#di a {color:blue;font-weight:400;text-decoration:underline}#di h1 {background:#e4e4e4;border-bottom:1px solid #c4c4c4;border-top:1px solid #fff;color:#333;font-size:13px;font-weight:700;line-height:20px;margin:0;padding:0 7px}#di p,#di label {margin:3px 0;display:block}#he {background:#e0edfe;cursor:move;font-size:14px;font-weight:700;padding: 4px 20px 4px 10px}</style>');
$("body").append('<div id="di" style="width:400px"><div id="he">Relaxeaza TWAdvanced v1.3</div><div id="co"><h1>Obter Coordenadas</h1><div class="di"><span title="Permite obter coordenadas de aldeias com jogadores no mapa."><input type="checkbox" name="mapPlayers"/> De jogadores.</span> Min: <input name="mapPlayersMin" title="M\u00ednimo de pontos que aldeias com jogadores podem ter." size="3"/> Max: <input name="mapPlayersMax" title="M\u00e1ximo de pontos que aldeias com jogadores podem ter." size="3"/><br/><span title="Permite obter coordenadas de aldeias apartir do perfil de um jogador."><input type="checkbox" name="profileCoords"/> De jogadores (perfil).</span> Min: <input name="profileCoordsMin" title="M\u00ednimo de pontos que aldeias do perfil dos jogadores podem ter." size="3"/> Max: <input name="profileCoordsMax" title="M\u00e1ximo de pontos que aldeias do perfil dos jogadores podem ter." size="3"/><br/><span title="Permite obter coordenadas de aldeias abandonadas no mapa."><input type="checkbox" name="mapAbandoneds"/> De abandonadas.</span> Min: <input name="mapAbandonedsMin" title="M\u00ednimo de pontos que aldeias abandonadas podem ter." size="3"/> Max: <input name="mapAbandonedsMax" title="M\u00e1ximo de pontos que aldeias abandonadas podem ter." size="3"/><br/><label title="Adiciona uma marca\u00e7\u00e3o nas aldeias que foram obtidas coordenadas."><input type="checkbox" name="mapIdentify"/> Identificar ao obter coordenadas</label><label title="Permite obter coordenadas de aldeias no mapa clicando nelas."><input type="checkbox" name="mapManual"/> Obter coordenadas manualmente</label></div><h1>Gr\u00e1ficos & Estat\u00edsticas</h1><div class="di"><label title="Mostra um gr\u00e1fico de pontua\u00e7\u00e3o na classifica\u00e7\u00e3o ao passar o mouse sobre o nome de algum jogador ou tribo."><input type="checkbox" name="rankingGraphic"/> Gr\u00e1fico de pontua\u00e7\u00e3o na classifica\u00e7\u00e3o.</label><label title="Mostra um gr\u00e1fico de pontua\u00e7\u00e3o na p\u00e1gina de membros de uma tribo ao passar o mouse sobre o nome de algum jogador."><input type="checkbox" name="allyGraphic"/> Gr\u00e1fico de pontua\u00e7\u00e3o em membros da tribo.</label><label title="Mostra uma \u00e1rea com v\u00e1rios gr\u00e1ficos de um jogador ou uma tribo no perfil do mesmo."><input type="checkbox" name="profileStats"/> Mostrar estat\u00edsticas de um jogador/tribo no perfil.</label></div><h1>Outras Op\u00e7\u00f5es</h1><div class="di"><label title="Mostra quanto tempo se passou desde o \u00faltimo ataque no mapa."><input type="checkbox" name="lastAttack"/> Mostrar tempo do \u00faltimo ataque no mapa.</label><label title="Mostra um campo de pesquisa por t\u00edtulo na p\u00e1gina de relat\u00f3rios."><input type="checkbox" name="reportFilter"/> Campo de pesquisa nos relat\u00f3rios.</label><label title="Mostra um campo de pesquisa na visualiza\u00e7\u00e3o para pesquisar aldeias por nome."><input type="checkbox" name="villageFilter"/> Pesquisa de aldeias na visualiza\u00e7\u00e3o.</label><label title="Mostra um campo na p\u00e1gina de relat\u00f3rios para renomear todos ou apenas os selecionados."><input type="checkbox" name="reportRename"/> Campo para renomear relat\u00f3rios.</label><label title="Mostra um campo na visualiza\u00e7\u00e3o para renomear todas os comandos de apenas uma vez."><input type="checkbox" name="commandRename"/> Campo para renomear comandos na visualiza\u00e7\u00e3o.</label><label title="Mostra um campo na visualiza\u00e7\u00e3o das aldeias para renomear todas as aldeias de apenas uma vez."><input type="checkbox" name="villageRename"/> Campo para renomear aldeias na visualiza\u00e7\u00e3o.</label><label title="Gera mapas do TW Stats direto da classifica\u00e7\u00e3o permitindo selecionar os jogadores ou tribos que estaram incluidos no mapa."><input type="checkbox" name="mapGenerator"/> Gerar mapa apartir da classific\u00e3o.</label><label title="Faz o calculo da quantidade de recursos que tem atualmente em uma aldeia apartir de um relat\u00f3rio de espionagem e mostra a quantidade de tropas necess\u00e1rias para farmar."><input type="checkbox" name="reportCalc"/> Calcula recursos exatas em uma aldeia.</label><label title="Faz o calculo da quantidade de tropas que tempo todas as aldeias visiveis em visualiza\u00e7\u00f5es > tropas. A quantidade \u00e9 mostrada no final da p\u00e1gina."><input type="checkbox" name="troopCounter"/> Calcula a quantidade de tropas.</label><label title="Faz ataques autom\u00e1ticos apartir da p\u00e1gina do Assistente de Farm."><input type="checkbox" name="assistentFarm"/> Assistente de Farm autom\u00e1tico.</label><label title="Constr\u00f3i e demoli edif\u00edcios em massa na visualiza\u00e7\u00e3o dos edif\u00edcios."><input type="checkbox" name="building"/> Constru\u00e7\u00e3o/demoli\u00e7\u00e3o em massa.</label><label title="Farma aldeias pr\u00e9-programadas repetidamente. Caso mantenha essa fun\u00e7\u00e3o desativada ou n\u00e3o a use, n\u00e3o correr\u00e1 perigo de ser banido!"><input type="checkbox" name="placeFarm"/> Farmador Autom\u00e1tico.</label><label title="Selecionar aldeias de acordo com o r\u00e1cio de tropas de ataque e defesa."><input type="checkbox" name="selectVillages"/> Selecionar aldeiar por r\u00e1cio.</label><label title="Faz pesquisas em massa (apenas mundos com ferreiro simples)."><input type="checkbox" name="research"/> Pesquisa em massa.</label></div><h1 style="text-align:center"><button id="sa">Salvar</button></h1></div></div>');
for(var d in a.config)"_"!==d[0]&&(document.getElementsByName(d)[0]["boolean"===typeof a.config[d]?"checked":"value"]=a.config[d]);$("#di [title]").tooltip({track:!0,fade:150});$("#tooltip").css({padding:"4px 4px 3px",background:"#fff",border:"1px solid #aaa",fontWeight:"normal","-moz-border-radius":4,"-webkit-border-radius":4,"border-radius":4,"-moz-box-shadow":"0 0 4px #777","-webkit-box-shadow":"0 0 4px #777","box-shadow":"0 0 4px #777"});$("#di").draggable({handle:"#he",containment:"body"});$("#sa").click(function(){$("#di input").each(function(){a.config[this.name]=
"checkbox"===this.type?this.checked:this.value});localStorage[l]=JSON.stringify(a.config);alert("As configura\u00e7\u00f5es foram salvas!")})},mapElement:function(a,b){var c=$("#map_village_"+a.id),e=a.pos||[0,0],e=$("<div/>").css($.extend(b,{top:Number(c.css("top").replace("px",""))+e[0],left:Number(c.css("left").replace("px",""))+e[1],zIndex:10,position:"absolute"}));a.html&&e.html(a.html);a.Class&&e.addClass(a.Class);b.borderRadius&&e.attr("style",e.attr("style")+"-moz-border-radius:"+b.borderRadius+
"px;-webkit-border-radius:"+b.borderRadius+"px");c.parent().prepend(e)},mapVillages:function(a){var b,c,e,h;for(c=0;c<TWMap.size[1];c++)for(e=0;e<TWMap.size[0];e++)if(h=TWMap.map.coordByPixel(TWMap.map.pos[0]+TWMap.tileSize[0]*e,TWMap.map.pos[1]+TWMap.tileSize[1]*c),b=TWMap.villages[h.join("")])b.player=TWMap.players[b.owner],"string"===typeof b.points&&(b.points=Number(b.points.replace(".",""))),a.call(b,h)},currentUnits:function(d){var d=d||document,b={},c;for(c in a.config._data.units)b[c]=Number($("[name="+
c+"]",d).next().text().match(/\d+/)[0]);return b},mapCoords:{init:function(){$("#map_whole").after('<br/><table class="vis" width="100%" id="twa-getcoords"><tr><th>Coordenadas obtidas <a href="#" id="twa-mapcoords-refresh">\u00bb Atualizar</a></th></tr><tr><td style="text-align:center"><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px"></textarea></td></tr></table>');$("#twa-mapcoords-refresh").click(function(){return a.mapCoords._do()});a.mapCoords._do()},_do:function(){var d,
b=[];$(".twa-identify").remove();a.mapVillages(function(c){if(d="0"===this.owner?a.config.mapAbandoneds&&this.points>Number(a.config.mapAbandonedsMin)&&this.points<Number(a.config.mapAbandonedsMax):a.config.mapPlayers&&this.points>Number(a.config.mapPlayersMin)&&this.points<Number(a.config.mapPlayersMax))b.push(c.join("|")),a.config.mapIdentify&&a.mapElement({id:this.id,Class:"twa-identify",pos:[a.config.lastAttack&&game_data.player.premium?15:25,38]},{width:7,height:7,borderRadius:10,background:"pink",
border:"1px solid #000",opacity:0.7})});$("#twa-getcoords textarea").html(b.join(" "));return!1}},mapManual:function(){$("#map_whole").after('<br/><table class="vis" width="100%" id="twa-coordsmanual"><tr><th>Coordenadas obtidas manualmente</th></tr><tr><td style="text-align:center"><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px"></textarea></td></tr></table>');var d=$("#twa-coordsmanual textarea"),b=[],c;TWMap.map._handleClick=function(e){e=this.coordByEvent(e);
if(c=TWMap.villages[e.join("")])e=e.join("|"),0>b.indexOf(e)&&(b.push(e),d.html(b.join(" ")),a.mapElement({id:c.id,Class:"twa-coordsmanual",pos:[a.config.lastAttack&&game_data.player.premium?15:25,a.config.mapIdentify?28:38]},{width:7,height:7,borderRadius:10,background:"#aeeeee",border:"1px solid #000",opacity:0.7}));return!1}},profileCoords:function(){for(var d,b=[],c=document.getElementById("villages_list").getElementsByTagName("tr"),e=1;e<c.length;e++)d=Number(c[e].getElementsByTagName("td")[2].innerHTML.replace('<span class="grey">.</span>',
"")),d>a.config.profileCoordsMin&&d<a.config.profileCoordsMax&&b.push(c[e].getElementsByTagName("td")[1].innerHTML);$("#villages_list").before('<table class="vis" id="twa-profilecoords" width="100%"><tr><th>Todas coordenadas <img width="13" height="13" title="Pontua\u00e7\u00e3o m\u00ednima: '+a.config.profileCoordsMin+"<br/>Pontua\u00e7\u00e3o m\u00e1xima: "+a.config.profileCoordsMax+'" class="tooltip" src="graphic/questionmark.png"/></th></tr><tr><td><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px">'+
b.join(" ")+"</textarea></td></tr></table><br/>");$(".tooltip").tooltip({showURL:!1,track:!0})},profileGraphic:function(){var a=location.search.match(/\d+$/)[0],b="info_player"===game_data.screen?"player":"tribe",c="http://"+game_data.world+".tribalwarsmap.com/"+game_data.market+"/",a='<table class="vis" width="100%" id="twa-graphic"><tr><th><a href="'+c+"history/"+b+"/"+a+'">Estat\u00edsticas <img src="http://www.hhs.gov/web/images/exit_disclaimer.png"/></a></th></tr><tr><td style="text-align:center"><p><img src="'+
(c+"graph/p_"+b+"/"+a)+'"/></p><img src="'+(c+"graph/oda_"+b+"/"+a)+'"/><p><img src="'+(c+"graph/odd_"+b+"/"+a)+'"/></p></td></tr></table>';"player"===b?$(".vis:not([id^=twa]):eq(2)").after("<br/>"+a):$("#content_value > table tr:first").append('<td valign="top">'+a+"</td>")},lastAttack:function(){$(".twa-lastattack").remove();var d,b,c,e,h,f,g,i;a.mapVillages(function(){$.ajax({url:"game.php?village="+this.id+"&screen=overview&json=1&source=873",dataType:"json",id:this.id,success:function(k){k[0].attack&&
(d=k[0].attack.time.split(/\s[A-z]/)[0].split("."),d=(new Date([d[1],d[0],"20"+d[2]].join(" "))).getTime(),b=$("#serverDate").text().split("/"),b=(new Date([b[1],b[0],b[2],$("#serverTime").text()].join(" "))).getTime(),c=(new Date(b-d)).getTime(),e=Math.floor(c/31536E6),h=Math.floor(c/864E5),f=Math.floor(c/36E5),g=Math.floor(c/6E4),1<=e?i=e+"Ano":2<=h?i=h+"d"+f%24+"h":1<=f?(g%=60,g=10>g?"0"+g:g,f=10>f?"0"+f:f,i=f+":"+g+"h"):(g=10>g?"0"+g:g,i="00:"+g+"m"),a.mapElement({id:this.id,html:i,Class:"twa-lastattack",
pos:[25,2]},{width:45,height:10,fontSize:8,borderRadius:5,color:"#fff",textAlign:"center",background:"#111",border:"1px solid #000",opacity:0.7}))}})});return!0},mapGenerator:function(){var a,b,c=/ally/.test(game_data.mode)?"t":"p",e="00ff00,999999,823c0a,b40000,f40000,0000f4,880088,f0c800,00a0f4,ff8800,ffff00,e0d3b8,04b45f,04b4ae,81f7f3,be81f7,fa58f4,ff0088,ffffff,f7be81".split(","),h=120,f=500,g=500;/con/.test(game_data.mode)?(a=$("#con_player_ranking_table, #con_ally_ranking_table"),h=320,b=$("h3").html().match(/\d+/)[0],
b=1===b.length?"0"+b:b,f=b[1]+"50",g=b[0]+"50"):/kill/.test(game_data.mode)?a=$("#kill_player_ranking_table, #kill_ally_ranking_table").next():"awards"===game_data.mode?a=$("#award_ranking_table"):("t"===c&&$("#ally_ranking_table tr:first th:eq(1)").width(150),a=$("#player_ranking_table, #ally_ranking_table"));a.find("tr:not(:first)").each(function(a){$("td:eq(1)",this).prepend('<input class="map-item" type="checkbox" style="margin:0px;margin-right:20px" color="'+e[a]+'" id="'+$("a",this).attr("href").match(/\d+$/)[0]+
'"/>')}).eq(-1).after('<tr><td colspan="8"><input type="button" id="twa-mapgenerator" value="Gerar mapa"/> <label><input type="checkbox" id="checkall"/> <strong>Selecionar todos</strong></label></td></tr>');$("#twa-mapgenerator").click(function(){var a="http://"+game_data.market+".twstats.com/"+game_data.world+"/index.php?page=map&";$(".map-item").each(function(b){b++;$(this).is(":checked")&&(a+=c+"i"+b+"="+this.id+"&"+c+"c"+b+"="+$(this).attr("color")+"&")});a+="zoom="+h+"&centrex="+f+"&centrey="+
g+"&nocache=1&fill=000000&grid=1&kn=1&bm=1";window.open(a)});$("#checkall").click(function(){$(".map-item").attr("checked",this.checked)})},tooltipGraphic:function(){var a="http://"+game_data.world+".tribalwarsmap.com/"+game_data.market+"/graph/p_",b;$("#content_value a[href*=info_player], #content_value a[href*=info_ally]").each(function(){this.href.match(/\d+$/)&&(b=a+(/info_player/.test(this.href)?"player":"tribe")+"/"+this.href.match(/\d+$/)[0],(new Image).src=b,this.title='<img src="'+b+'">',
$(this).tooltip({track:!0,showURL:!1}))});$("#tooltip").css("max-width",323).addClass("twa-tooltipgraphic")},reportFilter:function(){$("#report_list").before('<table class="vis" width="100%"><tr><th>Pesquisar relat\u00f3rios:</th></tr><tr><td><input type="text" id="twa-reportfinder" style="padding:1px 2px;border:1px solid silver;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/></td></tr></table>');$("#twa-reportfinder").keyup(function(){var a=this.value.toLowerCase();
$("#report_list tr:not(:first, :last)").each(function(){$(this)[0>$(this).text().toLowerCase().indexOf(a)?"hide":"show"]()})});selectAll=function(a,b){$("#report_list tr:not(:first, :last):visible input[type=checkbox]").attr("checked",b)}},villageFilter:function(){var a=".overview_table tr:not(:first)",b="span[id^=label_text]";switch($("#overview").val()){case "units":a=".overview_table tbody";break;case "commands":case "incomings":a=".overview_table tr.nowrap",b="span[id^=labelText]"}$(".overview_table").before('<table class="vis" width="100%"><tr><th>Pesquisar aldeias: </th></tr><tr><td><input type="text" id="twa-villagefilter" style="padding:1px 2px;border:1px solid silver;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/></td></tr></table>');
$("#twa-villagefilter").keyup(function(){var c=this.value.toLowerCase();$(a).each(function(){$(this)[0>$(b,this).text().toLowerCase().indexOf(c)?"hide":"show"]()})});selectAll=function(a,b){$(".overview_table tr.nowrap:visible input[type=checkbox]").attr("checked",b)}},troopCounter:function(){$("#units_table").after('<table id="twa-troopcounter" class="vis" style="width:100%;margin:0 auto"><thead>'+$("#units_table thead").html()+"</thead><tbody>"+$("#units_table tbody:first").html()+"</tbody></table>");
for(var a={},b=document.getElementById("twa-troopcounter"),c=document.getElementById("units_table").getElementsByTagName("tr")[0].getElementsByTagName("img"),e=document.getElementById("units_table").getElementsByTagName("tbody"),h=b.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),f=0,g,i;f<c.length;f++)a[c[f].src.match(/_(\w+)\.png/)[1]]=[[f+2,0],[f+1,0],[f+1,0],[f+1,0]];for(f=0;f<e.length;f++){g=e[f].getElementsByTagName("tr");for(c=0;c<g.length;c++)for(i in a)a[i][c][1]+=Number(g[c].getElementsByTagName("td")[a[i][c][0]].innerHTML)}$("td:first",
b).empty().width($("#units_table td:first").width());$("th:first",b).html("Contagem de Tropas:");$("th:last, td:has(a)",b).remove();for(f=0;f<h.length;f++)for(i in a)b=h[f].getElementsByTagName("td")[a[i][f][0]],b.className="unit-item"+(0==a[i][f][1]?" hidden":""),b.innerHTML=a[i][f][1]},reportCalc:function(){if(!$("#twa-reportcalc").length){$("table[width=470]").before('<table class="vis" width="470" id="twa-reportcalc"><tbody><tr><th>Unidades necess\u00e1rias:</th></tr><tr><td align="center"><label><input type="checkbox" id="twa-currentvillage"> Usar unidades da aldeia atual</label></td></tr><tr><td align="center" id="twa-units"></td></tr><tr><th>Unidades calculadas: <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></th></tr><tr><td align="center" id="twa-unitscalc" style="font-weight:bold"></td></tr><tr><td align="center" id="twa-attack"><a href="#">\u00bb Atacar com essas tropas</a></td></tr></tbody></table>');
$(document).ajaxStart(function(){$("#twa-loader").show()}).ajaxStop(function(){$("#twa-loader").hide()});$("#twa-units input").change(function(){$("#twa-unitscalc > span, #twa-attack").hide();a.reportCalc()});var d=document.getElementById("twa-unitscalc"),b=document.getElementById("twa-units"),c;for(c in a.config._data.units)d.innerHTML+='<span id="twa-'+c+'"><img src="http://cdn.tribalwars.net/graphic/unit/unit_'+c+'.png"/> <span></span></span> ',b.innerHTML+='<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+
c+'.png"q><input type="checkbox"'+("spear"===c||"archer"===c||"spy"===c||"ligth"===c||"marcher"===c||"knight"===c?' checked="true"':"")+' class="'+c+'"/>';$("#twa-unitscalc > span, #twa-attack").hide().last().click(function(){$.post(game_data.link_base_pure.replace("en=","en=place&try=confirm").replace(/village=\d+/,"village="+o),$.extend({x:p[0],y:p[1],attack:!0},j),function(a){var b=$("#error",a);if(b.text())return alert("Ocorreu o seguinte erro ao enviar o ataque: "+b.text());a=$("form",a);$.post(a[0].action,
a.serialize(),function(){alert("Ataque enviado com sucesso!")})});return!1})}var d=$("#attack_spy tr:first td").text().trim().replace(/\./g,"").split(" "),b=$("#attack_spy tr:eq(1) td").text().replace(/\t/g,"").split("\n"),e={},b=b.splice(1,b.length-2);$.each(b,function(){var b=this.split(/\s\(/),c=b[1].match(/\d+/);e[a.config._data.builds[b[0]]]=Number(c)});var b=0===e.hide?0:Math.round(150*Math.pow(40/3,(e.hide-1)/9)),h=(0===e.storage?1E3:Math.round(1E3*Math.pow(400,(e.storage-1)/29)))-b,b=$(".nopad table:eq(1) tr:eq(1) td:last").text().split("."),
b=(new Date([b[1],b[0],"20"+b[2]].join(" "))).getTime();c=$("#serverDate").text().split("/");c=(new Date([c[1],c[0],c[2],$("#serverTime").text()].join(" "))).getTime();var f=(new Date(c-b)).getTime(),g=Math.floor(f/36E5),i=Math.floor(f/6E4)%60,b=$("#attack_info_att tr:eq(1) a").text().match(/ \((\d+)\|(\d+)\) \w+ $/);c=$("#attack_info_def tr:eq(1) a").text().match(/ \((\d+)\|(\d+)\) \w+ $/);for(var b=Math.sqrt(Math.pow(Number(b[1])-Number(c[1]),2)+Math.pow(Number(b[2])-Number(c[2]),2)),k=0,j={},l=
[e.wood,e.stone,e.iron],n="knight,light,marcher,heavy,spear,axe,archer,sword".split(","),m=c=0;m<n.length;m++)a.config._data.units[n[m]]&&(f=a.config._data.units[n[m]].speed*(b/a.config._data.world.unit_speed),g=Math.floor(f/3600),i=Math.floor((f-3600*g)/60),f=parseFloat(g+"."+i),f>c&&(c=f));var q=(""+c).split(".");d.map(function(b,c){var d=0===l[c]?5*a.config._data.world.speed:Math.round(30*Math.pow(80,(l[c]-1)/29))*a.config._data.world.speed,b=Number(b)+(g*d+i*(d/60)+q[0]*d+q[1]*(d/60));b>h&&(b=
h);k+=b});var d=$("#attack_info_att a:first").attr("href").match(/\d+/),b=$("#attack_info_att tr:eq(1) a").attr("href").match(/\d+$/),p=$("#attack_info_def a[href*=info_village]").text().match(/.*\((\d+)\|(\d+)\)\sK\d{1,2}/).slice(1,3),o=game_data.village.id;d===game_data.player.id&&(o=$("#twa-currentvillage:checked").length?curvid:b);$.get(game_data.link_base_pure.replace(/village=\d+/,"village="+o)+"place",function(b){for(var b=a.currentUnits(b),c=0;c<n.length;c++){var d=n[c];if(a.config._data.units[d]&&
$("#twa-units ."+d+":checked").length){var e=a.config._data.units[d].carry,f=b[d]*e;if(0!==b[d])if(f>=k){j[d]=k/e;break}else j[d]=f>k?e/k:b[d],k-=f;!j.spy&&$(".twa-units input[value=spy]:checked").length&&0<b.spy&&(j.spy=4<b.spy?5:b.spy)}}for(d in j)$("#twa-"+d).show().find("span").html(j[d]);$("#twa-attack")[$.isEmptyObject(j)?"hide":"show"]()})},rename:{init:function(a,b,c,e){$(a).parent().before('<table class="vis" width="100%"><tr><th>Renomear '+b+': </th></tr><tr><td><input type="text" id="twa-'+
c+'" style="padding:1px 2px;border:1px solid red;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/> <input type="button" value="Renomear"/><label><input type="checkbox" id="twa-onlyselected"/> Apenas '+b+" selecionad"+e+'s</label> <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></td></tr></table>');$(document).ajaxStart(function(){$("#twa-loader").show()}).ajaxStop(function(){$("#twa-loader").hide()})},
reports:function(){a.rename.init("#report_list","relat\u00f3rios","reportrename","o");a.rename._do({entry:"#twa-reportrename",input:"#report_list tr:not(:first, :last):visible input:not([type=checkbox])",inputChecked:"#report_list tr:not(:first, :last):visible:has(input:checked) input:not([type=checkbox])"})},commands:function(){a.rename.init(".overview_table","comandos","commandrename","o");$(".overview_table input[type=checkbox]").removeAttr("disabled");a.rename._do({entry:"#twa-commandrename",
input:".overview_table tr:not(:first, :last):visible input[id^=editInput]",inputChecked:".overview_table tr:not(:first, :last):visible:has(input:checked) input[id^=editInput]"})},villages:function(){a.rename.init(".overview_table","aldeias","villagerename","a");$(".overview_table tr:not(:first)").each(function(){$("td:first",this).html('<input type="checkbox"/>')});a.rename._do({entry:"#twa-villagerename",input:".overview_table tr:not(:first):visible input[id^=edit_input]",inputChecked:".overview_table tr:not(:first):visible:has(input:checked) input[id^=edit_input]",
min:3,max:32})},_do:function(a){function b(b){if(!this.val()||this.val().length<(a.min||1)||this.val().length>(a.max||255))return this.css("border","1px solid red");this.css("border","1px solid silver");b&&$($("#twa-onlyselected:checked").length?a.inputChecked:a.input).val(this.val()).next().click()}$(a.entry).keyup(function(a){b.call($(this),13===a.keyCode);return!1}).keypress(function(a){return 13!==a.keyCode});$(a.entry).next().click(function(){b.call($(this).prev(),!0)})}},farm:{assistent:{templates:{},
timeAttack:1E3,timeLoop:6E4,id:0,init:function(){$("h3:first").append(' <span id="twa-assistentfarm">(Autom\u00e1tico)</span>');$("#farm_units").parent().after('<div class="vis" style="overflow:auto;height:100px"><table style="width:100%"><tr id="twa-assistent-log"><th><h4>Farm Assistent Log</h4></th></tr></table></div>');40<a.config._data.world.speed&&(a.farm.assistent.timeAttack/=3,a.farm.assistent.timeLoop/=6);$('form:not(:last)[action*="template_id="]').each(function(d){a.farm.assistent.templates[d]=
{id:Number(this.action.split("=").pop()),farm:Number($('td[style="text-align:center"]:not([class])',this).text())}});setInterval(function(){a.farm.assistent.attack()},a.farm.assistent.timeLoop);a.farm.assistent.attack()},log:function(d,b){$("#twa-assistent-log").after("<tr><td>"+a.farm.assistent.id++ +': <img src="'+(b?"/graphic/delete_small.png":"/graphic/command/attack.png")+'"/> '+d+"</td></tr>")},attack:function(){$.get(location.href,function(d){var b=0,c=a.farm.assistent.templates;$("#am_widget_Farm table tr[class]",
d).each(function(){if(!$("td:eq(3) img",this).length){var d=$("td:eq(8) a",this).attr("onclick").toString().split(", ")[1],h=$("td:eq(3) a",this).html(),f=$("td:eq(5)",this).text(),g={farm:0},i=0,k=3E6,j;/\?/.test(f)||(f=f.trim().replace(/\./g,"").split(" "),i=Number(f[0])+Number(f[1])+Number(f[2]));for(j in c)f=i>c[j].farm?i-c[j].farm:c[j].farm-i,c[j].farm>g.farm&&f<k&&(g=c[j],k=f);g.id&&(setTimeout(function(){$.ajax({type:"post",url:Accountmanager.send_units_link,data:{target:d,template_id:g.id},
info:h,dataType:"json",success:function(b){b.success?a.farm.assistent.log(b.success.replace("\n"," ")+" na aldeia "+this.info):b.error&&a.farm.assistent.log(b.error+" na aldeia "+this.info,!0)}})},b),b+=a.farm.assistent.timeAttack)}})})}},place:{init:function(){$("#content_value").prepend('<table class="vis" id="twa-farm" width="100%"><tr><td><h3 style="margin-bottom:5px">Farmador Autom\u00e1tico</h3><table width="100%" class="vis"><tbody><tr><td id="twa-farm-units"></td></tr></tbody></table><p style="margin-top:0px"><label><input type="checkbox" class="twa-farm-options" name="_placeFarmProtect"/> N\u00e3o enviar ataques caso a aldeia tenha dono.</label><br/><label><input type="checkbox" class="twa-farm-options" name="_placeFarmReplace"/> Caso n\u00e3o tenha tropas sulficientes usar o que tiver.</label><p><strong>Coordenadas:</strong><br/><textarea class="twa-farm-options" style="width:340px;height:90px">'+
a.config._placeFarmCoords.join(" ")+'</textarea></p></p><input type="button" value="Iniciar ataques" id="twa-farm-switch"/></td></tr></table>');var d=document.getElementById("twa-farm-units"),b=!1,c,e;for(c in a.config._data.units)d.innerHTML+='<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+c+'.png"/> <input name="'+c+'" style="width:30px" class="twa-farm-options"/> ';$(".twa-farm-options").each(function(){"text"===this.type||$.nodeName(this,"textarea")?(this.value="text"===this.type?a.config._placeFarmUnits[this.name]||
0:a.config._placeFarmCoords.join(" "),$(this).keyup(function(){var c=this;clearTimeout(b);b=setTimeout(function(){if("text"===c.type)a.config._placeFarmUnits[c.name]=a.farm.place.data[c.name]=c.value;else{for(var b=c.value.split(/\s+/),d=[],e=0;e<b.length;e++)/-?\d{1,3}\|-?\d{1,3}/.test(b[e])&&d.push(b[e]);a.config._placeFarmCoords=d;a.farm.place.next(!0)}localStorage[l]=JSON.stringify(a.config)},1E3)}).keypress(function(a){return 47<a.keyCode&&58>a.keyCode||124===a.keyCode||32===a.keyCode})):$(this).change(function(){a.config[this.name]=
this.checked;localStorage[l]=JSON.stringify(a.config)})});$("#twa-farm-switch").click(function(){a.farm.place.stop=!a.farm.place.stop;this.value=a.farm.place.stop?"Continuar ataques":"Pausar ataques";!a.farm.place.stop&&a.farm.place.attack()});for(e in timers)timers[e].reload=!1;for(c in a.config._data.units)a.farm.place.data[c]=a.config._placeFarmUnits[c];a.config._placeFarmIndex>=a.config._placeFarmCoords.length&&(a.config._placeFarmIndex=0);a.config._placeFarmCoords.length&&(a.farm.place.coord=
a.config._placeFarmCoords[a.config._placeFarmIndex].split("|"))},attack:function(d){if(a.farm.place.stop)var b=setInterval(function(){a.farm.place.stop||(a.farm.place.attack(),clearInterval(b))},500);else if(!a.farm.place.wait){var c,e,h,f,g;a.farm.place.data.x=a.farm.place.coord[0];a.farm.place.data.y=a.farm.place.coord[1];if(d)for(g in d)a.farm.place.data[g]=d[g];$.post(game_data.link_base_pure.replace("en=","en=place&try=confirm"),a.farm.place.data,function(b){c=$(b).find("#error");if(c.text())e=
a.farm.place.nextReturn(b),h=a.farm.place.currentUnits(b),e&&!h?(setTimeout(function(){a.farm.place.wait=!1;a.farm.place.attack()},e),a.farm.place.wait=!0):!e&&!h?a.farm.place.wait=!0:a.farm.place.attack(h);else{if(a.config._placeFarmProtect&&$(b).find("form a[href*=player]").length)return a.farm.place.next();f=$(b).find("form");$.post(f[0].action,f.serialize(),function(){a.farm.place.next()})}})}},nextReturn:function(a){var b=$("table.vis:last tr:not(:first)",a),a=b.find("[src*=cancel], [src*=back], [src*=return]"),
b=b.find("[src*=attack]"),a=a.length?a:b.length?b:!1,b=b.length?2:1;if(!a)return!1;if(a=a.eq(0).parent().parent().find(".timer").text())return a=a.split(":"),36E5*a[0]+6E4*a[1]+1E3*a[2]*b},currentUnits:function(d){var b={},c,e;a.config._placeFarmReplace&&$(".unitsInput",d).each(function(){c=this.id.match(/_(\w+)$/)[1];e=$(this).next().text().match(/\d+/)[0];a.config._placeFarmUnits[c]&&a.config._placeFarmUnits[c]>e&&(b[c]=e)});return!$.isEmptyObject(b)?b:!1},next:function(d){d||a.config._placeFarmIndex++;
a.config._placeFarmIndex>=a.config._placeFarmCoords.length&&(a.config._placeFarmIndex=0);localStorage[l]=JSON.stringify(a.config);a.config._placeFarmCoords.length&&(a.farm.place.coord=a.config._placeFarmCoords[a.config._placeFarmIndex].split("|"));d||a.farm.place.attack()},stop:!0,wait:!1,data:{attack:!0},coord:[]}},building:{init:function(){var d,b,c;$(".overview_table").before('<table class="vis" id="twa-building" width="100%"><tr><th><label><input type="radio" checked name="twa-building" id="twa-building-build"/> Constru\u00e7\u00e3o em Massa - Edif\u00edcios <img src="graphic/questionmark.png" width="13" title="Os edif\u00edcios ser\u00e3o construidos at\u00e9 o n\u00edvel indicado abaixo!"/></label> <a href="#" id="twa-cancel-builds">\u00bb Cancelar todas as contru\u00e7\u00f5es</a></th></tr><tr><td class="twa-buildings"></td></tr><tr><th><label><input type="radio" name="twa-building" id="twa-building-destroy"/> Demoli\u00e7\u00e3o em Massa - Edif\u00edcios <img src="graphic/questionmark.png" width="13" title="Os edif\u00edcios ser\u00e3o demolidos at\u00e9 o n\u00edvel indicado abaixo!"/></label> <a href="#" id="twa-cancel-destroy">\u00bb Cancelar todas as demoli\u00e7\u00f5es</a></th></tr><tr><td class="twa-buildings"></td></tr></table><table class="vis" width="100%"><tr><th>Clique no icone dos edif\u00edcios abaixo para iniciar a constru\u00e7\u00e3o em massa do edif\u00edcio clicado.</th></tr></table>');
$("#twa-building-build, #twa-building-destroy").click(function(){1===BuildingOverview._display_type&&"twa-building-destroy"===this.id||0===BuildingOverview._display_type&&"twa-building-build"===this.id||BuildingOverview.show_all_upgrade_buildings("twa-building-destroy"===this.id)});$("#twa-cancel-builds, #twa-cancel-destroy").click(function(){confirm("Tem certeza que deseja cancelar todas as pesquisas?")&&a.building.cancel("twa-cancel-destroy"===this.id);return!1});!1===BuildingOverview._display_type?
BuildingOverview.show_all_upgrade_buildings():BuildingOverview._display_type&&$("#twa-building-destroy").attr("checked",!0);for(d=0;2>d;d++)for(c in b=$(".twa-buildings").eq(d),a.config._data.builds)c=a.config._data.builds[c],b.append('<img src="graphic/buildings/'+c+'.png"/> <input type="text" style="width:25px" name="'+c+'" value="'+a.config[d?"_buildingDestroy":"_buildingBuild"][c]+'"/> ');$(".twa-buildings").each(function(b){$("input",this).keyup(function(){var c=this;clearTimeout(void 0);setTimeout(function(){a.config[b?
"_buildingDestroy":"_buildingBuild"][c.name]=c.value;localStorage[l]=JSON.stringify(a.config)},2E3)}).keypress(function(a){return 47<a.keyCode&&58>a.keyCode&&3>this.value.length})});$("#buildings_table tr:first th:has(img[src*=buildings]) a").click(function(){return a.building._do($("img",this)[0].src.match(/\/([a-z]+)\.png/)[1],BuildingOverview._display_type)})},_do:function(d,b){var c=document.getElementById("upgrade_building_link").value,e=b?5:a.config._buildingMaxOrders,h=$(".twa-buildings").eq(b).find("input[name="+
d+"]").val();$("#buildings_table tr:not(:first)").each(function(){var a=this.className.match(/\d+/)[0];if(BuildingOverview._upgrade_villages[a].buildings[d]){var g=$("td:last li:has(.build-status-light[style*="+(b?"red":"green")+']) img[src*="'+d+'.png"]',this),i=Number($(".b_"+d+" a",this).text())+g.length;g.parent().parent().find(".build-cancel-icon img").click();for(g=$("#building_order_"+a+" img").length;g<e;g++)(b?i-- >h:i++<h)&&$.getJSON(c.replace(/village=\d+/,"village="+a),{id:d,destroy:b,
force:1},function(b){if(b.success){if(!document.getElementById("building_order_"+a)){var c=$('<ul class="building_order" id="building_order_'+a+'"></ul>');BuildingOverview.create_sortable(c);$("#v_"+a+" td:last").append(c)}$("#building_order_"+a).html(b.building_orders)}})}});return!1},cancel:function(a){$("li:has(.build-status-light[style*="+(a?"red":"green")+"]) .build-cancel-icon img").click()}},selectVillages:{units:[],villages:{},checkboxes:{},attack:{axe:1,spy:0,light:1,marcher:1,ram:1,catapult:1,
knight:1,snob:0},init:function(){$(".overview_table").before('<table class="vis" width="100%" id="twa-selectvillages"><tr><th>Selecionar aldeias:</th></tr><tr><td><label><input name="twa-select" type="checkbox" id="twa-select-off"/> Com tropas de ataque</label><br/><label><input name="twa-select" type="checkbox" id="twa-select-def"/> Com tropas de defesa</label></td></tr></table>');$("[name=twa-select]").change(function(){a.selectVillages[this.id.split("-")[2]](this.checked)});for(name in a.config._data.units)a.selectVillages.units.push(name);
var d=document.getElementById("units_table").getElementsByTagName("tbody");if("units"===document.getElementById("overview").value)for(var b=0;b<d.length;b++){var c=d[b].getElementsByTagName("td")[0],e=c.getElementsByTagName("span")[0].id.split("_")[1];c.innerHTML='<input type="checkbox" id="'+e+'" value="'+e+'" name="village_ids[]"> '+c.innerHTML;a.selectVillages.checkboxes[e]=d[b].getElementsByTagName("input")[0]}c={};for(b=0;b<d.length;b++){var h=d[b].getElementsByClassName("unit-item"),e=d[b].getElementsByTagName("span")[0].id.split("_")[1];
a.selectVillages.villages[e]=d[b];c[e]={off:0,def:0};for(var f=0;f<a.selectVillages.units.length;f++)"spy"!==a.selectVillages.units[f]&&0!==a.selectVillages.attack[a.selectVillages.units[f]]&&(c[e][a.selectVillages.attack[a.selectVillages.units[f]]?"off":"def"]+=Number(h[f].innerHTML)*a.config._data.units[a.selectVillages.units[f]].pop)}a.selectVillages.pop=c},off:function(d){for(var b in a.selectVillages.pop)a.selectVillages.pop[b].off>a.selectVillages.pop[b].def&&(a.selectVillages.checkboxes[b].checked=
d)},def:function(d){for(var b in a.selectVillages.pop)a.selectVillages.pop[b].def>a.selectVillages.pop[b].off&&(a.selectVillages.checkboxes[b].checked=d)}},research:{init:function(){$(".overview_table").before('<table class="vis" width="100%" id="twa-research"><tr><th>Clique no icone das unidades abaixo para iniciar a pesquisa em massa da unidade clicada. <a href="#" id="twa-research-cancel">\u00bb Cancelar todas as pesquisas</a></th></tr></table>');$("#twa-research-cancel").click(function(){confirm("Tem certeza que deseja cancelar todas as pesquisas?")&&
a.research.cancel();return!1});$("#techs_table tr:first a:has(img)").click(function(){return a.research._do(this.href.match(/order=(\w+)/)[1])})},_do:function(a){var b=document.getElementById("techs_table").getElementsByTagName("tr"),c;for(c=1;c<b.length;c++)vid=b[c].id.split("_")[1],document.getElementById(vid+"_"+a)&&$.ajax({type:"post",url:TechOverview.urls.ajax_research_link.replace(/village=\d+/,"village="+vid),data:{tech_id:a},dataType:"json",vid:vid,success:function(b){b.success&&(document.getElementById("village_tech_order_"+
this.vid).innerHTML=b.tech_order,TechOverview.change_dot($("#"+this.vid+"_"+a),this.vid,a,"brown"),game_data.village.id==this.vid&&($("#wood").html(b.resources[0]),$("#stone").html(b.resources[1]),$("#iron").html(b.resources[2]),startTimer()))}});return!1},cancel:function(){$("#techs_table div.tech-cancel-icon img").each(function(){var a=this.onclick.toString().match(/cancel_research_order\((\d+), (\d+), '(\w+)'\)/);$.ajax({url:TechOverview.urls.ajax_cancel_tech_order_link.replace(/village=\d+/,"village="+
a[1]),dataType:"json",type:"post",data:{tech_order_id:a[2]},name:a[3],vid:a[1],success:function(a){a.success&&(document.getElementById("village_tech_order_"+this.vid).innerHTML=a.tech_order,TechOverview.restore_dot(this.vid,this.name))}})})}}};a.ready(function(){switch(game_data.screen){case "map":(a.config.mapPlayers||a.config.mapAbandoneds)&&!$("#twa-getcoords").length&&a.mapCoords.init();a.config.mapManual&&!$("#twa-coordsmanual").length&&a.mapManual();a.config.lastAttack&&game_data.player.premium&&
a.lastAttack();break;case "info_player":a.config.profileCoords&&!$("#twa-profilecoords").length&&a.profileCoords();a.config.profileStats&&!$("#twa-graphic").length&&a.profileGraphic();break;case "info_ally":a.config.profileStats&&!$("#twa-graphic").length&&a.profileGraphic();break;case "info_member":a.config.allyGraphic&&"info_member"===game_data.screen&&!$(".twa-tooltipgraphic").length&&a.tooltipGraphic();break;case "ranking":a.config.rankingGraphic&&"ranking"===game_data.screen&&!$(".twa-tooltipgraphic").length&&
a.tooltipGraphic();(a.config.mapGenerator&&!$("#twa-mapgenerator").length||"awards"!==game_data.mode||"wars"!==game_data.mode||"secrets"!==game_data.mode)&&a.mapGenerator();break;case "overview_villages":a.config.villageRename&&"combined"===$("#overview").val()&&!$("#twa-villagerename").length&&a.rename.villages();a.config.commandRename&&"incomings"===$("#overview").val()&&"commands"===$("#overview").val()&&!$("#twa-commandrename").length&&a.rename.commands();a.config.villageFilter&&"trader"!==$("#overview").val()&&
!$("#twa-villagefilter").length&&a.villageFilter();a.config.troopCounter&&"units"===$("#overview").val()&&!$("#twa-troopcounter").length&&a.troopCounter();a.config.selectVillages&&"units"===$("#overview").val()&&!$("#twa-selectvillages").length&&a.selectVillages();a.config.building&&"buildings"===$("#overview").val()&&!$("#twa-building").length&&a.building.init();a.config.research&&"tech"===$("#overview").val()&&!$("#twa-research").length&&a.research.init();break;case "report":a.config.reportCalc&&
/view\=\d+$/.test(location.href)&&$("#attack_spy").length&&a.reportCalc();a.config.reportFilter&&!$("#twa-reportfinder").length&&a.reportFilter();a.config.reportRename&&game_data.player.premium&&!$("#twa-reportrename").length&&a.rename.reports();break;case "am_farm":a.config.assistentFarm&&game_data.player.farm_manager&&!$(".error").length&&!$("#twa-assistentfarm").length&&a.farm.assistent.init();break;case "place":a.config.placeFarm&&!$("#twa-placefarm").length&&a.farm.place.init();break;case "settings":!$("#di").length&&
a.displayConfig()}})})();