/*! Relaxeaza Tribal Wars Advanced v1.5.1 | 03/10/12. */
(function(){var x=$("#serverTime"),y=$("#serverDate"),a={version:"1.5",domain:"http://relaxeaza.orgfree.com/tw/",baseTool:function(a,c,d,f,e){$("table.twa-bar").show().find("> tbody > tr").append('<td><table class="header-border"><tbody><tr><td><table class="box menu nowrap"><tbody><tr><td class="box-item" style="height: 22px;">'+(d?'<img src="'+d+'" style="position:absolute">':"")+"<a "+(d?'style="margin-left:17px" ':"")+'href="#" id="'+a+'">'+c+'</a></td></tr></tbody></table></td></tr><tr class="newStyleOnly"><td class="shadow"><div class="leftshadow"></div><div class="rightshadow"></div></td></tr></tbody></table></td>');
var e=e?e:$("#content_value").width(),g=$('<div id="'+a+'-content" class="popup_content" style="width:'+e+'px;padding:5px;border:2px solid #840;z-index:999;display:none;position:absolute">'+f+"</div>").appendTo("body").center().css("top",$("#content_value").offset().top);$("#"+a).unbind("click").click(function(){g.toggle();return!1});return g},storage:function(b,c,d){var f=d?n[d]:n.settings,d=d?"data":"settings";if(!0===b)localStorage[f]=JSON.stringify(a[d]);else if("string"===typeof b){if(void 0===
c)return a[d][b];a[d][b]=c;localStorage[f]=JSON.stringify(a[d])}else $.isPlainObject(b)&&(localStorage[f]=JSON.stringify($.extend(a[d],b)));return!0},linkbase:function(a,c){var d=game_data.link_base_pure.replace("screen=","screen="+a);c&&(d=d.replace(/village=\d+/,"village="+c));return d},ready:function(b){function c(){f===d&&(d&&a.storage(!0,null,"data"),b())}var d=0,f=0;if(!a.data.builds&&++d){var e=function(){a.data.builds={};$.get(a.linkbase("main"),function(b){if($("#hide_completed:checked",
b).length)return $.post($("#hide_completed",b).attr("onclick").toString().split("'")[1],{hide_completed:!1},e);$("#buildings a:has(img[src*=buildings])",b).each(function(){a.data.builds[$(this).text().trim()]=this.href.match(/\=(\w+)$/)[1]});c(++f)})};e()}!a.data.world&&++d&&(a.data.world={},$.get("interface.php?func=get_config",function(b){$("config > *",b).each(function(b,c){4>b?a.data.world[c.nodeName]=$(c).text():$("*",c).each(function(){a.data.world[this.nodeName]=Number($(this).text())})});
c(++f)}));!a.data.units&&++d&&(a.data.units={},$.get("interface.php?func=get_unit_info",function(b){$("config > *",b).each(function(){"militia"!==this.nodeName&&(a.data.units[this.nodeName]={speed:60*Math.round(Number($("speed",this).text())),carry:Number($("carry",this).text()),pop:Number($("pop",this).text())})});c(++f)}));c()},config:function(){console.log("twa.config()");$("head").append('<style>#di {background:#c1d9ff;border:1px solid #3a5774;font-family:arial;font-size:12px;padding:4px;position:absolute;z-index:99999}#di textarea {border:1px solid #999;width:280px;height:80px;font-size:12px}#di input[type="text"],#di select {border:1px solid #999;width:70px;margin:0 2px;font-size:12px}#di button {border:1px solid #999;margin:3px}#di .di {background:#fff;padding:5px}#di a {color:blue;font-weight:400;text-decoration:underline}#di h1 {background:#e4e4e4;border-bottom:1px solid #c4c4c4;border-top:1px solid #fff;color:#333;font-size:13px;font-weight:700;line-height:20px;margin:0;padding:0 7px}#di p,#di label {margin:3px 0;display:block}#he {background:#e0edfe;cursor:move;font-size:14px;font-weight:700;padding: 4px 20px 4px 10px}#twa-tooltip{display:none;position:absolute;width:300px;padding:4px 4px 3px;background:#000;opacity:0.8;color:#fff;font-size:12px;border:1px solid #000;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}</style>');
$("body").append('<div id="di" style="width:400px"><div id="twa-tooltip"></div><div id="he">'+e.config.title.springf(a.data.version)+'</div><div id="co"><h1>'+e.config.coords+'</h1><div class="di"><label tooltip="'+e.config.tooltip.mapcoords+'"><input type="checkbox" name="mapcoords"/> '+e.config.mapcoords+'</label><label tooltip="'+e.config.tooltip.profilecoords+'"><input type="checkbox" name="profilecoords"/> '+e.config.profilecoords+'</label><label tooltip="'+e.config.tooltip.mapidentify+'"><input type="checkbox" name="mapidentify"/> '+
e.config.mapidentify+'</label><label tooltip="'+e.config.tooltip.mapmanual+'"><input type="checkbox" name="mapmanual"/> '+e.config.mapmanual+"</label></div><h1>"+e.config.graphicstats+'</h1><div class="di"><label tooltip="'+e.config.tooltip.rankinggraphic+'"><input type="checkbox" name="rankinggraphic"/> '+e.config.rankinggraphic+'</label><label tooltip="'+e.config.tooltip.allygraphic+'"><input type="checkbox" name="allygraphic"/> '+e.config.allygraphic+'</label><label tooltip="'+e.config.tooltip.profilestats+
'"><input type="checkbox" name="profilestats"/> '+e.config.profilestats+'</label></div><h1>Outras Op\u00e7\u00f5es</h1><div class="di"><label tooltip="'+e.config.tooltip.lastattack+'"><input type="checkbox" name="lastattack"/> '+e.config.lastattack+'</label><label tooltip="'+e.config.tooltip.reportfilter+'"><input type="checkbox" name="reportfilter"/> '+e.config.reportfilter+'</label><label tooltip="'+e.config.tooltip.villagefilter+'"><input type="checkbox" name="villagefilter"/> '+e.config.villagefilter+
'</label><label tooltip="'+e.config.tooltip.reportrename+'"><input type="checkbox" name="reportrename"/> '+e.config.reportrename+'</label><label tooltip="'+e.config.tooltip.commandrename+'"><input type="checkbox" name="commandrename"/> '+e.config.commandrename+'</label><label tooltip="Permite renomear aldeias em massa e individuais na visualiza\u00e7\u00e3o de aldeias."><input type="checkbox" name="renamevillages"/> Renomeador de Aldeias</label><label tooltip="'+e.config.tooltip.mapgenerator+'"><input type="checkbox" name="mapgenerator"/> '+
e.config.mapgenerator+'</label><label tooltip="'+e.config.tooltip.reportcalc+'"><input type="checkbox" name="reportcalc"/> '+e.config.reportcalc+'</label><label tooltip="'+e.config.tooltip.troopcounter+'"><input type="checkbox" name="troopcounter"/> '+e.config.troopcounter+'</label><label tooltip="'+e.config.tooltip.assistentfarm+'"><input type="checkbox" name="assistentfarm"/> '+e.config.assistentfarm+'</label><label tooltip="'+e.config.tooltip.building+'"><input type="checkbox" name="building"/> '+
e.config.building+'</label><label tooltip="'+e.config.tooltip.research+'"><input type="checkbox" name="research"/> '+e.config.research+'</label><label tooltip="'+e.config.tooltip.changegroups+'"><input type="checkbox" name="changegroups"/> '+e.config.changegroups+'</label><label tooltip="'+e.config.tooltip.memo+'"><input type="checkbox" name="memo"/> '+e.config.memo+'</label><label tooltip="'+e.config.tooltip.attackplanner+'"><input type="checkbox" name="attackplanner"/> '+e.config.attackplanner+
'</label><label tooltip="'+e.config.tooltip.selectvillages+'"><input type="checkbox" name="selectvillages"/> '+e.config.selectvillages+'</label><label tooltip="Adiciona op\u00e7\u00f5es premium na p\u00e1gina de visualiza\u00e7\u00e3o para usu\u00e1rios sem conta premium."><input type="checkbox" name="overview"/> Visualiza\u00e7\u00e3o avan\u00e7ada</label></div><h1 style="text-align:center"><button id="sa">Salvar</button></h1></div></div>');for(var b in a.settings)"_"!==b[0]&&(console.log(b,a.settings[b]),
document.getElementsByName(b)[0]["boolean"===typeof a.settings[b]?"checked":"value"]=a.settings[b]);var c=$("#twa-tooltip");$("#di [tooltip]").mouseenter(function(){c.html($(this).attr("tooltip"));var a=$(this).position();a.top-=c.height()+10;a.left+=23;c.css(a).show()}).mouseout(function(){c.hide()});$("#di").draggable({handle:"#he"}).center();$("#sa").click(function(){$("#di input").each(function(){a.settings[this.name]="checkbox"===this.type?this.checked:this.value});a.storage(!0);alert(e.config.save)})},
mapelement:function(a,c){var d=$("#map_village_"+a.vid),f=a.pos||[0,0],f=$("<div/>").css($.extend(c,{top:Number(d.css("top").replace("px",""))+f[0],left:Number(d.css("left").replace("px",""))+f[1],zIndex:10,position:"absolute"}));a.id&&f.attr("id",a.id);a.html&&f.html(a.html);a.Class&&f.addClass(a.Class);c.borderRadius&&f.attr("style",f.attr("style")+"-moz-border-radius:"+c.borderRadius+"px;-webkit-border-radius:"+c.borderRadius+"px");d.parent().prepend(f)},mapvillages:function(a){for(var c,d=0;d<
TWMap.size[1];d++)for(var f=0;f<TWMap.size[0];f++){var e=TWMap.map.coordByPixel(TWMap.map.pos[0]+TWMap.tileSize[0]*f,TWMap.map.pos[1]+TWMap.tileSize[1]*d);if(c=TWMap.villages[e.join("")])c.player=TWMap.players[c.owner],"string"===typeof c.points&&(c.points=Number(c.points.replace(".",""))),a.call(c,e)}},currentunits:function(b){var b=b||document,c={},d;for(d in a.data.units)c[d]=Number($("[name="+d+"]",b).next().text().match(/\d+/)[0]);return c},mapcoords:{init:function(){console.log("twa.mapcoords()");
$("#map_whole").after('<br/><table class="vis" width="100%" id="twa-getcoords"><tr><th>'+e.mapcoords.getcoords+' <a href="#" id="twa-mapcoords-refresh">\u00bb '+e.mapcoords.update+'</a></th></tr><tr><td style="text-align:center"><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px"></textarea></td></tr><tr><td id="twa-getcoords-options"><label><input type="checkbox" name="_mapplayers"> '+e.mapcoords.mapplayers+"</label> "+e.mapcoords.min+': <input name="_mapplayersmin" style="width:35px"> '+
e.mapcoords.max+': <input name="_mapplayersmax" style="width:35px"><br/><label><input name="_mapabandoneds" type="checkbox"> '+e.mapcoords.mapabandoneds+"</label> "+e.mapcoords.min+': <input name="_mapabandonedsmin" style="width:35px"> '+e.mapcoords.max+': <input name="_mapabandonedsmax" style="width:35px"></td></tr></table>');var b;$("#twa-getcoords-options input").each(function(){this["checkbox"===this.type?"checked":"value"]=a.settings[this.name]}).change(function(){var c=this;clearTimeout(b);
b=setTimeout(function(){var b=c["checkbox"===c.type?"checked":"value"];a.settings[c.name]="checkbox"===c.type?b:Number(b);a.storage(!0)},1E3)});$("#twa-mapcoords-refresh").click(function(){return a.mapcoords._do()});a.mapcoords._do()},_do:function(){var b,c=[];$(".twa-identify").remove();a.mapvillages(function(d){if(b="0"===this.owner?a.settings._mapabandoneds&&this.points>Number(a.settings._mapabandonedsmin)&&this.points<Number(a.settings._mapabandonedsmax):a.settings._mapplayers&&this.points>Number(a.settings._mapplayersmin)&&
this.points<Number(a.settings._mapplayersmax))c.push(d.join("|")),a.settings.mapidentify&&a.mapelement({id:"twa-mapcoords"+this.id,vid:this.id,Class:"twa-identify",pos:[a.settings.lastattack&&game_data.player.premium?15:25,38]},{width:7,height:7,borderRadius:10,background:"green",border:"1px solid #000",opacity:0.7})});$("#twa-getcoords textarea").html(c.join(" "));return!1}},mapmanual:function(){console.log("twa.mapmanual()");$("#map_whole").after('<br/><table class="vis" width="100%" id="twa-mapmanual"><tr><th>'+
e.mapmanual.getcoords+'</th></tr><tr><td style="text-align:center"><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px"></textarea></td></tr></table>');var b=$("#twa-mapmanual textarea"),c=[],d;TWMap.map._handleClick=function(f){f=this.coordByEvent(f);if(d=TWMap.villages[f.join("")])f=f.join("|"),0>c.indexOf(f)?(c.push(f),b.val(c.join(" ")),a.mapelement({id:"twa-manual-"+d.id,vid:d.id,Class:"twa-mapmanual",pos:[a.settings.lastattack&&game_data.player.premium?15:25,a.settings.mapidentify?
28:38]},{width:7,height:7,borderRadius:10,background:"red",border:"1px solid #000",opacity:0.7})):(c.remove(c.indexOf(f)),b.val(c.join(" ")),$("#twa-manual-"+d.id).remove());return!1}},profilecoords:function(){console.log("twa.profilecoords()");for(var b,c=[],d=document.getElementById("villages_list").getElementsByTagName("tr"),f=1;f<d.length&&(f+1!==d.length||d[f].getElementsByTagName("td")[2]);f++)b=Number(d[f].getElementsByTagName("td")[2].innerHTML.replace('<span class="grey">.</span>',"")),b>
a.settings._profilecoordsmin&&b<a.settings._profilecoordsmax&&c.push(d[f].getElementsByTagName("td")[1].innerHTML);$("#villages_list").before('<table class="vis" id="twa-profilecoords" width="100%"><tr><th>'+e.profilecoords.everycoords+'</th></tr><tr><td><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px">'+c.join(" ")+'</textarea></td></tr><tr><td><label><input style="width:40px" name="_profilecoordsmin"/> '+e.profilecoords.min+'</label><br/><label><input style="width:40px" name="_profilecoordsmax"/> '+
e.profilecoords.max+"</label></td></tr></table><br/>");var h;$("#twa-profilecoords input").each(function(){this.value=a.settings[this.name]}).change(function(){var b=this;clearTimeout(h);h=setTimeout(function(){a.settings[b.name]=Number(b.value);a.storage(!0)},1E3)})},profilegraphic:function(){console.log("twa.profilegraphic()");var a=location.search.match(/\d+$/)[0],c="info_player"===game_data.screen?"player":"tribe",d="http://"+game_data.world+".tribalwarsmap.com/"+game_data.market+"/",a='<table class="vis" width="100%" id="twa-graphic"><tr><th><a href="'+
d+"history/"+c+"/"+a+'">'+e.profilegraphic+' <img src="http://www.hhs.gov/web/images/exit_disclaimer.png"/></a></th></tr><tr><td style="text-align:center"><p><img src="'+(d+"graph/p_"+c+"/"+a)+'"/></p><img src="'+(d+"graph/oda_"+c+"/"+a)+'"/><p><img src="'+(d+"graph/odd_"+c+"/"+a)+'"/></p></td></tr></table>';"player"===c?$(".vis:not([id^=twa]):eq(2)").after("<br/>"+a):$("#content_value > table tr:first").append('<td valign="top">'+a+"</td>")},lastattack:function(){console.log("twa.lastattack()");
if(!$("#show_popup").is(":checked")||!$("#map_popup_attack").is(":checked"))return!1;$(".twa-lastattack").remove();a.mapvillages(function(){$.ajax({url:"game.php?village="+this.id+"&screen=overview&json=1&source=873",dataType:"json",id:this.id,success:function(b){if(b[0].attack){var b=b[0].attack.time.split(/\s[A-z]/)[0].split("."),b=(new Date([b[1],b[0],"20"+b[2]].join(" "))).getTime(),c=$("#serverDate").text().split("/"),c=(new Date([c[1],c[0],c[2],$("#serverTime").text()].join(" "))).getTime(),
d=(new Date(c-b)).getTime(),b=Math.floor(d/31536E6),c=Math.floor(d/864E5),f=Math.floor(d/36E5),d=Math.floor(d/6E4);1==b?b=b+" "+e.lastattack.year:1<b?b=b+" "+e.lastattack.years:1<c?b=c+e.lastattack.days+" "+f%24+"h":0<f?(d%=60,b=(10>f?"0"+f:f)+":"+(10>d?"0"+d:d)+"h"):(d=10>d?"0"+d:d,b="00:"+d+"m");a.mapelement({vid:this.id,html:b,Class:"twa-lastattack",pos:[25,2]},{width:45,height:10,fontSize:8,borderRadius:5,color:"#fff",textAlign:"center",background:"#111",border:"1px solid #000",opacity:0.7})}}})});
return!0},mapgenerator:function(){console.log("twa.mapgenerator()");var a,c=/ally/.test(game_data.mode)?"t":"p",d="00ff00 999999 823c0a b40000 f40000 0000f4 880088 f0c800 00a0f4 ff8800 ffff00 e0d3b8 04b45f 04b4ae 81f7f3 be81f7 fa58f4 ff0088 ffffff f7be81".split(" "),f=120,h=500,g=500;if(/con/.test(game_data.mode)){a=$("#con_player_ranking_table, #con_ally_ranking_table");var f=320,i=$("h3").html().match(/\d+/)[0],i=1===i.length?"0"+i:i,h=i[1]+"50",g=i[0]+"50"}else/kill/.test(game_data.mode)?a=$("#kill_player_ranking_table, #kill_ally_ranking_table").next():
"awards"===game_data.mode?a=$("#award_ranking_table"):("t"===c&&$("#ally_ranking_table tr:first th:eq(1)").width(150),a=$("#player_ranking_table, #ally_ranking_table"));a.find("tr:not(:first)").each(function(a){$("td:eq(1)",this).prepend('<input class="map-item" type="checkbox" style="margin:0px;margin-right:20px" color="'+d[a]+'" id="'+$("a",this).attr("href").match(/\d+$/)[0]+'"/>')}).eq(-1).after('<tr><td colspan="8"><input type="button" id="twa-mapgenerator" value="'+e.mapgenerator.generate+'"/> <label><input type="checkbox" id="checkall"/> <strong>'+
e.mapgenerator.selectall+"</strong></label></td></tr>");$("#twa-mapgenerator").click(function(){var a="http://"+game_data.market+".twstats.com/"+game_data.world+"/index.php?page=map&";$(".map-item").each(function(b){b++;$(this).is(":checked")&&(a+=c+"i"+b+"="+this.id+"&"+c+"c"+b+"="+$(this).attr("color")+"&")});a+="zoom="+f+"&centrex="+h+"&centrey="+g+"&nocache=1&fill=000000&grid=1&kn=1&bm=1";window.open(a)});$("#checkall").click(function(){$(".map-item").attr("checked",this.checked)})},tooltipgraphic:function(){console.log("twa.tooltipgraphic()");
$("#content_value a[href*=info_player], #content_value a[href*=info_ally]").each(function(){if(this.href.match(/\d+$/)){var a="http://"+game_data.world+".tribalwarsmap.com/"+game_data.market+"/graph/p_"+(/info_player/.test(this.href)?"player":"tribe")+"/"+this.href.match(/\d+$/)[0];(new Image).src=a;this.title='<img src="'+a+'">';$(this).tooltip({track:!0,showURL:!1})}});$("#tooltip").css("max-width",323).addClass("twa-tooltipgraphic")},reportfilter:function(){console.log("twa.reportfilter()");$("#report_list").before('<table class="vis" width="100%"><tr><th>'+
e.reportfilter.search+' <input type="text" id="twa-reportfinder" style="padding:1px 2px;border:1px solid silver;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/></th></tr></table>');$("#twa-reportfinder").keyup(function(){var a=this.value.toLowerCase();$("#report_list tr:not(:first, :last)").each(function(){$(this)[0>$(this).text().toLowerCase().indexOf(a)?"hide":"show"]()})});selectAll=function(a,c){$("#report_list tr:not(:first, :last):visible input[type=checkbox]").attr("checked",
c)}},villagefilter:function(){console.log("twa.villagefilter()");var a=".overview_table tr:not(:first)",c="span[id^=label_text]";switch($("#overview").val()){case "units":a=".overview_table tbody";break;case "commands":case "incomings":a=".overview_table tr.nowrap",c="span[id^=labelText]"}$("#twa-overviewtools").show().append("<tr><td>"+e.villagefilter.search+' <input type="text" id="twa-villagefilter" style="padding:1px 2px;border:1px solid silver;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/></td></tr>');
$("#twa-villagefilter").keyup(function(){var d=this.value.toLowerCase();$(a).each(function(){$(this)[0>$(c,this).text().toLowerCase().indexOf(d)?"hide":"show"]()})});window.selectAll=function(a,b){$(".overview_table tr.nowrap:visible input[type=checkbox]").attr("checked",b)}},troopcounter:function(){console.log("twa.troopcounter()");$("#units_table").after('<table id="twa-troopcounter" class="vis" style="width:100%;margin:0 auto"><thead>'+$("#units_table thead").html()+"</thead><tbody>"+$("#units_table tbody:first").html()+
"</tbody></table>");for(var a={},c=document.getElementById("twa-troopcounter"),d=document.getElementById("units_table").getElementsByTagName("tr")[0].getElementsByTagName("img"),f=document.getElementById("units_table").getElementsByTagName("tbody"),e=c.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),g=0;g<d.length;g++)a[d[g].src.match(/_(\w+)\.png/)[1]]=[[g+2,0],[g+1,0],[g+1,0],[g+1,0]];for(g=0;g<f.length;g++)for(var d=f[g].getElementsByTagName("tr"),i=0;i<d.length;i++)for(var j in a)a[j][i][1]+=
Number(d[i].getElementsByTagName("td")[a[j][i][0]].innerHTML);$("td:first",c).empty().width($("#units_table td:first").width());$("th:first",c).html("Contagem de Tropas:");$("th:last, td:has(a)",c).remove();for(g=0;g<e.length;g++)for(j in a)c=e[g].getElementsByTagName("td")[a[j][g][0]],c.className="unit-item"+(0==a[j][g][1]?" hidden":""),c.innerHTML=a[j][g][1]},reportcalc:function(){console.log("twa.reportcalc()");if(!$("#twa-reportcalc").length){$("table[width=470]").before('<table class="vis" width="470" id="twa-reportcalc"><tbody><tr><th>'+
e.reportcalc.neededunits+'</th></tr><tr><td align="center"><label><input type="checkbox" id="twa-currentvillage"> '+e.reportcalc.currentvillage+'</label></td></tr><tr><td align="center" id="twa-units"></td></tr><tr><th>'+e.reportcalc.unitscalc+' <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></th></tr><tr><td align="center" id="twa-unitscalc" style="font-weight:bold"></td></tr><tr><td align="center" id="twa-attack"><a href="#">\u00bb '+
e.reportcalc.attack+"</a></td></tr></tbody></table>");$(document).ajaxStart(function(){$("#twa-loader").show()}).ajaxStop(function(){$("#twa-loader").hide()});$("#twa-units input").change(function(){$("#twa-unitscalc > span, #twa-attack").hide();a.reportcalc()});var b=document.getElementById("twa-unitscalc"),c=document.getElementById("twa-units"),d;for(d in a.data.units)b.innerHTML+='<span id="twa-'+d+'"><img src="http://cdn.tribalwars.net/graphic/unit/unit_'+d+'.png"/> <span></span></span> ',c.innerHTML+=
'<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+d+'.png"q><input type="checkbox"'+("spear"===d||"archer"===d||"spy"===d||"ligth"===d||"marcher"===d||"knight"===d?' checked="true"':"")+' class="'+d+'"/>';$("#twa-unitscalc > span, #twa-attack").hide().last().click(function(){$.post(game_data.link_base_pure.replace("en=","en=place&try=confirm").replace(/village=\d+/,"village="+t),$.extend({x:v[0],y:v[1],attack:!0},k),function(a){var b=$("#error",a);if(b.text())return alert(e.reportcalc.error+
" "+b.text());a=$("form",a);$.post(a[0].action,a.serialize(),function(){alert(e.reportcalc.success)})});return!1})}var b=$("#attack_spy tr:first td").text().trim().replace(/\./g,"").split(" "),c=$("#attack_spy tr:eq(1) td").text().replace(/\t/g,"").split("\n"),c=c.splice(1,c.length-2),f={};$.each(c,function(){var b=this.split(/\s\(/),c=b[1].match(/\d+/);f[a.data.builds[b[0]]]=Number(c)});var c=0===f.hide?0:Math.round(150*Math.pow(40/3,(f.hide-1)/9)),h=(0===f.storage?1E3:Math.round(1E3*Math.pow(400,
(f.storage-1)/29)))-c,c=$(".nopad table:eq(1) tr:eq(1) td:last").text().split("."),c=(new Date([c[1],c[0],"20"+c[2]].join(" "))).getTime();d=$("#serverDate").text().split("/");d=(new Date([d[1],d[0],d[2],$("#serverTime").text()].join(" "))).getTime();var g=(new Date(d-c)).getTime(),i=Math.floor(g/36E5),j=Math.floor(g/6E4)%60,c=$("#attack_info_att tr:eq(1) a").text().match(/ \((\d+)\|(\d+)\) \w+ $/);d=$("#attack_info_def tr:eq(1) a").text().match(/ \((\d+)\|(\d+)\) \w+ $/);for(var c=Math.sqrt(Math.pow(Number(c[1])-
Number(d[1]),2)+Math.pow(Number(c[2])-Number(d[2]),2)),l=0,k={},q=[f.wood,f.stone,f.iron],p="knight light marcher heavy spear axe archer sword".split(" "),s=d=0;s<p.length;s++)a.data.units[p[s]]&&(g=a.data.units[p[s]].speed*(c/a.data.world.unit_speed),i=Math.floor(g/3600),j=Math.floor((g-3600*i)/60),g=parseFloat(i+"."+j),g>d&&(d=g));var w=String(d).split(".");b.map(function(b,c){var d=0===q[c]?5*a.data.world.speed:Math.round(30*Math.pow(80,(q[c]-1)/29))*a.data.world.speed,b=Number(b),b=b+(i*d+j*(d/
60)+w[0]*d+w[1]*(d/60));b>h&&(b=h);l+=b});var b=$("#attack_info_att a:first").attr("href").match(/\d+/),c=$("#attack_info_att tr:eq(1) a").attr("href").match(/\d+$/),v=$("#attack_info_def a[href*=info_village]").text().match(/.*\((\d+)\|(\d+)\)\sK\d{1,2}/).slice(1,3),t=game_data.village.id;b===game_data.player.id&&(t=$("#twa-currentvillage:checked").length?curvid:c);$.get(game_data.link_base_pure.replace(/village=\d+/,"village="+t)+"place",function(b){for(var b=a.currentunits(b),c=0;c<p.length;c++){var d=
p[c];if(a.data.units[d]&&$("#twa-units ."+d+":checked").length){var f=a.data.units[d].carry,e=b[d]*f;if(0!==b[d])if(e>=l){k[d]=l/f;break}else k[d]=e>l?f/l:b[d],l-=e;!k.spy&&($(".twa-units input[value=spy]:checked").length&&0<b.spy)&&(k.spy=4<b.spy?5:b.spy)}}for(d in k)$("#twa-"+d).show().find("span").html(k[d]);$("#twa-attack")[$.isEmptyObject(k)?"hide":"show"]()})},addcheckbox:function(){console.log("twa.addcheckbox()");$(".overview_table tr").each(function(a){a?(a=$('a[href*="village="]:first',
this).attr("href").match(/village=(\d+)/)[1],$(this).prepend('<td><input type="checkbox" name="village_ids[]" class="addcheckbox" style="margin:0px" value="'+a+'"/></td>')):$(this).prepend("<th></th>")})},selectvillages:{init:function(){console.log("twa.selectvillages()");var b=$("#overview").val()||"default",c=a.selectvillages.modes,d=!1,f;for(f in c)b===c[f][0]&&(d=!0);d&&$("#twa-overviewtools").show().append("<tr><td>"+e.selectvillages.selectvillages+' <span id="twa-selectvillages"></span></td></tr>');
$('#combined_table tr:first th:has(img[src*="unit/unit"]) img').each(function(){a.selectvillages.tools.unitsorder.push(this.src.match(/unit_(\w+)/)[1])});for(f in c)if(b===c[f][0])c[f][1]()},modes:{unitsattack:["combined",function(){var b=$("#combined_table tr:not(:first)");$('<input type="checkbox" id="twa-selectvillages-unitsattack">').change(function(){for(var c=0;c<b.length;c++){var d=a.selectvillages.tools.getunits(b[c]),f=a.selectvillages.tools.getpop("att",d),d=a.selectvillages.tools.getpop("def",
d);f>d&&$(".addcheckbox",b[c]).attr("checked",this.checked)}}).add(' <label for="twa-selectvillages-unitsattack">'+e.selectvillages.unitsattack+"</label>").appendTo("#twa-selectvillages")}],unitsdefence:["combined",function(){var b=$("#combined_table tr:not(:first)");$('<input type="checkbox" id="twa-selectvillages-unitsdefence">').change(function(){for(var c=0;c<b.length;c++){var d=a.selectvillages.tools.getunits(b[c]),f=a.selectvillages.tools.getpop("att",d),d=a.selectvillages.tools.getpop("def",
d);f<d&&$(".addcheckbox",b[c]).attr("checked",this.checked)}}).add(' <label for="twa-selectvillages-unitsdefence">'+e.selectvillages.unitsdefence+"</label>").appendTo("#twa-selectvillages")}],unitsnob:["combined",function(){var b=$("#combined_table tr:not(:first)");$('<input type="checkbox" id="twa-selectvillages-unitsnob">').change(function(){for(var c=0;c<b.length;c++)0<a.selectvillages.tools.getunits(b[c]).snob&&$(".addcheckbox",b[c]).attr("checked",this.checked)}).add(' <label for="twa-selectvillages-unitsnob">'+
e.selectvillages.unitsnob+"</label>").appendTo("#twa-selectvillages")}]},tools:{getunits:function(b){for(var b=$(".unit-item",b),c={},b=b.add(b.next().last()),d=0;d<a.selectvillages.tools.unitsorder.length;d++)c[a.selectvillages.tools.unitsorder[d]]=Number(b.eq(d).text());return c},getpop:function(b,c){var d=0;switch(b){case "att":for(var f=0;f<a.selectvillages.tools.unitsatt.length;f++)var e=a.selectvillages.tools.unitsatt[f],d=d+c[e]*a.data.units[e].pop;break;case "def":for(f=0;f<a.selectvillages.tools.unitsdef.length;f++)e=
a.selectvillages.tools.unitsdef[f],d+=c[e]*a.data.units[e].pop;break;case "all":for(f in c)d+=c[f]*a.data.units[c[f]].pop}return d},unitsatt:"axe light marcher ram catapult knight snob".split(" "),unitsdef:["light","sword","archer","heavy"],unitsorder:[]}},rename:{init:function(a,c,d){console.log("twa.rename()");var f=$(a);".overview_table"!==a&&(f=f.parent());f.before('<table class="vis" width="100%"><tr><th>'+e.rename.rename+" "+c+': <input type="text" id="twa-'+d+'" style="padding:1px 2px;border:1px solid red;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/> <input type="button" value="'+
e.rename.rename+'"/><label><input type="checkbox" id="twa-onlyselected"/> '+e.rename.only+" "+c+" "+e.rename.selected+'</label> <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></th></tr></table>');$(document).ajaxStart(function(){$("#twa-loader").show()}).ajaxStop(function(){$("#twa-loader").hide()})},reports:function(){a.rename.init("#report_list",e.rename.report,"reportrename","o");a.rename._do({entry:"#twa-reportrename",input:"#report_list tr:not(:first, :last):visible input:not([type=checkbox])",
inputChecked:"#report_list tr:not(:first, :last):visible:has(input:checked) input:not([type=checkbox])"})},commands:function(){a.rename.init(".overview_table",e.rename.commands,"commandrename","o");$(".overview_table input[type=checkbox]").removeAttr("disabled");a.rename._do({entry:"#twa-commandrename",input:".overview_table tr:not(:first, :last):visible input[id^=editInput]",inputChecked:".overview_table tr:not(:first, :last):visible:has(input:checked) input[id^=editInput]"})},_do:function(a){function c(c){if(!this.val()||
this.val().length<(a.min||1)||this.val().length>(a.max||255))return this.css("border","1px solid red");this.css("border","1px solid silver");c&&$($("#twa-onlyselected:checked").length?a.inputChecked:a.input).val(this.val()).next().click()}$(a.entry).keyup(function(a){c.call($(this),13===a.keyCode);return!1}).keypress(function(a){return 13!==a.keyCode});$(a.entry).next().click(function(){c.call($(this).prev(),!0)})}},assistentfarm:{id:0,init:function(){console.log("twa.assistentfarm()");$("h3:first").append(' <span id="twa-assistentfarm">('+
e.assistentfarm.auto+")</span>");$("#farm_units").parent().after('<div class="vis" style="overflow:auto;height:100px"><table style="width:100%"><tr id="twa-assistent-log"><th><h4>'+e.assistentfarm.log+"</h4></th></tr></table></div>");a.assistentfarm.prepare()},log:function(b,c){$("#twa-assistent-log").after("<tr><td>"+a.assistentfarm.id++ +': <img src="'+(c?"/graphic/delete_small.png":"/graphic/command/attack.png")+'"/> '+b+"</td></tr>")},prepare:function(){var b=[],c=0;$.get(location.href,function(d){$("#am_widget_Farm table tr[class]",
d).each(function(){b.push(this)});setInterval(function(){a.assistentfarm.attack(b[c]);++c===b.length&&(c=0)},5E3)})},attackHandler:{sendUnits:function(b,c,d){$.ajax({type:"post",url:Accountmanager.send_units_link,data:{target:b,template_id:c},village:d,success:function(b){b=JSON.parse(b);b.success?a.assistentfarm.log(b.success.replace("\n"," ")+" "+e.assistentfarm.onvillage+" "+this.village):b.error&&a.assistentfarm.log(b.error+" "+e.assistentfarm.onvillage+" "+this.village,!0)}})},reportAttack:function(b,
c,d){$.ajax({type:"post",url:Accountmanager.send_units_link_from_report,data:{report_id:c},village:d,success:function(b){b=JSON.parse(b);b.success?a.assistentfarm.log(b.success.replace("\n"," ")+" "+e.assistentfarm.onvillage+" "+this.village):b.error&&a.assistentfarm.log(b.error+" "+e.assistentfarm.onvillage+" "+this.village,!0)}})}},attack:function(b){var c=$(".farm_icon_a:not(.farm_icon_disabled)",b),d=$(".farm_icon_b:not(.farm_icon_disabled)",b),c=$(".farm_icon_c:not(.farm_icon_disabled)",b).length?
10:c.length?8:d.length?9:0,d=$("td:eq("+c+") a",b).attr("onclick").toString().match(/(\d+), (\d+)/);a.assistentfarm.attackHandler[10===c?"reportAttack":"sendUnits"](d[1],d[2],$("td:eq(3) a",b).html())}},autofarm:{init:function(){console.log("twa.autofarm()");var b=a.baseTool("twa-autofarm",e.autofarm.farm,"http://cdn.tribalwars.com.br/graphic/command/attack.png","<style>#twa-autofarm-units input{width:30px;text-align:center}#twa-autofarm-content img{margin-left:5px;margin-right:2px}</style><h2>"+
e.autofarm.autofarm+'</h2><span class="twa-autofarm-options"><table width="100%" class="vis"><tr><td id="twa-autofarm-units"></td></tr><tr><td><strong>'+e.autofarm.coords+'</strong><br/><textarea style="width:584px;height:90px" name="_placefarmcoords">'+a.settings._placefarmcoords.join(" ")+'</textarea></td></tr><tr><td><label><input type="checkbox" name="_placefarmprotect"/> '+e.autofarm.protect+'</label></td></tr><tr><td><label><input type="checkbox" name="_placefarmreplace"/> '+e.autofarm.replace+
'</label></td></tr><tr><th><input type="button" value="'+e.autofarm.start+'" id="twa-autofarm-start"/></th></tr></table><h3>'+e.autofarm.log+'</h3><div style="overflow:auto;height:150px"><table id="twa-autofarm-log" style="width:100%" class="vis"></table></div>'),c=$("#twa-autofarm-units"),d=!1,f;for(f in a.data.units)c.append('<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+f+'.png"/> <input name="'+f+'" style="width:30px"/>');b.find(":input[name]").each(function(){"checkbox"===this.type?
(this.checked=a.settings[this.name],$(this).change(function(){a.settings[this.name]=this.checked;a.storage(!0)})):(this.value="text"===this.type?a.settings._placefarmunits[this.name]||0:a.settings._placefarmcoords.join(" "),$(this).keyup(function(){var b=this;this.value=this.value.replace(/[^0-9\|\s]/g,"").replace(/\s+/," ");clearTimeout(d);d=setTimeout(function(){if("text"===b.type)a.settings._placefarmunits[b.name]=a.autofarm.data[b.name]=b.value;else{for(var c=b.value.split(/\s+/),d=[],e=0;e<c.length;e++)/-?\d{1,3}\|-?\d{1,3}/.test(c[e])&&
d.push(c[e]);a.settings._placefarmcoords=d;a.autofarm.next(!0)}a.storage(!0)},500)}))});$("#twa-autofarm-start").click(function(){a.autofarm.attack()});for(var h in timers)timers[h].reload=!1;for(f in a.data.units)a.autofarm.data[f]=a.settings._placefarmunits[f];a.settings._placefarmindex>=a.settings._placefarmcoords.length&&(a.settings._placnnnefarmindex=0);a.settings._placefarmcoords.length&&(a.autofarm.coord=a.settings._placefarmcoords[a.settings._placefarmindex].split("|"))},log:function(b,c){$("#twa-autofarm-log").prepend("<tr><td><strong>"+
(x.text()+" "+y.text())+':</strong> <img src="'+(c?"/graphic/delete_small.png":"/graphic/command/attack.png")+'"/> '+b+"</td></tr>");return a.autofarm},attack:function(b,c){if(!c&&(a.autofarm.data.x=a.autofarm.coord[0],a.autofarm.data.y=a.autofarm.coord[1],b))for(var d in b)a.autofarm.data[d]=b[d];$.post(game_data.link_base_pure.replace("en=","en=place&try=confirm"),a.autofarm.data,function(b){if($('img[src="/game.php?captcha"]').length)return!1;if($(b).find("#error").text()){var c=a.autofarm.nextreturn(b),
b=a.autofarm.currentunits(b);c&&!b?(!a.autofarm.nolog&&a.autofarm.log(e.autofarm.waitingreturn,!0),console.log(c),a.autofarm.delay(function(){this.attack(!1,!0)},c).nolog=!0):!c&&!b?(!a.autofarm.nolog&&a.autofarm.log(e.autofarm.notroops,!0),a.autofarm.delay(function(){this.attack(!1,!0)},1E4).nolog=!0):b&&a.autofarm.attack(b,!0)}else{if(a.settings._placefarmprotect&&$(b).find("form a[href*=player]").length)return a.autofarm.next();c=$(b).find("form");$.post(c[0].action,c.serialize(),function(){a.autofarm.log(e.autofarm.success.springf(a.autofarm.coord.join("|"))).next();
a.autofarm.nolog=!1})}});return a.autofarm},delay:function(b,c){window.setTimeout(function(){b.call(a.autofarm)},c);return a.autofarm},nextreturn:function(a){var c=$("table.vis:last tr:not(:first)",a),a=c.find("[src*=cancel], [src*=back], [src*=return]"),c=c.find("[src*=attack]"),a=a.length?a:c.length?c:!1,c=c.length?2:1;if(!a)return!1;if(a=a.eq(0).parent().parent().find(".timer").text())return a=a.split(":"),(36E5*a[0]+6E4*a[1]+1E3*a[2])*c},currentunits:function(b){var c={};a.settings._placefarmreplace&&
$(".unitsInput",b).each(function(){var b=this.id.split("_")[2],e=Number($(this).next().text().match(/\d+/)[0]);0!=e&&(a.settings._placefarmunits[b]&&a.settings._placefarmunits[b]>e)&&(c[b]=e)});return!$.isEmptyObject(c)?c:!1},next:function(b){b||a.settings._placefarmindex++;a.settings._placefarmindex>=a.settings._placefarmcoords.length&&(a.settings._placefarmindex=0);a.storage(!0);a.settings._placefarmcoords.length&&(a.autofarm.coord=a.settings._placefarmcoords[a.settings._placefarmindex].split("|"));
b||a.autofarm.attack();return a.autofarm},stop:!0,wait:!1,data:{attack:!0},coord:[],nolog:!1},building:{init:function(){console.log("twa.building()");$("#twa-overviewtools").show().append('<tr id="twa-building"><th><label><input type="radio" checked name="twa-building" id="twa-building-build"/> '+e.building.buildtitle+' <img src="graphic/questionmark.png" width="13" title="'+e.building.buildhelp+'"/></label> <a href="#" id="twa-cancel-builds">\u00bb '+e.building.cancelbuilds+'</a></th></tr><tr><td class="twa-buildings"></td></tr><tr><th><label><input type="radio" name="twa-building" id="twa-building-destroy"/> '+
e.building.destroytitle+' <img src="graphic/questionmark.png" width="13" title="'+e.building.destroyhelp+'"/></label> <a href="#" id="twa-cancel-destroy">\u00bb '+e.building.canceldestroy+'</a></th></tr><tr><td class="twa-buildings"></td></tr><tr><th>'+e.building.help+"</th></tr>");$("#twa-building-build, #twa-building-destroy").click(function(){1===BuildingOverview._display_type&&"twa-building-destroy"===this.id||0===BuildingOverview._display_type&&"twa-building-build"===this.id||BuildingOverview.show_all_upgrade_buildings("twa-building-destroy"===
this.id)});$("#twa-cancel-builds, #twa-cancel-destroy").unbind("click").click(function(){confirm(e.building.confirmcancel.springf("twa-cancel-destroy"===this.id?e.building.demolitions:e.building.buildings))&&a.building.cancel("twa-cancel-destroy"===this.id);return!1});!1===BuildingOverview._display_type?BuildingOverview.show_all_upgrade_buildings():BuildingOverview._display_type&&$("#twa-building-destroy").attr("checked",!0);for(var b=0;2>b;b++){var c=$(".twa-buildings").eq(b),d;for(d in a.data.builds)d=
a.data.builds[d],c.append('<img src="graphic/buildings/'+d+'.png"/> <input type="text" style="width:25px" name="'+d+'" value="'+a.settings[b?"_buildingdestroy":"_buildingbuild"][d]+'"/> ')}$(".twa-buildings").each(function(b){$("input",this).keyup(function(){var c=this;clearTimeout(void 0);setTimeout(function(){a.settings[b?"_buildingdestroy":"_buildingbuild"][c.name]=c.value;a.storage(!0)},2E3)}).keypress(function(a){return 47<a.charCode&&58>a.charCode&&3>this.value.length})});$("#buildings_table tr:first th:has(img[src*=buildings]) a").click(function(){return a.building._do($("img",
this)[0].src.match(/\/([a-z]+)\.png/)[1],BuildingOverview._display_type)})},_do:function(b,c){var d=$("#upgrade_building_link").val(),e=c?5:a.settings._buildingmaxorders,h=Number($(".twa-buildings").eq(c).find("input[name="+b+"]").val());$("#buildings_table tr:not(:first)").each(function(){var a=this.className.match(/\d+/)[0];if(BuildingOverview._upgrade_villages[a].buildings[b])for(var i=$("td:last li:has(.build-status-light[style*="+(c?"red":"green")+']) img[src*="'+b+'.png"]',this),i=Number($(".b_"+
b+" a",this).text())+i.length,j=$("#building_order_"+a+" img").length/2;j<e;j++)(c?i-- >h:i++<h)&&$.ajax({url:d.replace(/village=\d+/,"village="+a),data:{id:b,destroy:c,force:1},async:!1,dataType:"json",success:function(b){if(b.success){if(!$("#building_order_"+a).length){var c=$('<ul class="building_order" id="building_order_'+a+'"></ul>');BuildingOverview.create_sortable(c);$("#v_"+a+" td:last").append(c)}$("#building_order_"+a).html(b.building_orders)}}})});return!1},cancel:function(a){$("li:has(.build-status-light[style*="+
(a?"red":"green")+"]) .build-cancel-icon img").click()}},research:{init:function(){console.log("twa.research()");$(".overview_table").before('<table class="vis" width="100%" id="twa-research"><tr><th>'+e.research.help+' <a href="#" id="twa-research-cancel">\u00bb '+e.research.cancel+"</a></th></tr></table>");$("#twa-research-cancel").click(function(){confirm(e.research.confirmcancel)&&a.research.cancel();return!1});$("#techs_table tr:first a:has(img)").click(function(){return a.research._do(this.href.match(/order=(\w+)/)[1])})},
_do:function(a){for(var c=document.getElementById("techs_table").getElementsByTagName("tr"),d=1;d<c.length;d++){var e=c[d].id.split("_")[1];document.getElementById(e+"_"+a)&&$.ajax({type:"post",url:TechOverview.urls.ajax_research_link.replace(/village=\d+/,"village="+e),data:{tech_id:a},dataType:"json",vid:e,success:function(c){c.success&&(document.getElementById("village_tech_order_"+this.vid).innerHTML=c.tech_order,TechOverview.change_dot($("#"+this.vid+"_"+a),this.vid,a,"brown"),game_data.village.id==
this.vid&&($("#wood").html(c.resources[0]),$("#stone").html(c.resources[1]),$("#iron").html(c.resources[2]),startTimer()))}})}return!1},cancel:function(){$("#techs_table div.tech-cancel-icon img").each(function(){var a=this.onclick.toString().match(/cancel_research_order\((\d+), (\d+), '(\w+)'\)/);$.ajax({url:TechOverview.urls.ajax_cancel_tech_order_link.replace(/village=\d+/,"village="+a[1]),dataType:"json",type:"post",data:{tech_order_id:a[2]},name:a[3],vid:a[1],success:function(a){a.success&&(document.getElementById("village_tech_order_"+
this.vid).innerHTML=a.tech_order,TechOverview.restore_dot(this.vid,this.name))}})})}},memo:{init:function(){console.log("twa.memo()");var b=a.baseTool("twa-memo",e.memo.memo,"http://cdn.tribalwars.net/graphic/overview/note.png",'<textarea style="width:400px;height:150px"></textarea><br/><input type="button" value="'+e.memo.save+'"/> <span id="twa-memo-time" style="font-style:italic;font-size:10px"></span> <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px"/>',410);b.find("input").click(function(){b.find("img").is(":visible")||
a.memo.edit(b)});a.memo.getContent(function(a,d){$("#twa-memo-time").html("\u00daltima altera\u00e7\u00e3o: "+(d||"nunca."));b.find("textarea").val(a);b.find("img").hide()})},getElement:function(b){var c;$.get(a.linkbase("memo"),function(d){if(a.data.memoid&&$("#"+a.data.memoid,d).length)c=$("#"+a.data.memoid,d);else{var e=6E4;$(".memo_container",d).each(function(){var a=$("textarea",this);a.val().length<e&&(e=a.val().length,c=a)});a.storage("memoid",c[0].id,"data")}b(c)})},getContent:function(b){a.memo.getElement(function(a){a=
a.val().match(/\[twanote\]([^]+)\[\/twanote\-([0-9:\/\s]+)\]/);b.apply(window,a&&a[1]?[a[1],a[2]]:[])})},edit:function(b){b.find("img").show();a.memo.getElement(function(a){var d=$(".server_info span"),d=d[0].innerHTML+" "+d[1].innerHTML;/\[twanote\]([^]+)\[\/twanote\-[0-9:\/\s]+\]/.test(a.val())?a.val(a.val().replace(/\[twanote\]([^]+)\[\/twanote\-[0-9:\/\s]+\]/,"[twanote]"+b.find("textarea").val()+"[/twanote-"+d+"]")):a.val(a.val()+"\n\n[twanote]"+b.find("textarea").val()+"[/twanote-"+d+"]");$("#twa-memo-time").html(e.memo.lastchange.springf(d));
a=a.parentsUntil(".memo_script").last();$.post(a[0].action,a.serialize(),function(){b.find("img").hide()})})}},changegroups:{init:function(){console.log("twa.changegroups()");$("#twa-overviewtools").show().append('<tr id="twa-changegroups"><td>'+e.changegroups.changegroups+' <select id="twa-group" name="selected_group"></select> <input type="submit" value="'+e.changegroups.add+'" name="add_to_group"/> <input type="submit" value="'+e.changegroups.remove+'" name="remove_from_group"/> <input type="submit" value="'+
e.changegroups.move+'" name="change_group"/> <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></td></tr>');$("#twa-changegroups input").click(function(){a.changegroups.change(this)});var b=document.getElementById("twa-group"),c=a.changegroups.getgroups(),d;for(d in c)b.innerHTML+='<option value="'+d+'" name="village_ids[]">'+c[d]+"</option>";$("#combined_table tr.nowrap")},change:function(b){$("#twa-loader").show();var c=$('[name="village_ids[]"], [name=selected_group]').serializeArray();
c.push({name:b.name,value:b.value});console.log(c);$.post(a.linkbase("overview_villages")+"&mode=groups&action=bulk_edit_villages&h="+game_data.csrf,c,function(){$("#twa-loader").hide()})},getgroups:function(){var a={};$("#group_table tr:not(:first, :last) td[id^=show_group] a").each(function(){a[this.href.match(/edit_group=(\d+)/)[1]]=this.innerHTML});return a}},attackplanner:{villages:{},init:function(){function b(){for(var b=0;b<f.length;b++)f[b].value=$.trim(f[b].value);if(f[0].value===f[1].value&&
"xxx|yyy"!==f[0].value&&"xxx|yyy"!==f[1].value)return alert(e.attackplanner.errorequal);if("red"===$("[name=from]")[0].style.borderColor||"red"===$("[name=to]")[0].style.borderColor||"red"===$("[name=time]")[0].style.borderColor)return!1;a.data.attackplanner.lastTime=$("[name=time]")[0].value;a.storage(!0,null,"data");var c=!1,b=f[2].value.split(" "),d=b[1].split("/"),g={target:f[1].value,village:f[0].value,time:(new Date(d[1]+"/"+d[0]+"/"+d[2]+" "+b[0])).getTime(),units:{},support:$("[name=support]").is(":checked")};
j.each(function(){if(this.value||0<Number(this.value))g.units[this.name]=Number(this.value),c=!0});if(!c)return alert(e.attackplanner.errorunits);a.data.attackplanner.commands.push(g);a.attackplanner.update();a.storage(!0,null,"data")}console.log("twa.attackplanner()");var c=a.baseTool("twa-attackplanner",e.attackplanner.planner,"http://cdn.tribalwars.com.br/graphic/command/attack.png","<style>#twa-attackplanner-content td{padding:3px}</style><h2>"+e.attackplanner.attackplanner+"</h2><h3>"+e.attackplanner.addcommand+
'</h3><table class="vis" width="100%"><tr><th colspan="4">'+e.attackplanner.attacker+'</th><th colspan="4">'+e.attackplanner.target+'</th><th colspan="4">'+e.attackplanner.time+'</th><th colspan="4">'+e.attackplanner.support+'</th></tr><tr><td colspan="4"><input value="xxx|yyy" style="width:90px;border:1px solid red" name="from"/></td><td colspan="4"><input style="width:90px;border:1px solid red" value="xxx|yyy" name="to"/></td><td colspan="4"><input name="time" value="'+a.data.attackplanner.lastTime+
'" style="width:200px;border:1px solid #aaa"/></td><td><input name="support" type="checkbox"/></td></tr></table><table width="100%" class="vis"><tr><th colspan="12">'+e.attackplanner.troops+'</th></tr><tr id="twa-units"></tr><tr><td colspan="12"><button name="add">'+e.attackplanner.addcommand+"</button></td></tr></table><h3>"+e.attackplanner.commands+'</h3><table class="vis" width="100%" id="twa-commands"><tr><th>'+e.attackplanner.attacker+"</th><th>"+e.attackplanner.target+"</th><th>"+e.attackplanner.time+
"</th><th>"+e.attackplanner.type+"</th><th>"+e.attackplanner.troops+"</th><th>"+e.attackplanner.remove+"</th></tr></table><h3>"+e.attackplanner.commandssended+'</h3><div style="overflow:auto;height:150px"><table id="twa-attackplanner-log" style="width:100%" class="vis"></table></div>'),d=$("#twa-units"),f=c.find("input").css({fontStyle:"italic",color:"#ccc",textAlign:"center"}).focus(function(){if(("from"===this.name||"to"===this.name)&&"xxx|yyy"===this.value||"time"===this.name&&"hh:mm:ss dd/mm/yyyy"===
this.value)this.value="",$(this).css({fontStyle:"normal",color:"black"})}).blur(function(){""===this.value&&(this.value="time"===this.name?"hh:mm:ss dd/mm/yyyy":"xxx|yyy",$(this).css({fontStyle:"italic",color:"#ccc"}))});c.find("input[name=time]").css({fontStyle:"normal",color:"#000"});var h;$("input[name=from]").change(function(){clearTimeout(h);if("1px solid red"===this.style.border)return!1;var b=this.value;h=setTimeout(function(){a.attackplanner.getvillageinfo(b,function(a){$.get("/game.php?village="+
a.id+"&screen=place",function(a){$(".unitsInput",a).each(function(){var a=$(this).next().text().match(/\d+/)[0];$(".twa-units[name="+this.name+"]").val(0<a?a:"")})})})},500)});var g=$(".server_info:last span"),i;for(i in a.data.units)d.append('<td><img src="http://cdn.tribalwars.net/graphic/unit/unit_'+i+'.png"/> <input style="width:33px;border:1px solid #aaa" class="twa-units" name="'+i+'"/></td>');c.find("button").click(b);var j=$(".twa-units").keydown(function(a){13===a.keyCode&&b()});f.keyup(function(){if(("time"===
this.name?/[^\d\:\/\s]+/g:/[^\d\|]+/g).test(this.value))this.value=this.value.replace("time"===this.name?/[^\d\:\/\s]+/g:/[^\d\|]+/g,"");if("time"===this.name)if(/^(\d{2}:){2}\d\d (\d{2}\/){2}\d{4}$/.test(this.value)){var a=this.value.split(" "),b=a[1].split("/"),a=new Date(b[1]+"/"+b[0]+"/"+b[2]+" "+a[0]),b=g.eq(1).text().split("/"),b=new Date(b[1]+"/"+b[0]+"/"+b[2]+" "+g.eq(0).text());this.style.border="1px solid "+(b>a?"red":"#aaa")}else this.style.border="1px solid red";else this.style.border=
"1px solid "+(/^\d{1,3}\|\d{1,3}$/.test(this.value)?"#aaa":"red")}).keydown(function(a){13===a.keyCode&&b()});a.attackplanner.update(function(){setInterval(function(){a.attackplanner.checkattacks()},1E3)})},update:function(b){a.attackplanner.mailLink?a.attackplanner.updatefn(b):$.get(a.linkbase("mail"),function(c){a.attackplanner.mailLink=a.linkbase("mail")+"&mode=new&action=send&h="+c.match(/"csrf":"(\w+)"/)[1];a.attackplanner.updatefn(b)})},updatefn:function(b){if(a.data.attackplanner.commands.length){var c=
a.data.attackplanner.commands.sort(function(a,b){return a.time-b.time}),d=$("#twa-commands");d.find("tr:not(:first)").remove();for(var f=0;f<c.length;f++){var h=new Date(c[f].time),g=h.getHours(),i=h.getMinutes(),j=h.getSeconds(),l=h.getDay(),k=h.getMonth(),h=h.getFullYear(),q=[],g=10>g?"0"+g:g,i=10>i?"0"+i:i,j=10>j?"0"+j:j,l=10>l?"0"+l:l,k=10>k?"0"+k:k,p;for(p in c[f].units)q.push('<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+p+'.png"/> '+c[f].units[p]);$('<tr id="'+f+'"><td class="coord '+
c[f].village+'"><img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px" class="load"/></td><td class="coord '+c[f].target+'"><img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px" class="load"/></td><td>'+g+":"+i+":"+j+" "+l+"/"+k+"/"+h+"</td><td>"+(c[f].support?e.attackplanner.support:e.attackplanner.attack)+"</td><td>"+q.join(" ")+'</td><td><a href="#" class="remove"><img src="/graphic/delete.png"/></a></td></tr>').appendTo(d).find(".remove").click(function(){a.data.attackplanner.commands.remove(Number($(this).parent().parent().attr("id")));
a.storage(!0,null,"data");a.attackplanner.update();return!1})}d.find(".coord").each(function(){var b=this.className.split(" ")[1];if(a.attackplanner.villages[b]){var c=d.find('td[class="coord '+b+'"]');if(a.attackplanner.villages[b].error)return c.html(e.attackplanner.errorcoords.springf(b));c.html('<a href="'+a.linkbase("info_village")+"&id="+a.attackplanner.villages[b].id+'">'+a.attackplanner.villages[b].name+"</a>")}else a.attackplanner.getvillageinfo(b,function(b,c){var f=d.find('td[class="coord '+
c+'"]');if(b.error)return f.html(e.attackplanner.errorcoords.springf(c));f.html('<a href="'+a.linkbase("info_village")+"&id="+b.id+'">'+b.name+"</a>")})})}else $("#twa-commands tr:not(:first)").remove();b&&b()},getvillageinfo:function(b,c){if(a.attackplanner.villages[b])return c(a.attackplanner.villages[b]);a.attackplanner.villages[b]=!1;$.post(a.attackplanner.mailLink,{extended:0,preview:1,to:game_data.player.name,subject:"0",text:"[coord]"+b+"[/coord]"},function(d){d=$('td[style="background-color: white; border: solid 1px black;"] a',
d);a.attackplanner.villages[b]=d.length?{error:!1,name:d.text(),id:d.attr("href").match(/id=(\d+)/)[1]}:{error:!0};c(a.attackplanner.villages[b],b)})},checkattacks:function(){for(var b=$(".server_info:last span"),c=b.eq(1).text().split("/"),b=(new Date(c[1]+"/"+c[0]+"/"+c[2]+" "+b.eq(0).text())).getTime(),c=a.data.attackplanner.commands.length,d=0;d<a.data.attackplanner.commands.length;d++)b>a.data.attackplanner.commands[d].time&&(a.attackplanner.attack(a.data.attackplanner.commands[d]),a.data.attackplanner.commands.remove(d));
c!==a.data.attackplanner.commands.length&&(a.storage(!0,null,"data"),a.attackplanner.update())},attack:function(b){a.attackplanner.getvillageinfo(b.village,function(c){var d=b.target.split("|"),f=$.extend({x:d[0],y:d[1]},b.units);f[b.support?"support":"attack"]=!0;var c=a.attackplanner.villages[b.village].name,d=a.attackplanner.villages[b.target].name,h="",g;for(g in b.units)h+='<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+g+'.png"/> '+b.units[g]+" ";$.post(game_data.link_base_pure.replace("en=",
"en=place&try=confirm").replace(/village=\d+/,"village="+c.id),f,function(a){var c=$(a).find("#error"),d="<strong>"+($("#serverTime").text()+" "+$("#serverDate").text())+":</strong>";if(c.text())return $("#twa-attackplanner-log").after("<tr><td>"+d+" "+c.text()+"</td></tr>");a=$("form",a);$.post(a[0].action,a.serialize(),function(){$("#twa-attackplanner-log").after("<tr><td>"+d+' <img src="/graphic/command/'+(b.support?"support":"attack")+'.png"/> '+e.attackplanner.success.springf(b.support?e.attackplanner.support:
e.attackplanner.attack,b.village,b.target,h)+"</td></tr>")})})})},id:0},renamevillages:{init:function(){$("#twa-overviewtools").show().append('<tr><td>Renomear aldeias: <input type="text" id="twa-renamevillages" style="padding:1px 2px;border:1px solid red;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/> <a href="http://code.google.com/p/tribalwars-scripts/wiki/Renomeador_de_Aldeias" target="_blank">(M\u00e1scaras)</a> <label><input type="checkbox" id="twa-onlyselected"/> Apenas aldeias selecionadas.</label></td></tr>');
$("#twa-renamevillages").keyup(function(b){var c=$(this);if(!this.value||3>this.value.length)return c.css("border","1px solid red");c.css("border","1px solid silver");13===b.keyCode&&(a.renamevillages.newname=this.value,a.renamevillages.prepare($("#twa-onlyselected").is(":checked")))});$.get(a.linkbase("main"),function(b){a.renamevillages.hkey=$("form",b).attr("action").match(/h=(\w+)/)[1]});game_data.player.premium?a.renamevillages.mode=a.renamevillages.modes[$("#overview").val()]:(a.renamevillages.individual(),
a.renamevillages.mode=a.renamevillages.modes.nopremium[a.settings.overview?a.settings._overviewmode:"nooverview"])},replace:function(b,c){return b.replace(/\{([^}]+)\}/g,function(b,e){var e=e.match(/([^(]+)(?:\s?\(([^)]+)\))?/),h=e[1].toLowerCase(),g=[];e[2]&&(g=$.trim(e[2]).split(/\s*,\s*/));return a.renamevillages.modes.all[h]?a.renamevillages.modes.all[h].apply(this,g):a.renamevillages.mode[h]?a.renamevillages.mode[h].apply($(c),g):b})},prepare:function(b){$(".overview_table tr[class]"+(b?":has(.addcheckbox:checked)":
"")).each(function(b,d){var e=a.renamevillages.replace(a.renamevillages.newname,d);a.renamevillages.rename($("span[id^=edit]",d).attr("id").split("_")[1],e)})},rename:function(b,c){$.post(a.linkbase("main&action=change_name&h="+a.renamevillages.hkey,b),{name:c},function(a){var b=this.url.match(/village=(\d+)/)[1],a=$("form input:first",a).val(),c=$("#label_text_"+b).text().match(/ \(\d+\|\d+\) \w+$/)[0];$("#label_text_"+b).text(a+c)})},individual:function(){$(".overview_table tr[class]").each(function(b,
c){var d=$("span:first",this).attr("id").split("_")[1];$("input:button",this).removeAttr("onclick").click(function(){var b=a.renamevillages.replace($("#edit_input_"+d).val(),c);a.renamevillages.rename(d,b);$("#edit_"+d).hide();$("#label_"+d).show()});var e=$("span:first",this);$("<a>").addClass("rename-icon").click(function(){$("#label_"+d).hide();$("#edit_"+d).show()}).appendTo(e)})},modes:{nopremium:{nooverview:{points:function(){return this.find("td:eq(2)").text()},wood:function(){return this.find("td:eq(3)").text().split(" ")[0]},
stone:function(){return this.find("td:eq(3)").text().split(" ")[1]},iron:function(){return this.find("td:eq(3)").text().split(" ")[2]},storage:function(){return this.find("td:eq(4)").text()},farmused:function(){return this.find("td:eq(5)").text().split("/")[0]},farmtotal:function(){return this.find("td:eq(5)").text().split("/")[1]},current:function(){return $.trim(this.find("td:first").text()).match(/(.*) \(\d+\|\d+\)\s\w{3}.?$/)[1]},x:function(){return $.trim(this.find("td:eq(1)").text()).match(/.* \((\d+)\|\d+\)\s\w{3}.?$/)[1]},
y:function(){return $.trim(this.find("td:eq(1)").text()).match(/.* \(\d+\|(\d+)\)\s\w{3}.?$/)[1]}},production:{points:function(){return this.find("td:eq(1) span:last").text().split(" ")[0]},wood:function(){return this.find("td:eq(2)").text()},stone:function(){return this.find("td:eq(3)").text()},iron:function(){return this.find("td:eq(4)").text()},storage:function(){return this.find("td:eq(5)").text()},farmused:function(){return this.find("td:eq(1) span:last").html().match(/\((\d+)/)[1]},farmtotal:function(){return this.find("td:eq(1) span:last").html().match(/\/(\d+)\)/)[1]},
current:function(){return $.trim(this.find("td:eq(1) a:first").text()).match(/(.*) \(\d+\|\d+\)\s\w{3}.?$/)[1]},x:function(){return $.trim(this.find("td:eq(1) a:first").text()).match(/.* \((\d+)\|\d+\)\s\w{3}.?$/)[1]},y:function(){return $.trim(this.find("td:eq(1) a:first").text()).match(/.* \(\d+\|(\d+)\)\s\w{3}.?$/)[1]}},combined:{points:function(){return this.find("td:eq(1) span:last").text().split(" ")[0]},farmused:function(){return this.find("td:eq(7) a").text().split("/")[0]},farmtotal:function(){return this.find("td:eq(7) a").text().split("/")[1]},
current:function(){return $.trim(this.find("td:eq(1) a:first").text()).match(/(.*) \(\d+\|\d+\)\s\w{3}.?$/)[1]},x:function(){return $.trim(this.find("td:eq(1) a:first").text()).match(/.* \((\d+)\|\d+\)\s\w{3}.?$/)[1]},y:function(){return $.trim(this.find("td:eq(1) a:first").text()).match(/.* \(\d+\|(\d+)\)\s\w{3}.?$/)[1]},unit:function(b){if(!a.data.units[b])return UI.ErrorMessage("Renomeador de Aldeias - Argumento inv\u00e1lido: {unit("+b+")} Correto: {unit(UNIDADE)}"),"{unit(ERROR)}";var c=a.renamevillages.modes.nopremium.combined.unit.cache;
c||(c={},$(".overview_table tr:first th").each(function(a){var b=$("img[src*=unit_]",this);b.length&&(c[b[0].src.match(/unit_(\w+)\./)[1]]=a)}),a.renamevillages.modes.nopremium.combined.unit.cache=c);return this.find("td:eq("+c[b]+")").text()}}},all:{random:function(a,c){a=a||0;c=c||1E4;return isNaN(a)||isNaN(c)?(UI.ErrorMessage("Renomeador de Aldeias - Argumento inv\u00e1lido: {random("+a+", "+c+")} Correto: {random(NUMERO, NUMERO)}"),"{random(ERROR)}"):Math.floor(Math.random()*(Number(c)-Number(a)+
1))+Number(a)}}}},overview:{init:function(){$("#twa-overviewtools").show().append("<tr><td>"+e.overview.changemode+' <select id="twa-overview-modes"></select> ('+e.overview.needreload+")</td></tr>");$("#twa-overview-modes").change(function(){a.settings._overviewmode=this.value;a.storage(!0);a.settings.renamevillages&&(a.renamevillages.mode=game_data.player.premium?a.renamevillages.modes[$("#overview").val()]:a.renamevillages.modes.nopremium[a.settings.overview?a.settings._overviewmode:"nooverview"])});
for(var b in a.overview.modes)$("#twa-overview-modes").append('<option value="'+b+'"'+(a.settings._overviewmode===b?' selected="selected"':"")+">"+e.overview[b]+"</option>");950>$(".maincell").width()&&$("#content_value").prepend("<p><b>"+e.overview.warning+"</b></p>");$(".overview_table").before(a.overview.modes[a.settings._overviewmode]()).remove()},modes:{production:function(){var b=$('<table id="production_table" class="vis overview_table" width="100%"><tr><th width="400px">Aldeia</th><th style="width:50px;text-align:center">Madeira</th><th style="width:50px;text-align:center">Argila</th><th style="width:50px;text-align:center">Ferro</th><th style="width:46px;text-align:center"><span class="icon header ressources"></span></th><th style="width:53px;text-align:center"><img src="http://cdn2.tribalwars.net/graphic/overview/trader.png"/></th><th>Contru\u00e7\u00f5es</th><th>Pesquisas</th><th>Recrutamento</th></tr></table>');
$(".overview_table tr[class]").each(function(){for(var c=$("td:first a",this).attr("href").match(/village=(\d+)/)[1],d=$("td:first",this).clone(),e=Number($("td:eq(1)",this).text()),h=Number($("td:eq(3)",this).text()),g=$("td:eq(2)",this).text().split(" "),i="",j=$("td:eq(4)",this).text(),l=0;3>l;l++)var k=Number(g[l].replace(/\./g,"")),i=i+('<td style="text-align:center;padding:0 2px;font-size:12px">'+k+'<div style="width:100%;height:2px;border:1px solid #aaa"><div style="width:'+100*(k/h)+'%;background:#ccc;height:2px"></div></div></td>');
d.find("span:first").css({display:"block","float":"left"});b.append('<tr class="twa-overview-'+c+'"><td style="line-height:10px;white-space:nowrap">'+d.html()+'<span style="text-align:right;font-size:9px;display:block;float:right;margin-left:30px">'+e+" pontos ("+j+")</span></td>"+i+'<td style="text-align:center">'+h+'</td><td class="market" style="text-align:center"></td><td class="builds" style="text-align:center"></td><td class="research" style="text-align:center"></td><td class="recruit" style="text-align:center"></td></tr>');
$.ajaxSettings.vid=c;$.get(game_data.link_base_pure+"market",function(b){b=$("table.vis th:first",b);$(".twa-overview-"+c+" .market").html(b.length?'<a href="'+a.linkbase("market")+'">'+b.text().match(/\d+\/\d+/)[0]+"</a>":"0/0")});$.get(game_data.link_base_pure+"main",function(a){var b="";$("#buildqueue tr[class]",a).each(function(){b+='<img style="margin-right:2px" src="'+$("#buildings tr:not(:first) td:has(a:contains("+$("td:first",this).text().split(" ")[0]+")) img",a).attr("src")+'" title="'+
$("td:eq(2)",this).text()+'"/>'});$(".twa-overview-"+c+" .builds").html(b)});$.get(game_data.link_base_pure+"train",function(a){var b="";$("#trainqueue_wrap_barracks tr[class]",a).each(function(){var c=$("td:first",this).text().split(" ");b+='<img src="'+$("#train_form table tr[class] td:contains("+c[1]+") img",a).attr("src")+'" title="'+c[0]+'"/>'});$(".twa-overview-"+c+" .recruit").html(b)});$.get(game_data.link_base_pure+"smith",function(a){var b="";$("#current_research tr[class]").each(function(){b+=
'<img src="'+$("#tech_list img[alt="+$("td:first",this).text()+"]",a).attr("src")+'" alt="'+$("td:eq(2)",this).text()+'"/>'});$(".twa-overview-"+c+" .research").html(b)});delete $.ajaxSettings.vid});$(".overview_table").replaceWith(b)},combined:function(){var b="spear sword axe archer spy light marcher heavy ram catapult knight snob militia".split(" "),c='<style>.overview_table th{text-align:center}</style><tr><th width="400px" style="text-align:left">Aldeia</th><th><img src="http://cdn2.tribalwars.net/graphic/overview/main.png"/></th><th><img src="http://cdn2.tribalwars.net/graphic/overview/barracks.png"/></th><th><img src="http://cdn2.tribalwars.net/graphic/overview/stable.png"/></th><th><img src="http://cdn2.tribalwars.net/graphic/overview/garage.png"/></th><th><img src="http://cdn2.tribalwars.net/graphic/overview/smith.png"/></th><th><img src="http://cdn2.tribalwars.net/graphic/overview/farm.png"/></th>',
d;for(d in b){var e=b[d];a.data.units[e]&&(c+='<th><img src="http://cdn2.tribalwars.net/graphic/unit/unit_'+e+'.png"/></th>')}var h=$('<table id="combined_table" class="vis overview_table" width="100%">'+c+'<th><img src="http://cdn2.tribalwars.net/graphic/overview/trader.png"/></th></tr></table>');$(".overview_table tr[class]").each(function(){var c=$("td:first a",this).attr("href").match(/village=(\d+)/)[1],d=$("td:first",this).clone(),e=Number($("td:eq(1)",this).text()),f=$("td:eq(4)",this).text(),
d='<td style="line-height:10px;white-space:nowrap">'+d.html()+'<span style="text-align:right;font-size:9px;display:block;float:right;margin-left:30px">'+e+' pontos</span></td><td class="main"></td><td class="barracks"></td><td class="stable"></td><td class="garage"></td><td class="smith"></td><td><a href="'+a.linkbase("farm",c)+'">'+f+"</a></td>",k;for(k in b)e=b[k],a.data.units[e]&&(d+='<td class="unit-item '+e+'"></td>');h.append('<tr class="'+this.className+" twa-overview-"+c+'">'+d+'<td class="market"></td></tr>');
$.get(a.linkbase("main"),function(a){var b=$("<img/>").attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_avail.png"),d=[],a=$("#buildqueue tr[class]",a),e=a.length;a.each(function(a){b.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_running.png");a===e-1?d.push($("td:first",this).text().match(/(\w+) \(/)[1]+" - "+$("td:eq(2)",this).text()):d.push($("td:first",this).text().match(/(\w+) \(/)[1])});0===e?b.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_impossible.png"):
b.attr("title",d.join(", "));$(".twa-overview-"+c+" .main").html(b)});$.get(a.linkbase("train"),function(b){var d={};$("#train_form tr[class]",b).each(function(){var a=$("td:first img",this).attr("src").match(/unit_(\w+)\./)[1];d[a]=Number($("td:eq(6)",this).text().split("/")[0])});for(var e in a.data.units)if("undefined"===typeof d[e])$(".twa-overview-"+c+" ."+e).html("0").addClass("hidden");else{var f=$(".twa-overview-"+c+" ."+e).html(d[e]);0===d[e]&&f.addClass("hidden")}var h=$("<img/>").attr("src",
"http://cdn2.tribalwars.net/graphic/overview/prod_avail.png"),i=[];e=$("#trainqueue_wrap_barracks tr[class]",b);var j=e.length;e.each(function(a){h.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_running.png");a===j-1?i.push($("td:first",this).text()+" - "+$("td:eq(2)",this).text()):i.push($("td:first",this).text())});0===j?h.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_impossible.png"):h.attr("title",i.join(", "));$(".twa-overview-"+c+" .barracks").html(h);var k=$("<img/>").attr("src",
"http://cdn2.tribalwars.net/graphic/overview/prod_avail.png"),l=[];e=$("#trainqueue_wrap_stable tr[class]",b);var n=e.length;e.each(function(a){k.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_running.png");a===n-1?l.push($("td:first",this).text()+" - "+$("td:eq(2)",this).text()):l.push($("td:first",this).text())});0===n?k.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_impossible.png"):k.attr("title",l.join(", "));$(".twa-overview-"+c+" .stable").html(k);var m=$("<img/>").attr("src",
"http://cdn2.tribalwars.net/graphic/overview/prod_avail.png"),u=[],b=$("#trainqueue_wrap_garage tr[class]",b),r=b.length;b.each(function(a){m.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_running.png");a===r-1?u.push($("td:first",this).text()+" - "+$("td:eq(2)",this).text()):u.push($("td:first",this).text())});0===r?m.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_impossible.png"):m.attr("title",u.join(", "));$(".twa-overview-"+c+" .garage").html(m)});$.get(a.linkbase("smith"),
function(a){var b=$("<img/>").attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_avail.png"),d=[],a=$("#current_research tr[class]",a),e=a.length;a.each(function(a){b.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_running.png");a===e-1?d.push($("td:first",this).text()+" - "+$("td:eq(2)",this).text()):d.push($("td:first",this).text())});0===e?b.attr("src","http://cdn2.tribalwars.net/graphic/overview/prod_impossible.png"):b.attr("title",builds.join(", "));$(".twa-overview-"+
c+" .smith").html(b)});$.get(a.linkbase("market"),function(b){b=$("#content_value table:eq(3) th:first",b);if(!b.length)return $(".twa-overview-"+c+" .market").text("-");$(".twa-overview-"+c+" .market").html('<a href="'+a.linkbase("market")+'">'+b.text().split(" ")[1]+"</a>")})});return h}}}};$("#header_info").after('<table id="header_info" class="twa-bar" style="display:none" cellspacing="0" align="left"><tr></tr></table>');var n={settings:"TWASettings"+game_data.player.id,data:"TWAData"+game_data.player.id};
a.settings=localStorage[n.settings]?JSON.parse(localStorage[n.settings]):!1;a.data=localStorage[n.data]?JSON.parse(localStorage[n.data]):!1;var m;!a.settings||!a.data?m=!0:a.data.version!==a.version?(a.data.version=a.version,a.oldSettings=a.settings,a.oldData=a.data,UI.SuccessMessage("TWA - Vers\u00e3o "+a.version+". Veja as novidades da nova vers\u00e3o no site do script!",6E3),m=!0):m=void 0;m&&(localStorage[n.settings]=JSON.stringify(a.settings=$.extend({mapcoords:!0,profilecoords:!0,_profilecoordsmin:0,
_profilecoordsmax:12500,_mapplayers:!0,_mapplayersmin:0,_mapplayersmax:1E3,_mapabandoneds:!0,_mapabandonedsmin:0,_mapabandonedsmax:12500,mapidentify:!0,mapmanual:!0,lastattack:!0,rankinggraphic:!0,allygraphic:!0,profilestats:!0,reportfilter:!0,villagefilter:!0,reportrename:!0,commandrename:!0,troopcounter:!0,mapgenerator:!0,reportcalc:!0,assistentfarm:!0,_placefarmprotect:!0,_placefarmreplace:!1,_placefarmindex:0,_placefarmunits:{},_placefarmcoords:[],building:!0,_buildingbuild:{main:20,barracks:25,
stable:20,garage:10,snob:1,smith:20,place:1,statue:1,market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,wall:20},_buildingdestroy:{main:20,barracks:25,stable:20,garage:10,snob:1,smith:20,place:1,statue:1,market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,wall:20},_buildingmaxorders:5,research:!0,memo:!0,changegroups:!0,attackplanner:!0,selectvillages:!0,overview:!0,_overviewmode:"production",renamevillages:!0},a.oldSettings||{})),localStorage[n.data]=JSON.stringify(a.data=$.extend({version:a.version,
attackplanner:{commands:[],lastTime:$("#serverTime").text()+" "+$("#serverDate").text()}},a.oldData||{})));m={pt:{config:{tooltip:{mapcoords:"Permite obter coordenadas do mapa.",profilecoords:"Permite obter coordenadas de aldeias apartir do perfil de um jogador.",mapidentify:"Adiciona uma marca\u00e7\u00e3o nas aldeias que foram obtidas coordenadas.",mapmanual:"Permite obter coordenadas de aldeias no mapa clicando nelas.",rankinggraphic:"Mostra um gr\u00e1fico de pontua\u00e7\u00e3o na classifica\u00e7\u00e3o ao passar o mouse sobre o nome de algum jogador ou tribo.",
allygraphic:"Mostra um gr\u00e1fico de pontua\u00e7\u00e3o na p\u00e1gina de membros de uma tribo ao passar o mouse sobre o nome de algum jogador.",profilestats:"Mostra uma \u00e1rea com v\u00e1rios gr\u00e1ficos de um jogador ou uma tribo no perfil do mesmo.",lastattack:"Mostra quanto tempo se passou desde o \u00faltimo ataque no mapa.",reportfilter:"Mostra um campo de pesquisa por t\u00edtulo na p\u00e1gina de relat\u00f3rios.",villagefilter:"Mostra um campo de pesquisa na visualiza\u00e7\u00e3o para pesquisar aldeias por nome.",
reportrename:"Mostra um campo na p\u00e1gina de relat\u00f3rios para renomear todos ou apenas os selecionados.",commandrename:"Mostra um campo na visualiza\u00e7\u00e3o para renomear todas os comandos de apenas uma vez.",villagerename:"Mostra um campo na visualiza\u00e7\u00e3o das aldeias para renomear todas as aldeias de apenas uma vez.",mapgenerator:"Gera mapas do TW Stats direto da classifica\u00e7\u00e3o permitindo selecionar os jogadores ou tribos que estaram incluidos no mapa.",reportcalc:"Faz o calculo da quantidade de recursos que tem atualmente em uma aldeia apartir de um relat\u00f3rio de espionagem e mostra a quantidade de tropas necess\u00e1rias para farmar.",
troopcounter:"Faz o calculo da quantidade de tropas que tempo todas as aldeias visiveis em visualiza\u00e7\u00f5es > tropas. A quantidade \u00e9 mostrada no final da p\u00e1gina.",assistentfarm:"Faz ataques autom\u00e1ticos apartir da p\u00e1gina do Assistente de Farm.",building:"Faz constru\u00e7\u00f5es e demoli\u00e7\u00f5es em massa na visualiza\u00e7\u00e3o dos edif\u00edcios.",research:"Faz pesquisas em massa apartir da p\u00e1gina de visualiza\u00e7\u00e3o de pesquisas (apenas ferreiro simples, por enquanto).",
changegroups:"Permite alterar grupos em massa apartir de qualquer p\u00e1gina das visualiza\u00e7\u00f5es.\t",memo:"Mostra area para lembretes na p\u00e1gina.",attackplanner:"Faz ataques programados com hor\u00e1rio automaticamente. Obs.: \u00e9 preciso deixar uma aba com o script rodando no jogo para os ataques serem efetuados!",selectvillages:"Fun\u00e7\u00e3o para selecionar aldeias especificas na visualiza\u00e7\u00e3o, como aldeias com tropas de ataque, defesa, com nobres e etc..."},title:"Relaxeaza TWAdvanced v{0}",
coords:"Coordenadas",mapcoords:"Obter coordenadas do mapa.",profilecoords:"Obter coordenadas por perfil.",mapidentify:"Identificar ao obter coordenadas",mapmanual:"Obter coordenadas manualmente",graphicstats:"Gr\u00e1ficos & Estat\u00edsticas",rankinggraphic:"Gr\u00e1fico de pontua\u00e7\u00e3o na classifica\u00e7\u00e3o.",allygraphic:"Gr\u00e1fico de pontua\u00e7\u00e3o em membros da tribo.",profilestats:"Mostrar estat\u00edsticas de um jogador/tribo no perfil.",lastattack:"Mostrar tempo do \u00faltimo ataque no mapa.",
reportfilter:"Campo de pesquisa nos relat\u00f3rios.",villagefilter:"Pesquisa de aldeias na visualiza\u00e7\u00e3o.",reportrename:"Campo para renomear relat\u00f3rios.",commandrename:"Campo para renomear comandos na visualiza\u00e7\u00e3o.",villagerename:"Campo para renomear aldeias na visualiza\u00e7\u00e3o.",mapgenerator:"Gerar mapa apartir da classific\u00e3o.",reportcalc:"Calcula recursos exatas em uma aldeia.",troopcounter:"Calcula a quantidade de tropas.",assistentfarm:"Assistente de Farm autom\u00e1tico.",
building:"Constru\u00e7\u00e3o/demoli\u00e7\u00e3o em massa.",research:"Pesquisa em massa.",changegroups:"Alterar grupos na visualiza\u00e7\u00e3o.",memo:"Lembrete.",attackplanner:"Planeador de ataques.",selectvillages:"Selecionador de aldeias.",save:"As configura\u00e7\u00f5es foram salvas!"},mapcoords:{getcoords:"Coordenadas obtidas",update:"Atualizar",mapplayers:"Obter coordenadas de jogadores.",min:"M\u00ednimo",max:"M\u00e1ximo",mapabandoneds:"Obter coordenadas de abandonadas."},mapmanual:{getcoords:"Coordenadas obtidas manualmente"},
profilecoords:{everycoords:"Todas coordenadas",min:"Pontua\u00e7\u00e3o m\u00ednima.",max:"Pontua\u00e7\u00e3o m\u00e1xima."},profilegraphic:{stats:"Estat\u00edsticas"},lastattack:{year:"ano",years:"anos",days:"d"},mapgenerator:{generate:"Gerar mapa",selectall:"Selecionar todos"},reportfilter:{search:"Pesquisar relat\u00f3rios:"},villagefilter:{search:"Pesquisar aldeias:"},reportcalc:{neededunits:"Unidades necess\u00e1rias:",currentvillage:"Usar unidades da aldeia atual",unitscalc:"Unidades calculadas:",
attack:"Atacar com essas tropas",error:"Ocorreu o seguinte erro ao enviar o ataque:",success:"Ataque enviado com sucesso!"},selectvillages:{selectvillages:"Selecionar aldeias:",unitsattack:"com tropas de ataque",unitsdefence:"com tropas de defesa",unitsnob:"com nobres"},rename:{rename:"Renomear",only:"Apenas",selected:"selecionados",report:"relat\u00f3rios",villages:"aldeias",commands:"comandos"},assistentfarm:{auto:"Autom\u00e1tico",log:"Farm Assistent Log",onvillage:"na aldeia"},autofarm:{farm:"Farmador",
autofarm:"Farmador Autom\u00e1tico",coords:"Coordenadas:",protect:"Prote\u00e7\u00e3o - N\u00e3o enviar ataques caso a aldeia tenha dono.",replace:"Substitui\u00e7\u00e3o - Caso n\u00e3o tenha tropas sulficientes usar o que tiver.",start:"Iniciar ataques",pause:"Pausar ataques",log:"Log de ataques:",waitingreturn:"N\u00e3o h\u00e1 tropas na aldeia no momento. Aguardando tropas retornarem!",notroops:"N\u00e3o existem tropas na aldeia.",success:"Ataque enviado na aldeia {0}."},building:{buildtitle:"Constru\u00e7\u00e3o em Massa - Edif\u00edcios",
buildhelp:"Os edif\u00edcios ser\u00e3o construidos at\u00e9 o n\u00edvel indicado abaixo!",cancelbuilds:"Cancelar todas as contru\u00e7\u00f5es",destroytitle:"Demoli\u00e7\u00e3o em Massa - Edif\u00edcios",destroyhelp:"Os edif\u00edcios ser\u00e3o demolidos at\u00e9 o n\u00edvel indicado abaixo!",canceldestroy:"Cancelar todas as demoli\u00e7\u00f5es",help:"Clique no icone dos edif\u00edcios abaixo para iniciar a constru\u00e7\u00e3o em massa do edif\u00edcio clicado.",demolitions:"demoli\u00e7\u00f5es",
buildings:"constru\u00e7\u00f5es",confirmcancel:"Tem certeza que deseja cancelar todas as {0}?"},research:{help:"Clique no icone das unidades abaixo para iniciar a pesquisa em massa da unidade clicada.",cancel:"Cancelar todas as pesquisas",confirmcancel:"Tem certeza que deseja cancelar todas as pesquisas?"},memo:{memo:"Lembrete",save:"Salvar",lastchange:"\u00daltima altera\u00e7\u00e3o: {0}"},changegroups:{changegroups:"Alterar grupos das aldeias selecionadas:",add:"Adicionar",remove:"Remover",move:"Mover"},
attackplanner:{planner:"Planeador",attackplanner:"Planeador de ataque",addcommand:"Adicionar comando",attacker:"Aldeia atacante",target:"Aldeia alvo",time:"Hor\u00e1rio de envio",support:"Apoio",attack:"Ataque",troops:"Tropas",commands:"Comandos",type:"Tipo",remove:"Remover",commandssended:"Comandos enviados",errorequal:"As coordenadas da aldeia atacante n\u00e3o pode ser a mesma da aldeia de destino!",errorunits:"Voc\u00ea n\u00e3o inseriu nenhuma unidade!",errorcoords:"A coordenada {0} n\u00e3o existe.",
success:"{0} enviado da aldeia {1} para a aldeia {2} com as seguintes tropas: {3}"},messages:{messages:"Mensagens",desc:"Area para troca de mensagens com o desenvolvedor (Relaxeaza)",messagetype:"Tipo de menssagem:",type:"Tipo",question:"Pergunta",suggest:"Sugest\u00e3o",bug:"Problema/bug",critic:"Cr\u00edtica",other:"Outros",subject:"Assunto",send:"Enviar",yourmessages:"Suas Mensagens",lastmessage:"\u00daltima mensagem",back:"Voltar",partner:"Parceiro de conversa",reply:"Responder",errortime:"Voc\u00ea s\u00f3 pode enviar uma mensagem a cada 10 segundos."},
overview:{warning:"* A visualiza\u00e7\u00e3o avan\u00e7ada \u00e9 melhor visualizada com a largura da janela acima de 1000px. (Configura\u00e7\u00f5es -> Configura\u00e7\u00f5es)",combined:"Combinado",production:"Produ\u00e7\u00e3o",changemode:"Alterar modo de visualiza\u00e7\u00e3o",needreload:"Necessita atualizar p\u00e1gina"}}};var r="br"===game_data.market?"pt":game_data.market,e=!m[r]?m.pt:m[r];Array.prototype.remove=function(a,c){var d=this.slice((c||a)+1||this.length);this.length=0>a?this.length+
a:a;return this.push.apply(this,d)};$.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,($(window).height()-this.outerHeight())/2+$(window).scrollTop())+"px");this.css("left",Math.max(0,($(window).width()-this.outerWidth())/2+$(window).scrollLeft())+"px");return this};Number.prototype.format=function(){var a=Math.floor(this/6E4)%60,c=this/1E3%60,d=Math.floor(this/36E5)+":";10>a&&(d+="0");d+=a+":";10>c&&(d+="0");return d+c};String.prototype.springf=function(){var a=arguments;
return this.replace(/{(\d+)}/g,function(c,d){return"undefined"!=typeof a[d]?a[d]:c})};a.ready(function(){switch(game_data.screen){case "map":(a.settings._mapplayers||a.settings._mapabandoneds)&&!$("#twa-getcoords").length&&a.mapcoords.init();a.settings.mapmanual&&!$("#twa-mapmanual").length&&a.mapmanual();a.settings.lastattack&&game_data.player.premium&&a.lastattack();break;case "info_player":a.settings.profilecoords&&!$("#twa-profilecoords").length&&a.profilecoords();a.settings.profilestats&&!$("#twa-graphic").length&&
a.profilegraphic();break;case "info_ally":a.settings.profilestats&&!$("#twa-graphic").length&&a.profilegraphic();break;case "info_member":a.settings.allygraphic&&"info_member"===game_data.screen&&!$(".twa-tooltipgraphic").length&&a.tooltipgraphic();break;case "ranking":a.settings.rankinggraphic&&"ranking"===game_data.screen&&!$(".twa-tooltipgraphic").length&&a.tooltipgraphic();a.settings.mapgenerator&&!$("#twa-mapgenerator").length||"awards"!==game_data.mode||"wars"!==game_data.mode||"secrets"!==
game_data.mode&&a.mapgenerator();break;case "overview_villages":var b=$("#overview").val();$(".overview_table").before('<table class="vis" id="twa-overviewtools" style="display:none" width="100%"><tr><th>Tribal Wars Advanced</th></tr></table>');a.settings.overview&&!$("#twa-overview").length&&!game_data.player.premium&&a.overview.init();a.settings.renamevillages&&!$("#twa-villagerename").length&&a.renamevillages.init();a.settings.commandrename&&"commands"===b&&!$("#twa-commandrename").length&&a.rename.commands();
a.settings.villagefilter&&"trader"!==b&&!$("#twa-villagefilter").length&&a.villagefilter();"trader"!==b&&"groups"!==b&&"commands"!==b&&!$(".twa-addcheckbox").length&&a.addcheckbox();a.settings.troopcounter&&"units"===b&&!$("#twa-troopcounter").length&&a.troopcounter();a.settings.changegroups&&game_data.player.premium&&"groups"!==b&&"trader"!==b&&!$("#twa-changegroups").length&&a.changegroups.init();a.settings.building&&"buildings"===b&&!$("#twa-building").length&&a.building.init();a.settings.research&&
"tech"===b&&!$("#twa-research").length&&a.research.init();a.settings.selectvillages&&game_data.player.premium&&a.selectvillages.init();break;case "report":a.settings.reportcalc&&/view\=\d+$/.test(location.href)&&$("#attack_spy").length&&a.reportcalc();a.settings.reportfilter&&!$("#twa-reportfinder").length&&a.reportfilter();a.settings.reportrename&&game_data.player.premium&&!$("#twa-reportrename").length&&a.rename.reports();break;case "am_farm":a.settings.assistentfarm&&game_data.player.farm_manager&&
!$(".error").length&&!$("#twa-assistentfarm").length&&a.assistentfarm.init();break;case "settings":!$("#di").length&&a.config()}a.settings.attackplanner&&!$("#twa-attackplaner").length&&a.attackplanner.init();a.settings.memo&&!$("#twa-memo").length&&a.memo.init();!$("#twa-placefarm").length&&a.autofarm.init()})})();