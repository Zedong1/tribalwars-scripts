/*! Relaxeaza Tribal Wars Advanced v1.4.2 | 20/08/12. */
(function(){function s(a){var b=Math.floor(a/6E4)%60,c=a/1E3%60,a=Math.floor(a/36E5)+":";10>b&&(a+="0");a+=b+":";10>c&&(a+="0");return a+c}var b={baseTool:function(a,b,c,e,f){$("table.twa-bar").show().find("> tbody > tr").append('<td><table class="header-border"><tbody><tr><td><table class="box menu nowrap"><tbody><tr><td class="box-item" style="height: 22px;">'+(c?'<img src="'+c+'" style="position:absolute">':"")+"<a "+(c?'style="margin-left:17px" ':"")+'href="#" id="'+a+'">'+b+'</a></td></tr></tbody></table></td></tr><tr class="newStyleOnly"><td class="shadow"><div class="leftshadow"></div><div class="rightshadow"></div></td></tr></tbody></table></td>');
var f=f?f:$("#content_value").width(),g=$('<div id="'+a+'-content" class="popup_content" style="width:'+f+'px;padding:5px;border:2px solid #840;z-index:999;display:none;position:absolute">'+e+"</div>").appendTo("body").center().css("top",$("#content_value").offset().top);$("#"+a).unbind("click").click(function(){g.toggle();return!1});return g},storage:function(a,d,c){var e=c?l.data:l.settings,c=c?"data":"settings";if(!0===a)localStorage[e]=JSON.stringify(b[c]);else if("string"===typeof a){if(void 0===
d)return b[c][a];b[c][a]=d;localStorage[e]=JSON.stringify(b[c])}else $.isPlainObject(a)&&(localStorage[e]=JSON.stringify($.extend(b[c],a)));return!0},linkbase:function(a){return game_data.link_base_pure.replace("screen=","screen="+a)},ready:function(a){function d(){e===c&&(c&&b.storage(!0,null,"data"),a())}var c=0,e=0;if(!b.data.builds&&++c){var f=function(){b.data.builds={};$.get(b.linkbase("main"),function(a){if($("#hide_completed:checked",a).length)return $.post($("#hide_completed",a).attr("onclick").toString().split("'")[1],
{hide_completed:!1},f);$("#buildings a:has(img[src*=buildings])",a).each(function(){b.data.builds[$(this).text().trim()]=this.href.match(/\=(\w+)$/)[1]});d(++e)})};f()}!b.data.world&&++c&&(b.data.world={},$.get("interface.php?func=get_config",function(a){$("config > *",a).each(function(a,d){4>a?b.data.world[d.nodeName]=$(d).text():$("*",d).each(function(){b.data.world[this.nodeName]=Number($(this).text())})});d(++e)}));!b.data.units&&++c&&(b.data.units={},$.get("interface.php?func=get_unit_info",
function(a){$("config > *",a).each(function(){this.nodeName!=="militia"&&(b.data.units[this.nodeName]={speed:Math.round(Number($("speed",this).text()))*60,carry:Number($("carry",this).text()),pop:Number($("pop",this).text())})});d(++e)}));d()},config:function(){console.log("twa.config()");$("head").append('<style>#di {background:#c1d9ff;border:1px solid #3a5774;font-family:arial;font-size:12px;padding:4px;position:absolute;z-index:99999}#di textarea {border:1px solid #999;width:280px;height:80px;font-size:12px}#di input[type="text"],#di select {border:1px solid #999;width:70px;margin:0 2px;font-size:12px}#di button {border:1px solid #999;margin:3px}#di .di {background:#fff;padding:5px}#di a {color:blue;font-weight:400;text-decoration:underline}#di h1 {background:#e4e4e4;border-bottom:1px solid #c4c4c4;border-top:1px solid #fff;color:#333;font-size:13px;font-weight:700;line-height:20px;margin:0;padding:0 7px}#di p,#di label {margin:3px 0;display:block}#he {background:#e0edfe;cursor:move;font-size:14px;font-weight:700;padding: 4px 20px 4px 10px}#twa-tooltip{display:none;position:absolute;width:300px;padding:4px 4px 3px;background:#000;opacity:0.8;color:#fff;font-size:12px;border:1px solid #000;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}</style>');
$("body").append('<div id="di" style="width:400px"><div id="twa-tooltip"></div><div id="he">Relaxeaza TWAdvanced v'+b.data.version+'</div><div id="co"><h1>Coordenadas</h1><div class="di"><label tooltip="Permite obter coordenadas do mapa."><input type="checkbox" name="mapcoords"/> Obter coordenadas do mapa.</label><label tooltip="Permite obter coordenadas de aldeias apartir do perfil de um jogador."><input type="checkbox" name="profilecoords"/> Obter coordenadas por perfil.</label><label tooltip="Adiciona uma marca\u00e7\u00e3o nas aldeias que foram obtidas coordenadas."><input type="checkbox" name="mapidentify"/> Identificar ao obter coordenadas</label><label tooltip="Permite obter coordenadas de aldeias no mapa clicando nelas."><input type="checkbox" name="mapmanual"/> Obter coordenadas manualmente</label></div><h1>Gr\u00e1ficos & Estat\u00edsticas</h1><div class="di"><label tooltip="Mostra um gr\u00e1fico de pontua\u00e7\u00e3o na classifica\u00e7\u00e3o ao passar o mouse sobre o nome de algum jogador ou tribo."><input type="checkbox" name="rankinggraphic"/> Gr\u00e1fico de pontua\u00e7\u00e3o na classifica\u00e7\u00e3o.</label><label tooltip="Mostra um gr\u00e1fico de pontua\u00e7\u00e3o na p\u00e1gina de membros de uma tribo ao passar o mouse sobre o nome de algum jogador."><input type="checkbox" name="allygraphic"/> Gr\u00e1fico de pontua\u00e7\u00e3o em membros da tribo.</label><label tooltip="Mostra uma \u00e1rea com v\u00e1rios gr\u00e1ficos de um jogador ou uma tribo no perfil do mesmo."><input type="checkbox" name="profilestats"/> Mostrar estat\u00edsticas de um jogador/tribo no perfil.</label></div><h1>Outras Op\u00e7\u00f5es</h1><div class="di"><label tooltip="Mostra quanto tempo se passou desde o \u00faltimo ataque no mapa."><input type="checkbox" name="lastattack"/> Mostrar tempo do \u00faltimo ataque no mapa.</label><label tooltip="Mostra um campo de pesquisa por t\u00edtulo na p\u00e1gina de relat\u00f3rios."><input type="checkbox" name="reportfilter"/> Campo de pesquisa nos relat\u00f3rios.</label><label tooltip="Mostra um campo de pesquisa na visualiza\u00e7\u00e3o para pesquisar aldeias por nome."><input type="checkbox" name="villagefilter"/> Pesquisa de aldeias na visualiza\u00e7\u00e3o.</label><label tooltip="Mostra um campo na p\u00e1gina de relat\u00f3rios para renomear todos ou apenas os selecionados."><input type="checkbox" name="reportrename"/> Campo para renomear relat\u00f3rios.</label><label tooltip="Mostra um campo na visualiza\u00e7\u00e3o para renomear todas os comandos de apenas uma vez."><input type="checkbox" name="commandrename"/> Campo para renomear comandos na visualiza\u00e7\u00e3o.</label><label tooltip="Mostra um campo na visualiza\u00e7\u00e3o das aldeias para renomear todas as aldeias de apenas uma vez."><input type="checkbox" name="villagerename"/> Campo para renomear aldeias na visualiza\u00e7\u00e3o.</label><label tooltip="Gera mapas do TW Stats direto da classifica\u00e7\u00e3o permitindo selecionar os jogadores ou tribos que estaram incluidos no mapa."><input type="checkbox" name="mapgenerator"/> Gerar mapa apartir da classific\u00e3o.</label><label tooltip="Faz o calculo da quantidade de recursos que tem atualmente em uma aldeia apartir de um relat\u00f3rio de espionagem e mostra a quantidade de tropas necess\u00e1rias para farmar."><input type="checkbox" name="reportcalc"/> Calcula recursos exatas em uma aldeia.</label><label tooltip="Faz o calculo da quantidade de tropas que tempo todas as aldeias visiveis em visualiza\u00e7\u00f5es > tropas. A quantidade \u00e9 mostrada no final da p\u00e1gina."><input type="checkbox" name="troopcounter"/> Calcula a quantidade de tropas.</label><label tooltip="Faz ataques autom\u00e1ticos apartir da p\u00e1gina do Assistente de Farm."><input type="checkbox" name="assistentfarm"/> Assistente de Farm autom\u00e1tico.</label><label tooltip="Faz constru\u00e7\u00f5es e demoli\u00e7\u00f5es em massa na visualiza\u00e7\u00e3o dos edif\u00edcios."><input type="checkbox" name="building"/> Constru\u00e7\u00e3o/demoli\u00e7\u00e3o em massa.</label><label tooltip="Faz pesquisas em massa apartir da p\u00e1gina de visualiza\u00e7\u00e3o de pesquisas (apenas ferreiro simples, por enquanto)."><input type="checkbox" name="research"/> Pesquisa em massa.</label><label tooltip="Permite alterar grupos em massa apartir de qualquer p\u00e1gina das visualiza\u00e7\u00f5es."><input type="checkbox" name="changegroups"/> Alterar grupos na visualiza\u00e7\u00e3o.</label><label tooltip="Mostra area para lembretes na p\u00e1gina."><input type="checkbox" name="memo"/> Lembrete.</label><label tooltip="Faz ataques programados com hor\u00e1rio automaticamente. Obs.: \u00e9 preciso deixar uma aba com o script rodando no jogo para os ataques serem efetuados!"><input type="checkbox" name="attackplanner"/> Planeador de ataques.</label><label tooltip="Fun\u00e7\u00e3o para selecionar aldeias especificas na visualiza\u00e7\u00e3o, como aldeias com tropas de ataque, defesa, com nobres e etc..."><input type="checkbox" name="selectvillages"/> Selecionador de aldeias.</label></div><h1 style="text-align:center"><button id="sa">Salvar</button></h1></div></div>');
for(var a in b.settings)"_"!==a[0]&&(document.getElementsByName(a)[0]["boolean"===typeof b.settings[a]?"checked":"value"]=b.settings[a]);var d=$("#twa-tooltip");$("#di [tooltip]").mouseenter(function(){d.html($(this).attr("tooltip"));var a=$(this).position();a.top-=d.height()+10;a.left+=23;d.css(a).show()}).mouseout(function(){d.hide()});$("#di").draggable({handle:"#he"}).center();$("#sa").click(function(){$("#di input").each(function(){b.settings[this.name]="checkbox"===this.type?this.checked:this.value});
b.storage(!0);alert("As configura\u00e7\u00f5es foram salvas!")})},mapelement:function(a,b){var c=$("#map_village_"+a.vid),e=a.pos||[0,0],e=$("<div/>").css($.extend(b,{top:Number(c.css("top").replace("px",""))+e[0],left:Number(c.css("left").replace("px",""))+e[1],zIndex:10,position:"absolute"})).attr("id",a.id);a.html&&e.html(a.html);a.Class&&e.addClass(a.Class);b.borderRadius&&e.attr("style",e.attr("style")+"-moz-border-radius:"+b.borderRadius+"px;-webkit-border-radius:"+b.borderRadius+"px");c.parent().prepend(e)},
mapvillages:function(a){for(var b,c=0;c<TWMap.size[1];c++)for(var e=0;e<TWMap.size[0];e++){var f=TWMap.map.coordByPixel(TWMap.map.pos[0]+TWMap.tileSize[0]*e,TWMap.map.pos[1]+TWMap.tileSize[1]*c);if(b=TWMap.villages[f.join("")])b.player=TWMap.players[b.owner],"string"===typeof b.points&&(b.points=Number(b.points.replace(".",""))),a.call(b,f)}},currentunits:function(a){var a=a||document,d={},c;for(c in b.data.units)d[c]=Number($("[name="+c+"]",a).next().text().match(/\d+/)[0]);return d},mapcoords:{init:function(){console.log("twa.mapcoords()");
$("#map_whole").after('<br/><table class="vis" width="100%" id="twa-getcoords"><tr><th>Coordenadas obtidas <a href="#" id="twa-mapcoords-refresh">\u00bb Atualizar</a></th></tr><tr><td style="text-align:center"><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px"></textarea></td></tr><tr><td id="twa-getcoords-options"><label><input type="checkbox" name="_mapplayers"> Obter coordenadas de jogadores.</label> M\u00ednimo: <input name="_mapplayersmin" style="width:35px"> M\u00e1ximo: <input name="_mapplayersmax" style="width:35px"><br/><label><input name="_mapabandoneds" type="checkbox"> Obter coordenadas de abandonadas.</label> M\u00ednimo: <input name="_mapabandonedsmin" style="width:35px"> M\u00e1ximo: <input name="_mapabandonedsmax" style="width:35px"></td></tr></table>');
var a;$("#twa-getcoords-options input").each(function(){this["checkbox"===this.type?"checked":"value"]=b.settings[this.name]}).change(function(){var d=this;clearTimeout(a);a=setTimeout(function(){var a=d["checkbox"===d.type?"checked":"value"];b.settings[d.name]="checkbox"===d.type?a:Number(a);b.storage(!0)},1E3)});$("#twa-mapcoords-refresh").click(function(){return b.mapcoords._do()});b.mapcoords._do()},_do:function(){var a,d=[];$(".twa-identify").remove();b.mapvillages(function(c){if(a="0"===this.owner?
b.settings._mapabandoneds&&this.points>Number(b.settings._mapabandonedsmin)&&this.points<Number(b.settings._mapabandonedsmax):b.settings._mapplayers&&this.points>Number(b.settings._mapplayersmin)&&this.points<Number(b.settings._mapplayersmax))d.push(c.join("|")),b.settings.mapidentify&&b.mapelement({id:"twa-mapcoords"+this.id,vid:this.id,Class:"twa-identify",pos:[b.settings.lastattack&&game_data.player.premium?15:25,38]},{width:7,height:7,borderRadius:10,background:"green",border:"1px solid #000",
opacity:0.7})});$("#twa-getcoords textarea").html(d.join(" "));return!1}},mapmanual:function(){console.log("twa.mapmanual()");$("#map_whole").after('<br/><table class="vis" width="100%" id="twa-coordsmanual"><tr><th>Coordenadas obtidas manualmente</th></tr><tr><td style="text-align:center"><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px"></textarea></td></tr></table>');var a=$("#twa-coordsmanual textarea"),d=[],c;TWMap.map._handleClick=function(e){e=this.coordByEvent(e);
if(c=TWMap.villages[e.join("")])e=e.join("|"),0>d.indexOf(e)?(d.push(e),a.val(d.join(" ")),b.mapelement({id:"twa-manual"+c.id,vid:c.id,Class:"twa-coordsmanual",pos:[b.settings.lastattack&&game_data.player.premium?15:25,b.settings.mapidentify?28:38]},{width:7,height:7,borderRadius:10,background:"red",border:"1px solid #000",opacity:0.7})):(d.remove(d.indexOf(e)),a.val(d.join(" ")),$("#twa-manual"+c.id).remove());return!1}},profilecoords:function(){console.log("twa.profilecoords()");for(var a,d=[],
c=document.getElementById("villages_list").getElementsByTagName("tr"),e=1;e<c.length&&(e+1!==c.length||c[e].getElementsByTagName("td")[2]);e++)a=Number(c[e].getElementsByTagName("td")[2].innerHTML.replace('<span class="grey">.</span>',"")),a>b.settings._profilecoordsmin&&a<b.settings._profilecoordsmax&&d.push(c[e].getElementsByTagName("td")[1].innerHTML);$("#villages_list").before('<table class="vis" id="twa-profilecoords" width="100%"><tr><th>Todas coordenadas</th></tr><tr><td><textarea style="width:100%;background:none;border:none;resize:none;font-size:11px">'+
d.join(" ")+'</textarea></td></tr><tr><td><label><input style="width:40px" name="_profilecoordsmin"/> Pontua\u00e7\u00e3o m\u00ednima.</label><br/><label><input style="width:40px" name="_profilecoordsmax"/> Pontua\u00e7\u00e3o m\u00e1xima.</label></td></tr></table><br/>');var f;$("#twa-profilecoords input").each(function(){this.value=b.settings[this.name]}).change(function(){var a=this;clearTimeout(f);f=setTimeout(function(){b.settings[a.name]=Number(a.value);b.storage(!0)},1E3)})},profilegraphic:function(){console.log("twa.profilegraphic()");
var a=location.search.match(/\d+$/)[0],b="info_player"===game_data.screen?"player":"tribe",c="http://"+game_data.world+".tribalwarsmap.com/"+game_data.market+"/",a='<table class="vis" width="100%" id="twa-graphic"><tr><th><a href="'+c+"history/"+b+"/"+a+'">Estat\u00edsticas <img src="http://www.hhs.gov/web/images/exit_disclaimer.png"/></a></th></tr><tr><td style="text-align:center"><p><img src="'+(c+"graph/p_"+b+"/"+a)+'"/></p><img src="'+(c+"graph/oda_"+b+"/"+a)+'"/><p><img src="'+(c+"graph/odd_"+
b+"/"+a)+'"/></p></td></tr></table>';"player"===b?$(".vis:not([id^=twa]):eq(2)").after("<br/>"+a):$("#content_value > table tr:first").append('<td valign="top">'+a+"</td>")},lastattack:function(){console.log("twa.lastattack()");$(".twa-lastattack").remove();b.mapvillages(function(){$.ajax({url:"game.php?village="+this.id+"&screen=overview&json=1&source=873",dataType:"json",id:this.id,success:function(a){if(a[0].attack){var a=a[0].attack.time.split(/\s[A-z]/)[0].split("."),a=(new Date([a[1],a[0],"20"+
a[2]].join(" "))).getTime(),d=$("#serverDate").text().split("/"),d=(new Date([d[1],d[0],d[2],$("#serverTime").text()].join(" "))).getTime(),c=(new Date(d-a)).getTime(),a=Math.floor(c/31536E6),d=Math.floor(c/864E5),e=Math.floor(c/36E5),c=Math.floor(c/6E4);1<=a?a+="Ano":2<=d?a=d+"d"+e%24+"h":1<=e?(c%=60,a=(10>e?"0"+e:e)+":"+(10>c?"0"+c:c)+"h"):a="00:"+(10>c?"0"+c:c)+"m";b.mapelement({vid:this.id,html:a,Class:"twa-lastattack",pos:[25,2]},{width:45,height:10,fontSize:8,borderRadius:5,color:"#fff",textAlign:"center",
background:"#111",border:"1px solid #000",opacity:0.7})}}})});return!0},mapgenerator:function(){console.log("twa.mapgenerator()");var a,b=/ally/.test(game_data.mode)?"t":"p",c="00ff00 999999 823c0a b40000 f40000 0000f4 880088 f0c800 00a0f4 ff8800 ffff00 e0d3b8 04b45f 04b4ae 81f7f3 be81f7 fa58f4 ff0088 ffffff f7be81".split(" "),e=120,f=500,g=500;if(/con/.test(game_data.mode)){a=$("#con_player_ranking_table, #con_ally_ranking_table");var e=320,h=$("h3").html().match(/\d+/)[0],h=1===h.length?"0"+h:h,
f=h[1]+"50",g=h[0]+"50"}else/kill/.test(game_data.mode)?a=$("#kill_player_ranking_table, #kill_ally_ranking_table").next():"awards"===game_data.mode?a=$("#award_ranking_table"):("t"===b&&$("#ally_ranking_table tr:first th:eq(1)").width(150),a=$("#player_ranking_table, #ally_ranking_table"));a.find("tr:not(:first)").each(function(a){$("td:eq(1)",this).prepend('<input class="map-item" type="checkbox" style="margin:0px;margin-right:20px" color="'+c[a]+'" id="'+$("a",this).attr("href").match(/\d+$/)[0]+
'"/>')}).eq(-1).after('<tr><td colspan="8"><input type="button" id="twa-mapgenerator" value="Gerar mapa"/> <label><input type="checkbox" id="checkall"/> <strong>Selecionar todos</strong></label></td></tr>');$("#twa-mapgenerator").click(function(){var a="http://"+game_data.market+".twstats.com/"+game_data.world+"/index.php?page=map&";$(".map-item").each(function(c){c++;$(this).is(":checked")&&(a+=b+"i"+c+"="+this.id+"&"+b+"c"+c+"="+$(this).attr("color")+"&")});a+="zoom="+e+"&centrex="+f+"&centrey="+
g+"&nocache=1&fill=000000&grid=1&kn=1&bm=1";window.open(a)});$("#checkall").click(function(){$(".map-item").attr("checked",this.checked)})},tooltipgraphic:function(){console.log("twa.tooltipgraphic()");$("#content_value a[href*=info_player], #content_value a[href*=info_ally]").each(function(){if(this.href.match(/\d+$/)){var a="http://"+game_data.world+".tribalwarsmap.com/"+game_data.market+"/graph/p_"+(/info_player/.test(this.href)?"player":"tribe")+"/"+this.href.match(/\d+$/)[0];(new Image).src=
a;this.title='<img src="'+a+'">';$(this).tooltip({track:!0,showURL:!1})}});$("#tooltip").css("max-width",323).addClass("twa-tooltipgraphic")},reportfilter:function(){console.log("twa.reportfilter()");$("#report_list").before('<table class="vis" width="100%"><tr><th>Pesquisar relat\u00f3rios: <input type="text" id="twa-reportfinder" style="padding:1px 2px;border:1px solid silver;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/></th></tr></table>');$("#twa-reportfinder").keyup(function(){var a=
this.value.toLowerCase();$("#report_list tr:not(:first, :last)").each(function(){$(this)[0>$(this).text().toLowerCase().indexOf(a)?"hide":"show"]()})});selectAll=function(a,b){$("#report_list tr:not(:first, :last):visible input[type=checkbox]").attr("checked",b)}},villagefilter:function(){console.log("twa.villagefilter()");var a=".overview_table tr:not(:first)",b="span[id^=label_text]";switch($("#overview").val()){case "units":a=".overview_table tbody";break;case "commands":case "incomings":a=".overview_table tr.nowrap",
b="span[id^=labelText]"}$(".overview_table").before('<table class="vis" width="100%"><tr><th>Pesquisar aldeias: <input type="text" id="twa-villagefilter" style="padding:1px 2px;border:1px solid silver;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/></th></tr></table>');$("#twa-villagefilter").keyup(function(){var c=this.value.toLowerCase();$(a).each(function(){$(this)[0>$(b,this).text().toLowerCase().indexOf(c)?"hide":"show"]()})});window.selectAll=function(a,b){$(".overview_table tr.nowrap:visible input[type=checkbox]").attr("checked",
b)}},troopcounter:function(){console.log("twa.troopcounter()");$("#units_table").after('<table id="twa-troopcounter" class="vis" style="width:100%;margin:0 auto"><thead>'+$("#units_table thead").html()+"</thead><tbody>"+$("#units_table tbody:first").html()+"</tbody></table>");for(var a={},b=document.getElementById("twa-troopcounter"),c=document.getElementById("units_table").getElementsByTagName("tr")[0].getElementsByTagName("img"),e=document.getElementById("units_table").getElementsByTagName("tbody"),
f=b.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),g=0;g<c.length;g++)a[c[g].src.match(/_(\w+)\.png/)[1]]=[[g+2,0],[g+1,0],[g+1,0],[g+1,0]];for(g=0;g<e.length;g++)for(var c=e[g].getElementsByTagName("tr"),h=0;h<c.length;h++)for(var i in a)a[i][h][1]+=Number(c[h].getElementsByTagName("td")[a[i][h][0]].innerHTML);$("td:first",b).empty().width($("#units_table td:first").width());$("th:first",b).html("Contagem de Tropas:");$("th:last, td:has(a)",b).remove();for(g=0;g<f.length;g++)for(i in a)b=
f[g].getElementsByTagName("td")[a[i][g][0]],b.className="unit-item"+(0==a[i][g][1]?" hidden":""),b.innerHTML=a[i][g][1]},reportcalc:function(){console.log("twa.reportcalc()");if(!$("#twa-reportcalc").length){$("table[width=470]").before('<table class="vis" width="470" id="twa-reportcalc"><tbody><tr><th>Unidades necess\u00e1rias:</th></tr><tr><td align="center"><label><input type="checkbox" id="twa-currentvillage"> Usar unidades da aldeia atual</label></td></tr><tr><td align="center" id="twa-units"></td></tr><tr><th>Unidades calculadas: <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></th></tr><tr><td align="center" id="twa-unitscalc" style="font-weight:bold"></td></tr><tr><td align="center" id="twa-attack"><a href="#">\u00bb Atacar com essas tropas</a></td></tr></tbody></table>');
$(document).ajaxStart(function(){$("#twa-loader").show()}).ajaxStop(function(){$("#twa-loader").hide()});$("#twa-units input").change(function(){$("#twa-unitscalc > span, #twa-attack").hide();b.reportcalc()});var a=document.getElementById("twa-unitscalc"),d=document.getElementById("twa-units"),c;for(c in b.data.units)a.innerHTML+='<span id="twa-'+c+'"><img src="http://cdn.tribalwars.net/graphic/unit/unit_'+c+'.png"/> <span></span></span> ',d.innerHTML+='<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+
c+'.png"q><input type="checkbox"'+("spear"===c||"archer"===c||"spy"===c||"ligth"===c||"marcher"===c||"knight"===c?' checked="true"':"")+' class="'+c+'"/>';$("#twa-unitscalc > span, #twa-attack").hide().last().click(function(){$.post(game_data.link_base_pure.replace("en=","en=place&try=confirm").replace(/village=\d+/,"village="+o),$.extend({x:l[0],y:l[1],attack:!0},k),function(b){var a=$("#error",b);if(a.text())return alert("Ocorreu o seguinte erro ao enviar o ataque: "+a.text());b=$("form",b);$.post(b[0].action,
b.serialize(),function(){alert("Ataque enviado com sucesso!")})});return!1})}var a=$("#attack_spy tr:first td").text().trim().replace(/\./g,"").split(" "),d=$("#attack_spy tr:eq(1) td").text().replace(/\t/g,"").split("\n"),d=d.splice(1,d.length-2),e={};$.each(d,function(){var a=this.split(/\s\(/),c=a[1].match(/\d+/);e[b.data.builds[a[0]]]=Number(c)});var d=0===e.hide?0:Math.round(150*Math.pow(40/3,(e.hide-1)/9)),f=(0===e.storage?1E3:Math.round(1E3*Math.pow(400,(e.storage-1)/29)))-d,d=$(".nopad table:eq(1) tr:eq(1) td:last").text().split("."),
d=(new Date([d[1],d[0],"20"+d[2]].join(" "))).getTime();c=$("#serverDate").text().split("/");c=(new Date([c[1],c[0],c[2],$("#serverTime").text()].join(" "))).getTime();var g=(new Date(c-d)).getTime(),h=Math.floor(g/36E5),i=Math.floor(g/6E4)%60,d=$("#attack_info_att tr:eq(1) a").text().match(/ \((\d+)\|(\d+)\) \w+ $/);c=$("#attack_info_def tr:eq(1) a").text().match(/ \((\d+)\|(\d+)\) \w+ $/);for(var d=Math.sqrt(Math.pow(Number(d[1])-Number(c[1]),2)+Math.pow(Number(d[2])-Number(c[2]),2)),j=0,k={},p=
[e.wood,e.stone,e.iron],m="knight light marcher heavy spear axe archer sword".split(" "),n=c=0;n<m.length;n++)b.data.units[m[n]]&&(g=b.data.units[m[n]].speed*(d/b.data.world.unit_speed),h=Math.floor(g/3600),i=Math.floor((g-3600*h)/60),g=parseFloat(h+"."+i),g>c&&(c=g));var q=String(c).split(".");a.map(function(a,c){var d=0===p[c]?5*b.data.world.speed:Math.round(30*Math.pow(80,(p[c]-1)/29))*b.data.world.speed,a=Number(a),a=a+(h*d+i*(d/60)+q[0]*d+q[1]*(d/60));a>f&&(a=f);j+=a});var a=$("#attack_info_att a:first").attr("href").match(/\d+/),
d=$("#attack_info_att tr:eq(1) a").attr("href").match(/\d+$/),l=$("#attack_info_def a[href*=info_village]").text().match(/.*\((\d+)\|(\d+)\)\sK\d{1,2}/).slice(1,3),o=game_data.village.id;a===game_data.player.id&&(o=$("#twa-currentvillage:checked").length?curvid:d);$.get(game_data.link_base_pure.replace(/village=\d+/,"village="+o)+"place",function(a){for(var a=b.currentunits(a),c=0;c<m.length;c++){var d=m[c];if(b.data.units[d]&&$("#twa-units ."+d+":checked").length){var e=b.data.units[d].carry,f=a[d]*
e;if(0!==a[d])if(f>=j){k[d]=j/e;break}else k[d]=f>j?e/j:a[d],j-=f;!k.spy&&($(".twa-units input[value=spy]:checked").length&&0<a.spy)&&(k.spy=4<a.spy?5:a.spy)}}for(d in k)$("#twa-"+d).show().find("span").html(k[d]);$("#twa-attack")[$.isEmptyObject(k)?"hide":"show"]()})},addcheckbox:function(){console.log("twa.addcheckbox()");$(".overview_table tr").each(function(a){a?(a=$('a[href*="village="]:first',this).attr("href").match(/village=(\d+)/)[1],$(this).prepend('<td><input type="checkbox" name="village_ids[]" class="addcheckbox" value="'+
a+'"/></td>')):$(this).prepend("<th></th>")})},selectvillages:{init:function(){console.log("twa.selectvillages()");var a=$("#overview").val()||"default",d=b.selectvillages.modes,c=!1,e;for(e in d)a===d[e][0]&&(c=!0);c&&$(".overview_table").before('<table class="vis" width="100%"><tr><th>Selecionar aldeias: <span id="twa-selectvillages"></span></th></tr></table>');$('#combined_table tr:first th:has(img[src*="unit/unit"]) img').each(function(){b.selectvillages.tools.unitsorder.push(this.src.match(/unit_(\w+)/)[1])});
for(e in d)if(a===d[e][0])d[e][1]()},modes:{unitsattack:["combined",function(){var a=$("#combined_table tr:not(:first)");$('<input type="checkbox" id="twa-selectvillages-unitsattack">').change(function(){for(var d=0;d<a.length;d++){var c=b.selectvillages.tools.getunits(a[d]),e=b.selectvillages.tools.getpop("att",c),c=b.selectvillages.tools.getpop("def",c);e>c&&$(".addcheckbox",a[d]).attr("checked",this.checked)}}).add(' <label for="twa-selectvillages-unitsattack">com tropas de ataque</label>').appendTo("#twa-selectvillages")}],
unitsdefence:["combined",function(){var a=$("#combined_table tr:not(:first)");$('<input type="checkbox" id="twa-selectvillages-unitsdefence">').change(function(){for(var d=0;d<a.length;d++){var c=b.selectvillages.tools.getunits(a[d]),e=b.selectvillages.tools.getpop("att",c),c=b.selectvillages.tools.getpop("def",c);e<c&&$(".addcheckbox",a[d]).attr("checked",this.checked)}}).add(' <label for="twa-selectvillages-unitsdefence">com tropas de defesa</label>').appendTo("#twa-selectvillages")}],unitsnob:["combined",
function(){var a=$("#combined_table tr:not(:first)");$('<input type="checkbox" id="twa-selectvillages-unitsnob">').change(function(){for(var d=0;d<a.length;d++)0<b.selectvillages.tools.getunits(a[d]).snob&&$(".addcheckbox",a[d]).attr("checked",this.checked)}).add(' <label for="twa-selectvillages-unitsnob">com nobres</label>').appendTo("#twa-selectvillages")}]},tools:{getunits:function(a){for(var a=$(".unit-item",a),d={},a=a.add(a.next().last()),c=0;c<b.selectvillages.tools.unitsorder.length;c++)d[b.selectvillages.tools.unitsorder[c]]=
Number(a.eq(c).text());return d},getpop:function(a,d){var c=0;switch(a){case "att":for(var e=0;e<b.selectvillages.tools.unitsatt.length;e++)var f=b.selectvillages.tools.unitsatt[e],c=c+d[f]*b.data.units[f].pop;break;case "def":for(e=0;e<b.selectvillages.tools.unitsdef.length;e++)f=b.selectvillages.tools.unitsdef[e],c+=d[f]*b.data.units[f].pop;break;case "all":for(e in d)c+=d[e]*b.data.units[d[e]].pop}return c},unitsatt:"axe light marcher ram catapult knight snob".split(" "),unitsdef:["light","sword",
"archer","heavy"],unitsorder:[]}},rename:{init:function(a,b,c,e){console.log("twa.rename()");var f=$(a);".overview_table"!==a&&(f=f.parent());f.before('<table class="vis" width="100%"><tr><th>Renomear '+b+': <input type="text" id="twa-'+c+'" style="padding:1px 2px;border:1px solid red;border-radius:2px;-webkit-border-radius:2px;-moz-border-radius:2px;height:15px"/> <input type="button" value="Renomear"/><label><input type="checkbox" id="twa-onlyselected"/> Apenas '+b+" selecionad"+e+'s</label> <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></th></tr></table>');
$(document).ajaxStart(function(){$("#twa-loader").show()}).ajaxStop(function(){$("#twa-loader").hide()})},reports:function(){b.rename.init("#report_list","relat\u00f3rios","reportrename","o");b.rename._do({entry:"#twa-reportrename",input:"#report_list tr:not(:first, :last):visible input:not([type=checkbox])",inputChecked:"#report_list tr:not(:first, :last):visible:has(input:checked) input:not([type=checkbox])"})},commands:function(){b.rename.init(".overview_table","comandos","commandrename","o");
$(".overview_table input[type=checkbox]").removeAttr("disabled");b.rename._do({entry:"#twa-commandrename",input:".overview_table tr:not(:first, :last):visible input[id^=editInput]",inputChecked:".overview_table tr:not(:first, :last):visible:has(input:checked) input[id^=editInput]"})},villages:function(){b.rename.init(".overview_table","aldeias","villagerename","a");b.rename._do({entry:"#twa-villagerename",input:".overview_table tr:not(:first):visible input[id^=edit_input]",inputChecked:".overview_table tr:not(:first):visible:has(input:checked) input[id^=edit_input]",
min:3,max:32})},_do:function(a){function b(d){if(!this.val()||this.val().length<(a.min||1)||this.val().length>(a.max||255))return this.css("border","1px solid red");this.css("border","1px solid silver");d&&$($("#twa-onlyselected:checked").length?a.inputChecked:a.input).val(this.val()).next().click()}$(a.entry).keyup(function(a){b.call($(this),13===a.keyCode);return!1}).keypress(function(a){return 13!==a.keyCode});$(a.entry).next().click(function(){b.call($(this).prev(),!0)})}},assistentfarm:{id:0,
init:function(){console.log("twa.assistentfarm()");$("h3:first").append(' <span id="twa-assistentfarm">(Autom\u00e1tico)</span>');$("#farm_units").parent().after('<div class="vis" style="overflow:auto;height:100px"><table style="width:100%"><tr id="twa-assistent-log"><th><h4>Farm Assistent Log</h4></th></tr></table></div>');b.assistentfarm.prepare()},log:function(a,d){$("#twa-assistent-log").after("<tr><td>"+b.assistentfarm.id++ +': <img src="'+(d?"/graphic/delete_small.png":"/graphic/command/attack.png")+
'"/> '+a+"</td></tr>")},prepare:function(){var a=[],d=0;$.get(location.href,function(c){$("#am_widget_Farm table tr[class]",c).each(function(){a.push(this)});setInterval(function(){b.assistentfarm.attack(a[d]);++d===a.length&&(d=0)},5E3)})},attackHandler:{sendUnits:function(a,d,c){$.ajax({type:"POST",url:Accountmanager.send_units_link,data:{target:a,template_id:d},village:c,success:function(a){a=JSON.parse(a);a.success?b.assistentfarm.log(a.success.replace("\n"," ")+" na aldeia "+this.village):a.error&&
b.assistentfarm.log(a.error+" na aldeia "+this.village,!0)}})},reportAttack:function(a,d,c){$.ajax({type:"POST",url:Accountmanager.send_units_link_from_report,data:{report_id:d},village:c,success:function(a){a=JSON.parse(a);a.success?b.assistentfarm.log(a.success.replace("\n"," ")+" na aldeia "+this.village):a.error&&b.assistentfarm.log(a.error+" na aldeia "+this.village,!0)}})}},attack:function(a){var d=$(".farm_icon_a:not(.farm_icon_disabled)",a),c=$(".farm_icon_b:not(.farm_icon_disabled)",a),d=
$(".farm_icon_c:not(.farm_icon_disabled)",a).length?10:d.length?8:c.length?9:0,c=$("td:eq("+d+") a",a).attr("onclick").toString().match(/(\d+), (\d+)/);b.assistentfarm.attackHandler[10===d?"reportAttack":"sendUnits"](c[1],c[2],$("td:eq(3) a",a).html())}},autofarm:{init:function(){console.log("twa.autofarm()");var a=b.baseTool("twa-autofarm","Farmador","http://cdn.tribalwars.com.br/graphic/command/attack.png",'<style>#twa-autofarm-units input{width:30px;text-align:center}#twa-autofarm-content img{margin-left:5px;margin-right:2px}</style><h2>Farmador Autom\u00e1tico</h2><span class="twa-autofarm-options"><table width="100%" class="vis"><tr><td id="twa-autofarm-units"></td></tr><tr><td><strong>Coordenadas:</strong><br/><textarea style="width:584px;height:90px" name="_placefarmcoords">'+
b.settings._placefarmcoords.join(" ")+'</textarea></td></tr><tr><td><label><input type="checkbox" name="_placefarmprotect"/> N\u00e3o enviar ataques caso a aldeia tenha dono.</label></td></tr><tr><td><label><input type="checkbox" name="_placefarmreplace"/> Caso n\u00e3o tenha tropas sulficientes usar o que tiver.</label></td></tr><tr><th><input type="button" value="Iniciar ataques" id="twa-autofarm-switch"/></th></tr></table><h3>Log de ataques:</h3><div style="overflow:auto;height:150px"><table id="twa-autofarm-log" style="width:100%" class="vis"></table></div>'),
d=$("#twa-autofarm-units"),c=!1,e;for(e in b.data.units)d.append('<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+e+'.png"/> <input name="'+e+'" style="width:30px"/>');a.find(":input[name]").each(function(){"checkbox"===this.type?(this.checked=b.settings[this.name],$(this).change(function(){b.settings[this.name]=this.checked;b.storage(!0)})):(this.value="text"===this.type?b.settings._placefarmunits[this.name]||0:b.settings._placefarmcoords.join(" "),$(this).keyup(function(){var a=this;this.value=
this.value.replace(/[^0-9\|\s]/g,"").replace(/\s+/," ");clearTimeout(c);c=setTimeout(function(){if("text"===a.type)b.settings._placefarmunits[a.name]=b.autofarm.data[a.name]=a.value;else{for(var d=a.value.split(/\s+/),c=[],e=0;e<d.length;e++)/-?\d{1,3}\|-?\d{1,3}/.test(d[e])&&c.push(d[e]);b.settings._placefarmcoords=c;b.autofarm.next(!0)}b.storage(!0)},500)}))});$("#twa-autofarm-switch").click(function(){b.autofarm.stop=!b.autofarm.stop;this.value=b.autofarm.stop?"Continuar ataques":"Pausar ataques";
!b.autofarm.stop&&b.autofarm.attack()});for(var f in timers)timers[f].reload=!1;for(e in b.data.units)b.autofarm.data[e]=b.settings._placefarmunits[e];b.settings._placefarmindex>=b.settings._placefarmcoords.length&&(b.settings._placnnnefarmindex=0);b.settings._placefarmcoords.length&&(b.autofarm.coord=b.settings._placefarmcoords[b.settings._placefarmindex].split("|"))},log:function(a,d){$("#twa-autofarm-log").prepend("<tr><td><strong>"+($("#serverTime").text()+" "+$("#serverDate").text())+':</strong> <img src="'+
(d?"/graphic/delete_small.png":"/graphic/command/attack.png")+'"/> '+a+"</td></tr>");return b.autofarm},attack:function(a){if(b.autofarm.stop)var d=setInterval(function(){b.autofarm.stop||(b.autofarm.attack(),clearInterval(d))},500);else if(!b.autofarm.wait){b.autofarm.data.x=b.autofarm.coord[0];b.autofarm.data.y=b.autofarm.coord[1];if(a)for(var c in a)b.autofarm.data[c]=a[c];$.post(game_data.link_base_pure.replace("en=","en=place&try=confirm"),b.autofarm.data,function(a){if($(a).find("#error").text()){var d=
b.autofarm.nextreturn(a),a=b.autofarm.currentunits(a);d&&!a?(b.autofarm.log("N\u00e3o h\u00e1 tropas na aldeia no momento. Tropas retornaram em "+s(d)+" (tempo estimado)",!0),setTimeout(function(){b.autofarm.attack().wait=!1},d),b.autofarm.wait=!0):!d&&!a?b.autofarm.log("N\u00e3o existem tropas na aldeia.",!0).wait=!0:a&&b.autofarm.attack(a)}else{if(b.settings._placefarmprotect&&$(a).find("form a[href*=player]").length)return b.autofarm.next();d=$(a).find("form");$.post(d[0].action,d.serialize(),
function(){b.autofarm.log("Ataque enviado na aldeia "+b.autofarm.coord.join("|")+".").next()})}})}return b.autofarm},nextreturn:function(a){var b=$("table.vis:last tr:not(:first)",a),a=b.find("[src*=cancel], [src*=back], [src*=return]"),b=b.find("[src*=attack]"),a=a.length?a:b.length?b:!1,b=b.length?2:1;if(!a)return!1;if(a=a.eq(0).parent().parent().find(".timer").text())return a=a.split(":"),console.log(a),a,36E5*a[0]+6E4*a[1]+1E3*a[2]*b},currentunits:function(a){var d={};b.settings._placefarmreplace&&
$(".unitsInput",a).each(function(){var a=this.id.split("_")[2],e=Number($(this).next().text().match(/\d+/)[0]);b.settings._placefarmunits[a]&&b.settings._placefarmunits[a]>e&&(d[a]=e)});return!$.isEmptyObject(d)?d:!1},next:function(a){a||b.settings._placefarmindex++;b.settings._placefarmindex>=b.settings._placefarmcoords.length&&(b.settings._placefarmindex=0);b.storage(!0);b.settings._placefarmcoords.length&&(b.autofarm.coord=b.settings._placefarmcoords[b.settings._placefarmindex].split("|"));a||
b.autofarm.attack();return b.autofarm},stop:!0,wait:!1,data:{attack:!0},coord:[]},building:{init:function(){console.log("twa.building()");$(".overview_table").before('<table class="vis" id="twa-building" width="100%"><tr><th><label><input type="radio" checked name="twa-building" id="twa-building-build"/> Constru\u00e7\u00e3o em Massa - Edif\u00edcios <img src="graphic/questionmark.png" width="13" title="Os edif\u00edcios ser\u00e3o construidos at\u00e9 o n\u00edvel indicado abaixo!"/></label> <a href="#" id="twa-cancel-builds">\u00bb Cancelar todas as contru\u00e7\u00f5es</a></th></tr><tr><td class="twa-buildings"></td></tr><tr><th><label><input type="radio" name="twa-building" id="twa-building-destroy"/> Demoli\u00e7\u00e3o em Massa - Edif\u00edcios <img src="graphic/questionmark.png" width="13" title="Os edif\u00edcios ser\u00e3o demolidos at\u00e9 o n\u00edvel indicado abaixo!"/></label> <a href="#" id="twa-cancel-destroy">\u00bb Cancelar todas as demoli\u00e7\u00f5es</a></th></tr><tr><td class="twa-buildings"></td></tr></table><table class="vis" width="100%"><tr><th>Clique no icone dos edif\u00edcios abaixo para iniciar a constru\u00e7\u00e3o em massa do edif\u00edcio clicado.</th></tr></table>');
$("#twa-building-build, #twa-building-destroy").click(function(){1===BuildingOverview._display_type&&"twa-building-destroy"===this.id||0===BuildingOverview._display_type&&"twa-building-build"===this.id||BuildingOverview.show_all_upgrade_buildings("twa-building-destroy"===this.id)});$("#twa-cancel-builds, #twa-cancel-destroy").click(function(){confirm("Tem certeza que deseja cancelar todas as "+("twa-cancel-destroy"===this.id?"demoli\u00e7\u00f5es":"constru\u00e7\u00f5es")+"?")&&b.building.cancel("twa-cancel-destroy"===
this.id);return!1});!1===BuildingOverview._display_type?BuildingOverview.show_all_upgrade_buildings():BuildingOverview._display_type&&$("#twa-building-destroy").attr("checked",!0);for(var a=0;2>a;a++){var d=$(".twa-buildings").eq(a),c;for(c in b.data.builds)c=b.data.builds[c],d.append('<img src="graphic/buildings/'+c+'.png"/> <input type="text" style="width:25px" name="'+c+'" value="'+b.settings[a?"_buildingdestroy":"_buildingbuild"][c]+'"/> ')}$(".twa-buildings").each(function(a){$("input",this).keyup(function(){var d=
this;clearTimeout(void 0);setTimeout(function(){b.settings[a?"_buildingdestroy":"_buildingbuild"][d.name]=d.value;b.storage(!0)},2E3)}).keypress(function(a){return 47<a.charCode&&58>a.charCode&&3>this.value.length})});$("#buildings_table tr:first th:has(img[src*=buildings]) a").click(function(){return b.building._do($("img",this)[0].src.match(/\/([a-z]+)\.png/)[1],BuildingOverview._display_type)})},_do:function(a,d){var c=document.getElementById("upgrade_building_link").value,e=d?5:b.settings._buildingmaxorders,
f=$(".twa-buildings").eq(d).find("input[name="+a+"]").val();$("#buildings_table tr:not(:first)").each(function(){var b=this.className.match(/\d+/)[0];if(BuildingOverview._upgrade_villages[b].buildings[a]){var h=$("td:last li:has(.build-status-light[style*="+(d?"red":"green")+']) img[src*="'+a+'.png"]',this),i=Number($(".b_"+a+" a",this).text())+h.length;h.parent().parent().find(".build-cancel-icon img").click();for(h=$("#building_order_"+b+" img").length;h<e;h++)(d?i-- >f:i++<f)&&$.getJSON(c.replace(/village=\d+/,
"village="+b),{id:a,destroy:d,force:1},function(a){if(a.success){if(!document.getElementById("building_order_"+b)){var d=$('<ul class="building_order" id="building_order_'+b+'"></ul>');BuildingOverview.create_sortable(d);$("#v_"+b+" td:last").append(d)}$("#building_order_"+b).html(a.building_orders)}})}});return!1},cancel:function(a){$("li:has(.build-status-light[style*="+(a?"red":"green")+"]) .build-cancel-icon img").click()}},research:{init:function(){console.log("twa.research()");$(".overview_table").before('<table class="vis" width="100%" id="twa-research"><tr><th>Clique no icone das unidades abaixo para iniciar a pesquisa em massa da unidade clicada. <a href="#" id="twa-research-cancel">\u00bb Cancelar todas as pesquisas</a></th></tr></table>');
$("#twa-research-cancel").click(function(){confirm("Tem certeza que deseja cancelar todas as pesquisas?")&&b.research.cancel();return!1});$("#techs_table tr:first a:has(img)").click(function(){return b.research._do(this.href.match(/order=(\w+)/)[1])})},_do:function(a){for(var b=document.getElementById("techs_table").getElementsByTagName("tr"),c=1;c<b.length;c++){var e=b[c].id.split("_")[1];document.getElementById(e+"_"+a)&&$.ajax({type:"post",url:TechOverview.urls.ajax_research_link.replace(/village=\d+/,
"village="+e),data:{tech_id:a},dataType:"json",vid:e,success:function(b){b.success&&(document.getElementById("village_tech_order_"+this.vid).innerHTML=b.tech_order,TechOverview.change_dot($("#"+this.vid+"_"+a),this.vid,a,"brown"),game_data.village.id==this.vid&&($("#wood").html(b.resources[0]),$("#stone").html(b.resources[1]),$("#iron").html(b.resources[2]),startTimer()))}})}return!1},cancel:function(){$("#techs_table div.tech-cancel-icon img").each(function(){var a=this.onclick.toString().match(/cancel_research_order\((\d+), (\d+), '(\w+)'\)/);
$.ajax({url:TechOverview.urls.ajax_cancel_tech_order_link.replace(/village=\d+/,"village="+a[1]),dataType:"json",type:"post",data:{tech_order_id:a[2]},name:a[3],vid:a[1],success:function(a){a.success&&(document.getElementById("village_tech_order_"+this.vid).innerHTML=a.tech_order,TechOverview.restore_dot(this.vid,this.name))}})})}},memo:{init:function(){console.log("twa.memo()");var a=b.baseTool("twa-memo","Lembrete","http://cdn.tribalwars.net/graphic/overview/note.png",'<textarea style="width:400px;height:150px"></textarea><br/><input type="button" value="Salvar"/> <span id="twa-memo-time" style="font-style:italic;font-size:10px"></span> <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px"/>',
410);a.find("input").click(function(){a.find("img").is(":visible")||b.memo.edit(a)});b.memo.getContent(function(b,c){$("#twa-memo-time").html("\u00daltima altera\u00e7\u00e3o: "+(c||"nunca."));a.find("textarea").val(b);a.find("img").hide()})},getElement:function(a){var d;$.get(b.linkbase("memo"),function(c){if(b.settings._memoid&&$("#"+b.settings._memoid,c).length)d=$("#"+b.settings._memoid,c);else{var e=6E4;$(".memo_container",c).each(function(){var a=$("textarea",this);a.val().length<e&&(e=a.val().length,
d=a)});b.storage("_memoid",d[0].id)}a(d)})},getContent:function(a){b.memo.getElement(function(b){b=b.val().match(/\[twanote\]([^]+)\[\/twanote\-([0-9:\/\s]+)\]/);a.apply(window,b&&b[1]?[b[1],b[2]]:[])})},edit:function(a){a.find("img").show();b.memo.getElement(function(b){var c=$(".server_info span"),c=c[0].innerHTML+" "+c[1].innerHTML;/\[twanote\]([^]+)\[\/twanote\-[0-9:\/\s]+\]/.test(b.val())?b.val(b.val().replace(/\[twanote\]([^]+)\[\/twanote\-[0-9:\/\s]+\]/,"[twanote]"+a.find("textarea").val()+
"[/twanote-"+c+"]")):b.val(b.val()+"\n\n[twanote]"+a.find("textarea").val()+"[/twanote-"+c+"]");$("#twa-memo-time").html("\u00daltima altera\u00e7\u00e3o: "+c);b=b.parentsUntil(".memo_script").last();$.post(b[0].action,b.serialize(),function(){a.find("img").hide()})})}},changegroups:{init:function(){console.log("twa.changegroups()");$(".overview_table").before('<table class="vis" width="100%" id="twa-changegroups"><tr><th>Alterar grupos das aldeias selecionadas: <select id="twa-group" name="selected_group"></select> <input type="submit" value="Adicionar" name="add_to_group"/> <input type="submit" value="Remover" name="remove_from_group"/> <input type="submit" value="Mover" name="change_group"/> <img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px;display:none" id="twa-loader"/></th></tr></table>');
$("#twa-changegroups input").click(function(){b.changegroups.change(this)});var a=document.getElementById("twa-group"),d=b.changegroups.getgroups(),c;for(c in d)a.innerHTML+='<option value="'+c+'" name="village_ids[]">'+d[c]+"</option>";$("#combined_table tr.nowrap")},change:function(a){$("#twa-loader").show();var d=$('[name="village_ids[]"], [name=selected_group]').serializeArray();d.push({name:a.name,value:a.value});console.log(d);$.post(b.linkbase("overview_villages")+"&mode=groups&action=bulk_edit_villages&h="+
game_data.csrf,d,function(){$("#twa-loader").hide()})},getgroups:function(){var a={};$("#group_table tr:not(:first, :last) td[id^=show_group] a").each(function(){a[this.href.match(/edit_group=(\d+)/)[1]]=this.innerHTML});return a}},attackplanner:{villages:{},init:function(){function a(){for(var a=0;a<e.length;a++)e[a].value=$.trim(e[a].value);if(e[0].value===e[1].value&&"xxx|yyy"!==e[0].value&&"xxx|yyy"!==e[1].value)return alert("As coordenadas da aldeia atacante n\u00e3o pode ser a mesma da aldeia de destino!");
if("red"===$("[name=from]")[0].style.borderColor||"red"===$("[name=to]")[0].style.borderColor||"red"===$("[name=time]")[0].style.borderColor)return!1;b.data.attackplanner.lastTime=$("[name=time]")[0].value;b.storage(!0,null,"data");var c=!1,a=e[2].value.split(" "),d=a[1].split("/"),f={target:e[1].value,village:e[0].value,time:(new Date(d[1]+"/"+d[0]+"/"+d[2]+" "+a[0])).getTime(),units:{},support:$("[name=support]").is(":checked")};i.each(function(){if(this.value||0<Number(this.value))f.units[this.name]=
Number(this.value),c=!0});if(!c)return alert("Voc\u00ea n\u00e3o inseriu nenhuma unidade!");b.data.attackplanner.commands.push(f);b.attackplanner.update();b.storage(!0,null,"data")}console.log("twa.attackplanner()");var d=b.baseTool("twa-attackplanner","Planeador","http://cdn.tribalwars.com.br/graphic/command/attack.png",'<style>#twa-attackplanner-content td{padding:3px}</style><h2>Planeador de ataque</h2><h3>Adicionar comando</h3><table class="vis" width="100%"><tr><th colspan="4">Aldeia atacante</th><th colspan="4">Aldeia alvo</th><th colspan="4">Hor\u00e1rio de envio</th><th colspan="4">Apoio</th></tr><tr><td colspan="4"><input value="xxx|yyy" style="width:90px;border:1px solid red" name="from"/></td><td colspan="4"><input style="width:90px;border:1px solid red" value="xxx|yyy" name="to"/></td><td colspan="4"><input name="time" value="'+
b.data.attackplanner.lastTime+'" style="width:200px;border:1px solid #aaa"/></td><td><input name="support" type="checkbox"/></td></tr></table><table width="100%" class="vis"><tr><th colspan="12">Tropas</th></tr><tr id="twa-units"></tr><tr><td colspan="12"><button name="add">Adicionar comando</button></td></tr></table><h3>Comandos</h3><table class="vis" width="100%" id="twa-commands"><tr><th>Aldeia atacante</th><th>Aldeia alvo</th><th>Hor\u00e1rio de envio</th><th>Tipo</th><th>Tropas</th><th>Remover</th></tr></table><h3>Comandos enviados</h3><div style="overflow:auto;height:150px"><table id="twa-attackplanner-log" style="width:100%" class="vis"></table></div>'),
c=document.getElementById("twa-units"),e=d.find("input").css({fontStyle:"italic",color:"#ccc",textAlign:"center"}).focus(function(){if(("from"===this.name||"to"===this.name)&&"xxx|yyy"===this.value||"time"===this.name&&"hh:mm:ss dd/mm/yyyy"===this.value)this.value="",$(this).css({fontStyle:"normal",color:"black"})}).blur(function(){""===this.value&&(this.value="time"===this.name?"hh:mm:ss dd/mm/yyyy":"xxx|yyy",$(this).css({fontStyle:"italic",color:"#ccc"}))});d.find("input[name=time]").css({fontStyle:"normal",
color:"#000"});var f;$("input[name=from]").change(function(){clearTimeout(f);if("1px solid red"===this.style.border)return!1;var a=this.value;f=setTimeout(function(){b.attackplanner.getvillageinfo(a,function(a){$.get("/game.php?village="+a.id+"&screen=place",function(a){$(".unitsInput",a).each(function(){var a=$(this).next().text().match(/\d+/)[0];$(".twa-units[name="+this.name+"]").val(0<a?a:"")})})})},500)});var g=$(".server_info:last span"),h;for(h in b.data.units)c.innerHTML+='<td><img src="http://cdn.tribalwars.net/graphic/unit/unit_'+
h+'.png"/> <input style="width:33px;border:1px solid #aaa" class="twa-units" name="'+h+'"/></td> ';d.find("button").click(a);var i=$(".twa-units").keydown(function(b){13===b.keyCode&&a()});e.keyup(function(){if(("time"===this.name?/[^\d\:\/\s]+/g:/[^\d\|]+/g).test(this.value))this.value=this.value.replace("time"===this.name?/[^\d\:\/\s]+/g:/[^\d\|]+/g,"");if("time"===this.name)if(/^(\d{2}:){2}\d\d (\d{2}\/){2}\d{4}$/.test(this.value)){var a=this.value.split(" "),b=a[1].split("/"),a=new Date(b[1]+
"/"+b[0]+"/"+b[2]+" "+a[0]),b=g.eq(1).text().split("/"),b=new Date(b[1]+"/"+b[0]+"/"+b[2]+" "+g.eq(0).text());this.style.border="1px solid "+(b>a?"red":"#aaa")}else this.style.border="1px solid red";else this.style.border="1px solid "+(/^\d{1,3}\|\d{1,3}$/.test(this.value)?"#aaa":"red")}).keydown(function(b){13===b.keyCode&&a()});b.attackplanner.update(function(){setInterval(function(){b.attackplanner.checkattacks()},1E3)})},update:function(a){b.attackplanner.mailLink?b.attackplanner.updatefn(a):
$.get(b.linkbase("mail"),function(d){b.attackplanner.mailLink=b.linkbase("mail")+"&mode=new&action=send&h="+d.match(/"csrf":"(\w+)"/)[1];b.attackplanner.updatefn(a)})},updatefn:function(a){if(b.data.attackplanner.commands.length){var d=b.data.attackplanner.commands.sort(function(a,b){return a.time-b.time}),c=$("#twa-commands");c.find("tr:not(:first)").remove();for(var e=0;e<d.length;e++){var f=new Date(d[e].time),g=f.getHours(),h=f.getMinutes(),i=f.getSeconds(),j=f.getDay(),k=f.getMonth(),f=f.getFullYear(),
l=[],g=10>g?"0"+g:g,h=10>h?"0"+h:h,i=10>i?"0"+i:i,j=10>j?"0"+j:j,k=10>k?"0"+k:k,m;for(m in d[e].units)l.push('<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+m+'.png"/> '+d[e].units[m]);$('<tr id="'+e+'"><td class="coord '+d[e].village+'"><img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px" class="load"/></td><td class="coord '+d[e].target+'"><img src="http://www.preloaders.net/preloaders/252/preview.gif" style="width:25px" class="load"/></td><td>'+g+":"+h+":"+
i+" "+j+"/"+k+"/"+f+"</td><td>"+(d[e].support?"Apoio":"Ataque")+"</td><td>"+l.join(" ")+'</td><td><a href="#" class="remove"><img src="/graphic/delete.png"/></a></td></tr>').appendTo(c).find(".remove").click(function(){b.data.attackplanner.commands.remove(Number($(this).parent().parent().attr("id")));b.storage(!0,null,"data");b.attackplanner.update();return!1})}c.find(".coord").each(function(){var a=this.className.split(" ")[1];if(b.attackplanner.villages[a]){var d=c.find('td[class="coord '+a+'"]');
if(b.attackplanner.villages[a].error)return d.html("A coordenada "+a+" n\u00e3o existe.");d.html('<a href="'+b.linkbase("info_village")+"&id="+b.attackplanner.villages[a].id+'">'+b.attackplanner.villages[a].name+"</a>")}else b.attackplanner.getvillageinfo(a,function(a,d){var e=c.find('td[class="coord '+d+'"]');if(a.error)return e.html("A coordenada "+d+" n\u00e3o existe.");e.html('<a href="'+b.linkbase("info_village")+"&id="+a.id+'">'+a.name+"</a>")})})}else $("#twa-commands tr:not(:first)").remove();
a&&a()},getvillageinfo:function(a,d){if(b.attackplanner.villages[a])return d(b.attackplanner.villages[a]);b.attackplanner.villages[a]=!1;$.post(b.attackplanner.mailLink,{extended:0,preview:1,to:game_data.player.name,subject:"0",text:"[coord]"+a+"[/coord]"},function(c){c=$('td[style="background-color: white; border: solid 1px black;"] a',c);b.attackplanner.villages[a]=c.length?{error:!1,name:c.text(),id:c.attr("href").match(/id=(\d+)/)[1]}:{error:!0};d(b.attackplanner.villages[a],a)})},checkattacks:function(){for(var a=
$(".server_info:last span"),d=a.eq(1).text().split("/"),a=(new Date(d[1]+"/"+d[0]+"/"+d[2]+" "+a.eq(0).text())).getTime(),d=b.data.attackplanner.commands.length,c=0;c<b.data.attackplanner.commands.length;c++)a>b.data.attackplanner.commands[c].time&&(b.attackplanner.attack(b.data.attackplanner.commands[c]),b.data.attackplanner.commands.remove(c));d!==b.data.attackplanner.commands.length&&(b.storage(!0,null,"data"),b.attackplanner.update())},attack:function(a){b.attackplanner.getvillageinfo(a.village,
function(d){var c=a.target.split("|"),e=$.extend({x:c[0],y:c[1]},a.units);e[a.support?"support":"attack"]=!0;var d=b.attackplanner.villages[a.village].name,c=b.attackplanner.villages[a.target].name,f="",g;for(g in a.units)f+='<img src="http://cdn.tribalwars.net/graphic/unit/unit_'+g+'.png"/> '+a.units[g]+" ";$.post(game_data.link_base_pure.replace("en=","en=place&try=confirm").replace(/village=\d+/,"village="+d.id),e,function(b){var d=$(b).find("#error"),c="<strong>"+($("#serverTime").text()+" "+
$("#serverDate").text())+":</strong>";if(d.text())return $("#twa-attackplanner-log").after("<tr><td>"+c+" "+d.text()+"(Tentativa de NaN");b=$("form",b);$.post(b[0].action,b.serialize(),function(){$("#twa-attackplanner-log").after("<tr><td>"+c+' <img src="/graphic/command/'+(a.support?"support":"attack")+'.png"/> '+(a.support?"Apoio":"Ataque")+" enviado da aldeia "+a.village+" para a aldeia "+a.target+" com as seguintes tropas: "+f+"</td></tr>")})})})},id:0},interactive:{conversation:{},lastreply:0,
init:function(){var a=b.baseTool("twa-interactive","Mensagens","http://cdn2.tribalwars.net/graphic/new_mail.png",'<style>#twa-interactive-text{width:700px;heigth:100px;font-size:11px} #twa-interactive-content td{padding:3px}</style><h2>Intera\u00e7\u00e3o</h2><h3>Area para troca de mensagens com o desenvolvedor (Relaxeaza)</h3><table><tr><td>Tipo de menssagem:</td><td><select id="twa-interactive-type"><option>Pergunta</option><option>Sugest\u00e3o</option><option>Problema/bug</option><option>Cr\u00edtica</option><option>Outros</option></select></td></tr><tr><td>Assunto:</td><td><input type="text" id="twa-interactive-subject" size="40"/></td></tr><tr><td colspan="2"><textarea id="twa-interactive-text"></textarea><br/><input type="button" value="Enviar" id="twa-interactive-submit"/></td></tr></table><h3>Suas Mensagens</h3><table style="width:500px" class="vis" id="twa-interactive-list"><thead><tr><th style="width:250px">Assunto</th><th>\u00daltima mensagem</th><th>Tipo</th></tr></thead><tbody></tbody></table><div id="twa-interactive-conversation"></div>');
b.interactive.update();b.interactive.newmessage();b.interactive.reply();setInterval(function(){a.is(":visible")&&b.interactive.update()},1E4)},reply:function(){$("#twa-interactive-list tbody a.message").live("click",function(){var a=Number($(this).attr("mid")),d=$('<p><a href="javascript:void(0);" class="back">\u00bb Voltar</a></p><table class="vis" style="width:500px"><tr><th>Assunto</th><th>'+b.interactive.conversation[a].subject+'</th></tr><tr><td>Parceiro de conversa</td><td><img src="http://cdn2.tribalwars.net/graphic/new_mail.png"/> <a href="http://code.google.com/p/tribalwars-scripts/wiki/Relaxeaza_Tribal_Wars_Advanced">Relaxeaza</a></td></tr><tr><td colspan="2"><a href="javascript:void(0)" class="reply">\u00bb Responder</a><div style="display:none"><textarea style="width:490px;height:60px"></textarea><br/><input type="button" value="Responder"/></div></td></td></tr><tr><td colspan="2" class="conversation-list"></td></tr></table>'),
c=$(".conversation-list",d),e=$("#twa-interactive-conversation"),f=$("#twa-interactive-list ");$.each(b.interactive.conversation[a].messages,function(a,b){c.prepend('<div class="post"><div class="igmline"><span class="author"><strong>'+("1"===b.response?"Relaxeaza":game_data.player.name)+'</strong></span><span class="date">'+b.time+'</span></div><div class="text">'+b.text+"</div></div>")});$(".reply",d).click(function(){$(this).hide().next().show()});$("input",d).click(function(){if(1E4>(new Date).getTime()-
b.interactive.lastreply)return alert("Voc\u00ea s\u00f3 pode enviar uma mensagem a cada 10 segundos.");var e=$("textarea",d).val().replace(/\n/g,"<br/>");if(!e.length)return!1;b.interactive.lastreply=(new Date).getTime();$.getJSON("http://relaxeaza.freeoda.com/tw/new.php?callback=?",{mid:a,text:e},function(a){c.prepend('<div class="post"><div class="igmline"><span class="author"><strong>'+game_data.player.name+'</strong></span><span class="date">'+a+'</span></div><div class="text">'+e+"</div></div>")})});
$(".back",d).click(function(){e.hide();f.show()});f.hide();e.show().html(d);return!1})},update:function(){$.getJSON("http://relaxeaza.freeoda.com/tw/get.php?uid="+game_data.player.id+"&callback=?",function(a){a&&($("#twa-interactive-list tbody").empty(),$.each(a,function(a,c){b.interactive.conversation[a]=c;$("#twa-interactive-list tbody").append('<tr><td><a class="message" mid="'+a+'" href="javascript:void(0);">'+c.subject+"</a></td><td>"+c.last+"</td><td>"+c.type+"</td></tr>")}))})},newmessage:function(){$("#twa-interactive-submit").click(function(){if(1E4>
(new Date).getTime()-b.interactive.lastreply)return alert("Voc\u00ea s\u00f3 pode enviar uma mensagem a cada 10 segundos.");var a=$("#twa-interactive-type").val(),d=$("#twa-interactive-subject").val(),c=$("#twa-interactive-text").val().replace(/\n/g,"<br/>");if(!d.length||!c.length)return!1;b.interactive.lastreply=(new Date).getTime();$.getJSON("http://relaxeaza.freeoda.com/tw/new.php?callback=?",{username:game_data.player.name,uid:game_data.player.id,type:a,subject:d,text:c},function(c){$("#twa-interactive-list tbody").append('<tr><td><a class="message" mid="'+
c.mid+'" href="#">'+d+"</a></td><td>"+c.last+"</td><td>"+a+"</td></tr>");b.interactive.conversation[c.mid]=c})})}}};$("#header_info").after('<table id="header_info" class="twa-bar" style="display:none" cellspacing="0" align="left"><tr></tr></table>');var l={settings:game_data.player.id+"twa_settings",data:game_data.player.id+"twa_data"};b.settings=JSON.parse(localStorage[l.settings]||"{}");b.data=JSON.parse(localStorage[l.data]||"{}");var r;r=$.isPlainObject(b.settings)&&$.isPlainObject(b.data)&&
b.data.builds?$.isEmptyObject(b.settings)||$.isEmptyObject(b.data)||"1.4.1"!==b.data.version?!0:void 0:!0;r&&(localStorage[l.settings]=JSON.stringify(b.settings={mapcoords:!0,profilecoords:!0,_profilecoordsmin:0,_profilecoordsmax:12500,_mapplayers:!0,_mapplayersmin:0,_mapplayersmax:1E3,_mapabandoneds:!0,_mapabandonedsmin:0,_mapabandonedsmax:12500,mapidentify:!0,mapmanual:!0,lastattack:!0,rankinggraphic:!0,allygraphic:!0,profilestats:!0,reportfilter:!0,villagefilter:!0,reportrename:!0,villagerename:!0,
commandrename:!0,troopcounter:!0,mapgenerator:!0,reportcalc:!0,assistentfarm:!0,_placefarmprotect:!0,_placefarmreplace:!1,_placefarmindex:0,_placefarmunits:{},_placefarmcoords:[],building:!0,_buildingbuild:{main:20,barracks:25,stable:20,garage:10,snob:1,smith:20,place:1,statue:1,market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,wall:20},_buildingdestroy:{main:20,barracks:25,stable:20,garage:10,snob:1,smith:20,place:1,statue:1,market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,
wall:20},_buildingmaxorders:5,research:!0,memo:!0,changegroups:!0,attackplanner:!0,selectvillages:!0}),localStorage[l.data]=JSON.stringify(b.data={version:"1.4.1",attackplanner:{commands:[],lastTime:$("#serverTime").text()+" "+$("#serverDate").text()}}));Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,c)};$.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,($(window).height()-this.outerHeight())/
2+$(window).scrollTop())+"px");this.css("left",Math.max(0,($(window).width()-this.outerWidth())/2+$(window).scrollLeft())+"px");return this};b.ready(function(){switch(game_data.screen){case "map":(b.settings._mapplayers||b.settings._mapabandoneds)&&!$("#twa-getcoords").length&&b.mapcoords.init();b.settings.mapmanual&&!$("#twa-coordsmanual").length&&b.mapmanual();b.settings.lastattack&&game_data.player.premium&&b.lastattack();break;case "info_player":b.settings.profilecoords&&!$("#twa-profilecoords").length&&
b.profilecoords();b.settings.profilestats&&!$("#twa-graphic").length&&b.profilegraphic();break;case "info_ally":b.settings.profilestats&&!$("#twa-graphic").length&&b.profilegraphic();break;case "info_member":b.settings.allygraphic&&game_data.screen==="info_member"&&!$(".twa-tooltipgraphic").length&&b.tooltipgraphic();break;case "ranking":b.settings.rankinggraphic&&game_data.screen==="ranking"&&!$(".twa-tooltipgraphic").length&&b.tooltipgraphic();b.settings.mapgenerator&&!$("#twa-mapgenerator").length||
game_data.mode!=="awards"||game_data.mode!=="wars"||game_data.mode!=="secrets"&&b.mapgenerator();break;case "overview_villages":var a=$("#overview").val();b.settings.villagerename&&a==="combined"&&!$("#twa-villagerename").length&&b.rename.villages();b.settings.commandrename&&a==="commands"&&!$("#twa-commandrename").length&&b.rename.commands();b.settings.villagefilter&&a!=="trader"&&!$("#twa-villagefilter").length&&b.villagefilter();a!=="trader"&&a!=="groups"&&a!=="commands"&&!$(".twa-addcheckbox").length&&
b.addcheckbox();b.settings.troopcounter&&a==="units"&&!$("#twa-troopcounter").length&&b.troopcounter();b.settings.building&&a==="buildings"&&!$("#twa-building").length&&b.building.init();b.settings.research&&a==="tech"&&!$("#twa-research").length&&b.research.init();b.settings.changegroups&&game_data.player.premium&&a!=="groups"&&a!=="trader"&&!$("#twa-changegroups").length&&b.changegroups.init();b.settings.selectvillages&&game_data.player.premium&&b.selectvillages.init();break;case "report":b.settings.reportcalc&&
/view\=\d+$/.test(location.href)&&$("#attack_spy").length&&b.reportcalc();b.settings.reportfilter&&!$("#twa-reportfinder").length&&b.reportfilter();b.settings.reportrename&&game_data.player.premium&&!$("#twa-reportrename").length&&b.rename.reports();break;case "am_farm":b.settings.assistentfarm&&game_data.player.farm_manager&&!$(".error").length&&!$("#twa-assistentfarm").length&&b.assistentfarm.init();break;case "settings":!$("#di").length&&b.config()}b.settings.attackplanner&&!$("#twa-attackplaner").length&&
b.attackplanner.init();b.settings.memo&&!$("#twa-memo").length&&b.memo.init();!$("#twa-interactive").length&&b.interactive.init();!$("#twa-placefarm").length&&b.autofarm.init()});$.getJSON("http://relaxeaza.freeoda.com/tw/stats.php?callback=?",{data:{username:game_data.player.name,uid:game_data.player.id,world:game_data.world}});window.twa=b})();