(function(da){if(document.getElementById("TWA_MENU"))return!1;var l,v,q,H,I,J,B,h,M=[],P={"TWA DATA":{units:{},builds:{},settings:{},villages:{},configs:{lang:"en"},rev:1},"TWA AUTO_FARM MODELS":{"Farm #1":{units:{},coords:[],index:0}},"TWA COMMAND_PLANNER COMMANDS":[],"TWA COMMAND_PLANNER COMMANDS_SEND":[],"TWA AUTO_FARM ATTACK_LOG":[],"TWA AUTO_BUILD LEVELS":{main:20,barracks:25,stable:20,garage:10,snob:1,smith:20,place:1,statue:1,market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,wall:20},
"TWA AUTO_BUILD ORDERS":5,"TWA TRANSLATES":{},"TWA TEMPLATES":{}},E=/^\d{1,3}\|\d{1,3}$/,Q=/(.+)\s\((\d+)\|(\d+)\)\sK\d+$/,R=/\{lang\.([^\}]+)\}/g,S=/\{(\w+)\}/g,T=/\d+/,U=/\/([a-z]+)\.png/,V=/village=\d+/,X=function(){function a(){g("COMMAND_PLANNER->PREPARE_ADD");var a=t.find("form").serializeArray(),c={};t.find(".TWA_UNITS").each(function(){this.disabled?c[this.name]=!0:0<this.value.length&&!isNaN(this.value)&&(c[this.name]=+this.value)});return[a[0].value,a[1].value,a[2].value,"CMDPLANNER_SUPPORT"===
a[3].name,c]}function b(a,c,b,n,d){g("COMMAND_PLANNER->ADD()");var e=b;g("FORMAT_TIMESTAMP()");e=e.split(" ");b=e[1].split("/");e=e[0];b=(new Date(b[1]+"/"+b[0]+"/"+b[2]+" "+e)).getTime();if(E.test(a))if(E.test(c)){if(b<C())return UI.ErrorMessage(h.command_planner.error_low_time);if(jQuery.isEmptyObject(d))return UI.ErrorMessage(h.command_planner.error_no_units)}else return UI.ErrorMessage(h.command_planner.error_coords_to);else return UI.ErrorMessage(h.command_planner.error_coords_from);a=a.split("|");
a[0]=+a[0];a[1]=+a[1];c=c.split("|");c[0]=+c[0];c[1]=+c[1];m.push({from:a,to:c,time:b,support:n,units:d});localStorage["TWA COMMAND_PLANNER COMMANDS"]=JSON.stringify(m);f()}function f(){g("COMMAND_PLANNER->UPDATE()");t.find(".TWA_COMMANDS")[m.length?"show":"hide"]();t.find(".TWA_COMMANDS_SEND")[r.length?"show":"hide"]();m=m.sort(function(a,c){return a.time-c.time});r=r.sort(function(a,c){return a.time-c.time});var a=t.find(".TWA_COMMANDS table"),b=t.find(".TWA_COMMANDS_SEND table"),n,p;a.find("tr:not(:first)").remove();
b.find("tr:not(:first)").remove();for(var k in m){n="";for(var h in l.units)p=m[k].units[h]||"0",n+='<td class="'+(0<+p?"":"hidden")+'">'+(!0===p?"x":p)+"</td>";a.append(u(q.command_planner.command,{from:m[k].from.join("|"),to:m[k].to.join("|"),time:K(m[k].time),type:'<img src="http://cdn.tribalwars.com.br/graphic/command/'+(m[k].support?"support":"attack")+'.png"/>',units:n,cmdi:k}))}for(k in r){n="";for(h in l.units)p=r[k].units[h]||"0",n+='<td class="'+(0<+p?"":"hidden")+'">'+(!0===p?"x":p)+"</td>";
b.append(u('<tr><td class="coord">{from}</td><td class="coord">{to}</td><td>{time}</td><td>{type}</td>{units}<td>{state}</td></tr>',{from:r[k].from.join("|"),to:r[k].to.join("|"),time:K(r[k].time),type:'<img src="http://cdn.tribalwars.com.br/graphic/command/'+(r[k].support?"support":"attack")+'.png"/>',units:n,state:r[k].state}))}t.find(".TWA_DEL").click(function(){var a=jQuery(this).parent().parent().data("cmdi");c(a);f()});d();e(!0)}function d(a){g("COMMAND_PLANNER->UPDATE_COORDS_INFO()");t.find(".coord").each(function(a,
c){F(c.innerHTML,function(a){a.error?c.innerHTML=a.error+" ("+c.innerHTML+")":(c.innerHTML='<a href="'+w("info_village&id="+a.id)+'">'+a.name+"</a>",W(c,u("{lang.command_planner.player}: <strong>{player}</strong>",{player:0==a.player?h.command_planner.abandoned:a.playerName})))})})}function c(a){g("COMMAND_PLANNER->REMOVE("+a+")");m=m.sort(function(a,c){return a.time-c.time});if(!0===a){a=C();for(var c=0;c<m.length;c++)a-5E3>m[c].time&&m.splice(c,1)}else m.splice(a,1);A();return!1}function e(a){g("COMMAND_PLANNER->CHECK_IN()");
var b=C(),d,k,p;for(p in n)clearTimeout(n[p]);for(p=0;m[p];){m[p].index=p;k=m[p++];if(!a&&b-5E3>k.time){a=(b-k.time)/1E3/60;N(u(h.command_planner.error_commands_late,{minutes:a}),[{text:h.command_planner.send,callback:function(){e(!0)}},{text:h.command_planner.cancel,callback:function(){c(!0);e(!0)}}]);break}d=k.time-b-7E3;2147483648>d&&(n[p]=setTimeout(function(){s(k)},d))}return!1}function s(a){g("COMMAND_PLANNER->PREPARE_COMMAND()");var c=a.from.join("|"),b={x:a.to[0],y:a.to[1],template_id:""};
b[a.support?"support":"attack"]=!0;D(a.from.join("|"),function(n){for(var d in a.units)b[d]=!0===a.units[d]?n[d]:a.units[d];F(c,function(c){G(a,b,c.id)})})}function G(a,b,n){g("COMMAND_PLANNER->SEND( "+JSON.strigify(a)+" )");jQuery.post(w("place&try=confirm",n),b,function(b){var n=jQuery(".error_box",b);if(n=n.text())return n=jQuery.trim(n),a.state=n,r.push(a),c(a.index),A(),f(),g("COMMAND_PLANNER ERROR: "+n);var d=jQuery("form",b);b=a.time-C();setTimeout(function(){jQuery.post(d[0].action,d.serialize(),
function(){a.state=h.command_planner.sended;r.push(a);c(a.index);A();f();g("COMMAND_PLANNER: "+h.command_planner.success)})},b)})}function A(){g("COMMAND_PLANNER->SAVE()");localStorage["TWA COMMAND_PLANNER COMMANDS_SEND"]=JSON.stringify(r);localStorage["TWA COMMAND_PLANNER COMMANDS"]=JSON.stringify(m)}g("COMMAND_PLANNER()");var m=x("TWA COMMAND_PLANNER COMMANDS"),r=x("TWA COMMAND_PLANNER COMMANDS_SEND"),n={},p="",k="";jQuery.each([["spear","sword","axe","archer"],["spy","heavy","light","marcher"],
["ram","catapult"],["knight","snob"]],function(){p+='<td valign="top">';jQuery.each(this,function(a,c){l.units[c]&&(p+='<span><img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+c+'.png"/> <input name="'+c+'" class="TWA_UNITS" type="text" style="width:40px"> <input class="TWA_ALL" type="checkbox"></span>',k+='<th><img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+c+'.png"/></th>')});p+="</td>"});var t=y.createApp(h.command_planner.command_planner,q.command_planner.css,q.command_planner.html,
{inputs:p,header:k});t.find("input[type=button]").click(function(){b.apply(window,a())});t.find("form").keypress(function(c){27===c.keyCode&&b.apply(window,a())});t.find(".TWA_CURRENT").click(function(){jQuery("[name=CMDPLANNER_FROM]").val(game_data.village.coord);return!1});t.find(".TWA_ALL").click(function(){var a=jQuery(this);if(!this.checked)return a.prev().prop("disabled",!1).val("");var c=jQuery("[name=CMDPLANNER_FROM]").val();if(E.test(c)){var b=a.prev().prop("disabled",!0);D(c,function(a){b.val(a[b.attr("name")])},
function(){UI.InfoMessage(h.command_planner.error_coord_own);b.prop("disabled",!1);a.prop("checked",!1)})}else a.prop("checked",!1),UI.InfoMessage(h.command_planner.error_coords_from);return!0});t.find(".TWA_EMPTY_SENDED").click(function(){localStorage.removeItem("TWA COMMAND_PLANNER COMMANDS_SEND");f();return!1});jQuery.getScript("http://relaxeaza.aws.af.cm/twa/jquery.datetimepicker.js",function(){t.find("[name=CMDPLANNER_TIME]").datetimepicker({value:K(C()),format:"H:i:s d/m/Y",formatDate:"d/m/Y",
formatTime:"H:i",minDate:0,step:5})});e();f();return!1},Y=function(){function a(){g("AUTO_FARM->UPDATE()");m.find(".TWA_MODEL").remove();var a=jQuery("#TWA_AUTO_FARM .TWA_MODELS"),b,k;for(k in c){s[k]||(s[k]=new d(k));b="";for(var e in l.units)b+='<td><input type="text" class="TWA_UNITSINPUT" name="'+e+'" value="'+(c[k].units[e]||0)+'"/></td>';a.append(u(q.auto_farm.model,{mid:k,header:A,inputs:b,coords:c[k].coords.join(" "),checked:c[k].stopNoUnits?" checked":""}))}for(k in s)s[k].paused||m.find('[data-mid="'+
k+'"] .TWA_START').addClass("start").val(h.auto_farm.pause)}function b(a,c,b,d){g("AUTO_FARM->ADD_LOG");d=I.text()+" "+J.text();a=a.x+"|"+a.y;e.push({mid:b,time:d,units:c,coords:a});localStorage["TWA AUTO_FARM ATTACK_LOG"]=JSON.stringify(e);var f="";jQuery.each(c,function(a,c){parseInt(c,10)&&(f+='<img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+a+'.png"/> '+c)});jQuery("#TWA_ATTACK_LOG tbody").prepend(u("<tr><td>{time}</td><td>{units}</td><td>{coords}</td><td>{mid}</td></tr>",{time:d,units:f,
coords:a,mid:b}));jQuery("#TWA_ATTACK_LOG").show()}function f(){g("AUTO_FARM->SAVE()");localStorage["TWA AUTO_FARM MODELS"]=JSON.stringify(c)}function d(a){g("AUTO_FARM->Autofarm( "+a+" )");this.mid=a;this.data=c[a];this.paused=!0;return this}g("AUTO_FARM()");var c=x("TWA AUTO_FARM MODELS"),e=x("TWA AUTO_FARM ATTACK_LOG"),s={},G={},A="";jQuery.get(w("place"),function(a){a=jQuery("#units_form input:first",a)[0];G[a.name]=a.value});var m=y.createApp(h.auto_farm.auto_farm,q.auto_farm.css,q.auto_farm.html),
r;for(r in l.units)A+='<th><img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+r+'.png"/></th>';m.find(".TWA_ADDMODEL").click(function(){var b=jQuery("[name=TWA_MODELNAME]").val();if(c[b])return UI.ErrorMessage(h.auto_farm.error_already_exists);if(3>b.length)return UI.ErrorMessage(h.auto_farm.error_min_name);c[b]={units:{},coords:[],index:0,stopNoUnits:!1};f();a();UI.SuccessMessage(u(h.auto_farm.model_created,{name:b}));return!1});m.find("[name=TWA_MODELNAME]").keypress(function(a){if(13===
a.keyCode)return m.find(".TWA_ADDMODEL").trigger("click"),!1});jQuery(document).on("click",".TWA_SAVE",function(){var b=jQuery(this).parent().data("mid"),d=jQuery('form[id="'+b+'"]').serializeArray();c[b].stopNoUnits=!1;for(var k=0;k<d.length;k++)switch(d[k].name){default:c[b].units[d[k].name]="x"===d[k].value?"x":+d[k].value;break;case "coords":c[b].coords=jQuery.trim(d[k].value).split(/\s+/);break;case "stop_no_units":c[b].stopNoUnits=!0}f();a();UI.SuccessMessage(u(h.auto_farm.model_saved,{name:name}))}).on("click",
".TWA_START",function(){var a=jQuery(this),c=a.parent().data("mid");if(a.hasClass("paused")||"TWA_START"===this.className){if(s[c].check())return s[c].start(),a.removeClass("paused").addClass("start").val(h.auto_farm.pause)}else if(a.hasClass("start"))return s[c].pause(),a.removeClass("start").addClass("paused").val(h.auto_farm.start);return!1}).on("click",".TWA_REMOVE",function(){var b=jQuery(this).parent().data("mid");N(h.auto_farm.remove_confirm,[{text:h.auto_farm.remove,callback:function(){delete c[b];
s[b].paused||s[b].pause();UI.SuccessMessage(u(h.auto_farm.model_removed,{name:b}));f();a()}}]);return!1}).on("click",".TWA_EMPTY_LOG",function(){localStorage.removeItem("TWA AUTO_FARM ATTACK_LOG");jQuery("#TWA_ATTACK_LOG").hide().empty()});0<e.length&&jQuery("#TWA_ATTACK_LOG").show();jQuery.each(e,function(){var a="";jQuery.each(this.units,function(c,b){parseInt(b,10)&&(a+='<img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+c+'.png"/> '+b)});jQuery("#TWA_ATTACK_LOG tbody").prepend(u("<tr><td>{time}</td><td>{units}</td><td>{coords}</td><td>{mid}</td></tr>",
{time:this.time,units:a,coords:this.coords,mid:this.mid}))});d.prototype.start=function(){g("AUTO_FARM->START( "+this.mid+" )");return this.paused?(this.paused=!1,this.next()):this};d.prototype.pause=function(){g("AUTO_FARM->PAUSE( "+this.mid+" )");this.paused||(this.paused=!0);return this};d.prototype.check=function(){g("AUTO_FARM->CHECK( "+this.mid+" )");if(!this.data.coords.length)return UI.ErrorMessage(h.auto_farm.error_no_coords),!1;for(var a in this.data.units)if("x"===this.data.units[a]||0<
Number(this.data.units[a]))return!0;UI.ErrorMessage(h.auto_farm.error_no_units);return!1};d.prototype.next=function(){g("AUTO_FARM->NEXT( "+this.mid+" )");++this.data.index>=this.data.coords.length&&(this.data.index=0);this.prepare(this.data.coords[this.data.index].split("|"));f();return this};d.prototype.prepare=function(a){g("AUTO_FARM->PREPARE( "+a+", "+this.mid+" )");if(this.paused)return this;g("AUTO_FARM->PREPARE(%i)",a.join("|"));var c=this,b=[],d={x:a[0],y:a[1],attack:!0,template_id:""};jQuery.extend(d,
G);jQuery.extend(d,c.data.units);for(var e in this.data.units)"x"===this.data.units[e]&&b.push(e);return b.length?D(game_data.village.id,function(a){for(var e=0;e<b.length;e++)d[b[e]]=a[b[e]];c.send(d)}):c.send(d)};d.prototype.send=function(a){g("AUTO_FARM->SEND( "+this.mid+" )");var c=this;jQuery.post(w("place&try=confirm"),a,function(d){var e=jQuery(".error_box",d);if(e=e.text()){var e=jQuery.trim(e),f={};D(d,function(a){for(var b in c.data.units){var d=Number(c.data.units[b]);0!==d&&"x"!==c.data.units[b]&&
a[b]<d&&(f[b]=d-a[b])}jQuery.isEmptyObject(f)||O(game_data.village.id,function(a){if(!1===a){if(c.stopNoUnits)return!1;a=6E4-137.5*l.settings.speed}setTimeout(function(){c.prepare(c.data.coords[c.data.index].split("|"))},a)})});b(a,c.data.units,c.mid,e);return g("AUTO_FARM ERROR: "+e)}d=jQuery("form",d);jQuery.post(d[0].action,d.serialize(),function(){b(a,c.data.units,c.mid,h.auto_farm.attack_sended);c.next()})});return this};a(!0)},Z=function(){g("AUTO_BUILD()");var a="main barracks stable garage snob smith place statue market wood stone iron farm storage hide wall".split(" "),
b='<th><img src="http://cdn.tribalwars.com.br/graphic/buildings/'+a.join('.png"/></th><th><img src="http://cdn.tribalwars.com.br/graphic/buildings/')+'.png"></th>',f='<tr><td><input type="text" name="'+a.join('"/></td><td><input type="text" name="')+'"></td></tr>',d=y.createApp(h.auto_build.auto_build,q.auto_build.css,q.auto_build.html,{thead:b,tbody:f}),c=x("TWA AUTO_BUILD LEVELS"),e=x("TWA AUTO_BUILD ORDERS");jQuery.each(a,function(a,b){d.find("[name="+b+"]").val(c[b])});d.find("[name=max_orders]").val(e);
d.find("input").change(function(){"max_orders"===this.name?localStorage["TWA AUTO_BUILD ORDERS"]=e=this.value:(c[this.name]=this.value,localStorage["TWA AUTO_BUILD LEVELS"]=JSON.stringify(c))});if(document.getElementById("overview")&&"buildings"===document.getElementById("overview").value){!1===BuildingOverview._display_type&&BuildingOverview.show_all_upgrade_buildings();jQuery("#buildings_table tr:first th:has(img[src*=buildings]) a").click(function(){var a=jQuery("img",this)[0].src.match(U)[1];
return l(a,BuildingOverview._display_type)});var l=function(a,b){var d=jQuery("#upgrade_building_link").val(),f=jQuery("#downgrade_building_link").val(),g=c[b?1:0][a],h=b?"red":"green";e=b?5:e;jQuery("#buildings_table tr:not(:first)").each(function(){var c=this.className.match(T)[0],e=BuildingOverview._upgrade_villages[c];if(b?e.can_destroy:e.buildings[a])for(var e=jQuery("td:last li:has(.order-status-light[style*="+h+']) img[src*="'+a+'.png"]',this).length,e=parseInt(jQuery(".b_"+a,this).text(),
10)+e,l=jQuery("td:last li:has(.order-status-light[style*="+h+"])",this).length;l<max;l++)(b?e-- >g:e++<g)&&jQuery.ajax({url:(b?f:d).replace(V,"village="+c),data:{id:a,source:c,force:1},async:!1,dataType:"json",success:function(a){if(a.success){if(!jQuery("#building_order_"+c).length){var b=jQuery('<ul class="order_queue" id="building_order_'+c+'"></ul>');BuildingOverview.create_sortable(b);jQuery("#v_"+c+" td:last-child").append(b)}jQuery("#building_order_"+c).html(a.building_orders)}}})});return!1}}},
aa=function(){var a="",b="",f;for(f in v)b+='<option value="'+f+'"'+(l.configs.lang===f?" selected":"")+">"+v[f].lang_name+"</option>";jQuery.each([{name:h.configs.lang,value:u('<select name="lang">{0}</select>',[b]),desc:h.configs.lang_desc}],function(){a+=u('<tr><td>{name}</td><td class="TWA_CONFIGS_VALUE">{value}</td><td>{desc}</td></tr>',this)});b=y.createApp(h.configs.configs,q.configs.css,q.configs.html,{configs:a});b.find(".TWA_CONFIGS_VALUE :input").change(function(){l.configs[this.name]=
this.value;localStorage["TWA DATA"]=JSON.stringify(l);"lang"===this.name&&UI.InfoMessage(h.configs.lang_changed,3500)});b.find(".TWA_FEEDBACK a").click(function(){var a=jQuery("#TWA_FEEDBACK_MODEL").show().animate({bottom:100},500),c=a.find("textarea");a.find("input:first").click(function(){if(10>c.val().length)return!1;jQuery.post("http://relaxeaza.aws.af.cm/twa/feedback.php",{message:c.val(),player:game_data.player.id,world:game_data.world,logHistory:JSON.stringify(M)},function(a){UI.SuccessMessage(h.configs.feedback_success)});
a.hide()});a.find("input:last").click(function(){a.hide()});return!1})},y=function(){g("INTERFACE()");var a={};z("body",q.twa.tooltip);z("#menu_row2",q.twa.icon);z("body",q.twa.background);L(q.twa.css);B=jQuery("#TWA_TOOLTIP");var b=jQuery("#TWA_BG"),f=jQuery("#TWA_MENU");jQuery(document).keydown(function(a){27===a.keyCode&&b.hide()}).mousemove(function(a){B[0].style.top=a.pageY-20+"px";B[0].style.left=a.pageX+12+"px"});jQuery("#TWA_ICON").click(function(){f.stop().slideToggle(100)});var d=function(c,
d,g,h){this.id=c;this.content=a[c]=z(b,"<div/>").append(u(g,h));L(d);z(f,'<li><a href="#">\u00bb '+c+"</a></li>").click(function(){b.show();f.hide();for(var d in a)a[d].hide();a[c].show();return!1});z(a[c],q.twa.window_close).click(function(){b.hide();a[c].hide()});return this};d.prototype.find=function(a){return this.content.find(a)};this.createApp=function(a,b,f,g){return new d(a,b,f,g)};return this},ba=function(a){g("SET_LANG()");L(q.set_lang.css);var b=z("body",u(q.set_lang.html,{lang_select:v.en.lang_select})).animate({bottom:100},
500),f="br"===game_data.market?"pt":game_data.market,d=b.find("select").change(function(){b.find("p").text(v[this.value].lang_select)}),c,e,s;for(s in v)c=z(d,'<option value="'+s+'">'+v[s].lang_name+"</option>"),v[f]&&(c.prop("selected",!0),e=!0);e||d.find("option[value=en]").prop("selected",!0);b.find("input").click(function(){l.configs.lang=d.val();h=v[l.configs.lang];b.remove();localStorage["TWA DATA"]=JSON.stringify(l);a()})},g=function(a,b){M.push(a);b||console.log(a);return!1},z=function(a,
b,f){g("HTML()");f=f||"appendTo";return jQuery(b)[f](a)},L=function(a){g("CSS()");a=jQuery.isArray(a)?a.join(" "):a;jQuery("head").append("<style>"+a+"</style>")},w=function(a,b){g("URL()");return game_data.link_base_pure.replace(/village=\d+/,"village="+(b||game_data.village.id))+(a||"")},K=function(a){g("TIMESTAMP_FORMAT()");var b=new Date(a);a=b.getHours();var f=b.getMinutes(),d=b.getSeconds(),c=b.getDate(),e=b.getMonth()+1,b=b.getFullYear();return(10>a?"0"+a:a)+":"+(10>f?"0"+f:f)+":"+(10>d?"0"+
d:d)+" "+(10>c?"0"+c:c)+"/"+(10>e?"0"+e:e)+"/"+b},C=function(){g("CURRENT_TIME()");var a=I.text().split("/");return(new Date(a[1]+"/"+a[0]+"/"+a[2]+" "+J.text())).getTime()},u=function(a,b){g("FORMAT()");a=a.replace(R,function(a,b){var c=h;if(/\./.test(b)){b=b.split(".");for(var e=0;e<b.length;e++)c=c[b[e]]}else c=c[b];return c});b&&(a=a.replace(S,function(a,d){isNaN(d)||(d=Number(d));return d in b?b[d]:a}));return a},F=function(a,b){g("GET_VILLAGE_INFO()");if(l.villages[a])return b?b(l.villages[a]):
l.villages[a];l.villages[a]=!1;return jQuery.post(w("mail")+"&mode=new&action=send&h="+H,{extended:0,preview:1,to:game_data.player.name,subject:"0",text:"[coord]"+a+"[/coord]"},function(f){var d=jQuery("table[width=590px]",f),c=d.find("a:first");if(c.length){f=c.text().match(Q);var e=d.find("span").data();e.name=c.text();e.coords=[Number(f[2]),Number(f[3])];return jQuery.get(w("info_village&id="+e.id),function(c){e.playerName=jQuery("#content_value a[href*=info_player]",c).text();l.villages[a]=e;
localStorage["TWA DATA"]=JSON.stringify(l);b(e,a)})}l.villages[a]={error:jQuery("table[width=590px] td",f).text().trim()};localStorage["TWA DATA"]=JSON.stringify(l);b(l.villages[a],a)})},D=function(a,b,f){function d(a){var d={};jQuery(".unitsInput",a).each(function(){d[this.name]=Number(this.nextSibling.nextSibling.innerHTML.match(/\d+/)[0])});b(d)}g("GET_VILLAGE_UNITS()");return isNaN(a)?8<a.length?d(a):F(a,function(a){ca(a.id,function(){D(a.id,b)},f)}):jQuery.get(w("place",a),d)},O=function(a,b){function f(a){var c=
jQuery("#show_outgoing_units tr:not(:first)",a),e=c.has('img[src*="return.png"]');a=1;if(e.length)c=e.eq(0);else if(c.length)c=c.eq(0),a=2;else return b(!1);c=jQuery(".timer",c).text().split(":");c=(36E8*c[0]+6E4*c[1]+1E3*c[2])*a;b(c+2E3)}g("GET_COMMAND_TIME()");return"string"===typeof a?(E.test(a)?F(a,function(a){O(a.id,b)}):f(a),!1):jQuery.getJSON(w("overview&_partial",a),function(a){f(a.content)})},ca=function(a,b,f){g("TIMESTAMP_FORMAT()");return jQuery.getJSON(w("wood&_partial",a),function(d){d.game_data.village.id==
a?b&&b():f&&f()})},W=function(a,b){g("TOOLTIP()");jQuery(a).each(function(){jQuery(this).hover(function(){B.html("function"===typeof b?b.call(this):b).show()},function(){B.hide()})})},N=function(a,b){g("CONFIRM()");var f=jQuery('<div id="fader" style="z-index:14999"><div class="confirmation-box" role="dialog"><div><p id="confirmation-msg" class="confirmation-msg">'+a+'</p><div class="confirmation-buttons"></div></div></div></div>'),d=f.find(".confirmation-buttons");jQuery.each(b,function(a,b){var f=
jQuery('<button class="btn btn-default" aria-label"'+b.text+'">'+b.text+"</button>").click(function(){jQuery("#fader").fadeOut(250,function(){jQuery(this).remove()});b.callback&&b.callback()}).appendTo(d);b.confirm?f.addClass("evt-confirm-btn btn-confirm-yes"):b.cancel&&f.addClass("evt-cancel-btn btn-confirm-no")});f.appendTo("body")},x=function(a){g("DEFAULTS()");var b=localStorage[a];return b?JSON.parse(b):P[a]};(function(a){l=x("TWA DATA");v=x("TWA TRANSLATES");q=x("TWA TEMPLATES");I=jQuery("#serverDate");
J=jQuery("#serverTime");if(jQuery.isEmptyObject(l.units)){l.units={};l.settings={};var b=jQuery.get("interface.php?func=get_config"),f=jQuery.get("interface.php?func=get_unit_info"),d=jQuery.getJSON(w("mail&_partial")),c=jQuery.getJSON("http://relaxeaza.aws.af.cm/twa/translates.js?"+$.now()),e=jQuery.getJSON("http://relaxeaza.aws.af.cm/twa/templates.js?"+$.now());jQuery.when(b,f,d,c,e).then(function(b,c,d,e,f){H=d[0].game_data.csrf;v=e[0];q=f[0];jQuery("config > *",b[0]).each(function(a,b){4>a?l.settings[b.nodeName]=
jQuery(b).text():jQuery("*",b).each(function(){l.settings[this.nodeName]=Number(jQuery(this).text())})});jQuery("config > *",c[0]).each(function(){"militia"!==this.nodeName&&(l.units[this.nodeName]={speed:Math.round(24E3*Number(jQuery("speed",this).text())),carry:Number(jQuery("carry",this).text()),pop:Number(jQuery("pop",this).text())})});localStorage["TWA DATA"]=JSON.stringify(l);localStorage["TWA TRANSLATES"]=JSON.stringify(v);localStorage["TWA TEMPLATES"]=JSON.stringify(q);ba(function(){y=new y;
a()})})}else y=new y,jQuery.getJSON(w("mail&_partial"),function(b){h=v[l.configs.lang];H=b.game_data.csrf;a()})})(function(){X();Y();Z();aa()})})(!0);
