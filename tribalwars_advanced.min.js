(function(ha){if(document.getElementById("TWA_MENU"))return!1;var k,v,s,F=/^\d{1,3}\|\d{1,3}$/,R=/(.+)\s\((\d+)\|(\d+)\)\sK\d+$/,S=/\{lang\.([^\}]+)\}/g,T=/\{(\w+)\}/g,U=/\d+/,V=/\/([a-z]+)\.png/,M=/village=\d+/,W=/order=(\w+)/,K,G,H,B,g,N=[],X={"TWA DATA":{units:{},builds:{},settings:{},villages:{},configs:{lang:"en"},rev:2},"TWA AUTO_FARM MODELS":{"Farm #1":{units:{},coords:[],index:0}},"TWA COMMAND_PLANNER COMMANDS":[],"TWA COMMAND_PLANNER COMMANDS_SEND":[],"TWA AUTO_FARM ATTACK_LOG":[],"TWA AUTO_BUILD LEVELS":{main:20,
barracks:25,stable:20,garage:10,snob:1,smith:20,place:1,statue:1,market:10,wood:30,stone:30,iron:30,farm:30,storage:30,hide:0,wall:20},"TWA AUTO_BUILD ORDERS":5,"TWA TRANSLATES":{},"TWA TEMPLATES":{}},C=Number(document.cookie.match(/ref(\d+)\=/)[1]),Z=function(){function a(){h("COMMAND_PLANNER->PREPARE_ADD");var a=t.find("form").serializeArray(),b={};t.find(".TWA_UNITS").each(function(){this.disabled?b[this.name]=!0:0<this.value.length&&!isNaN(this.value)&&(b[this.name]=+this.value)});return[a[0].value,
a[1].value,a[2].value,"CMDPLANNER_SUPPORT"===a[3].name,b]}function c(a,b,d,c,e){h("COMMAND_PLANNER->ADD()");var m=d;h("FORMAT_TIMESTAMP()");m=m.split(" ");d=m[1].split("/");m=m[0];d=(new Date(d[1]+"/"+d[0]+"/"+d[2]+" "+m)).getTime();if(F.test(a))if(F.test(b)){if(d<D())return UI.ErrorMessage(g.command_planner.error_low_time);if($.isEmptyObject(e))return UI.ErrorMessage(g.command_planner.error_no_units)}else return UI.ErrorMessage(g.command_planner.error_coords_to);else return UI.ErrorMessage(g.command_planner.error_coords_from);
a=a.split("|");a[0]=+a[0];a[1]=+a[1];b=b.split("|");b[0]=+b[0];b[1]=+b[1];l.push({from:a,to:b,time:d,support:c,units:e});localStorage["TWA COMMAND_PLANNER COMMANDS"]=JSON.stringify(l);f()}function f(){h("COMMAND_PLANNER->UPDATE()");t.find(".TWA_COMMANDS")[l.length?"show":"hide"]();t.find(".TWA_COMMANDS_SEND")[r.length?"show":"hide"]();l=l.sort(function(a,b){return a.time-b.time});r=r.sort(function(a,b){return a.time-b.time});var a=t.find(".TWA_COMMANDS table"),c=t.find(".TWA_COMMANDS_SEND table"),
m,n;a.find("tr:not(:first)").remove();c.find("tr:not(:first)").remove();for(var p in l){m="";for(var g in k.units)n=l[p].units[g]||"0",m+='<td class="'+(0<+n?"":"hidden")+'">'+(!0===n?"x":n)+"</td>";a.append(u(s.command_planner.command,{from:l[p].from.join("|"),to:l[p].to.join("|"),time:L(l[p].time),type:'<img src="http://cdn.tribalwars.com.br/graphic/command/'+(l[p].support?"support":"attack")+'.png"/>',units:m,cmdi:p}))}for(p in r){m="";for(g in k.units)n=r[p].units[g]||"0",m+='<td class="'+(0<
+n?"":"hidden")+'">'+(!0===n?"x":n)+"</td>";c.append(u('<tr><td class="coord">{from}</td><td class="coord">{to}</td><td>{time}</td><td>{type}</td>{units}<td>{state}</td></tr>',{from:r[p].from.join("|"),to:r[p].to.join("|"),time:L(r[p].time),type:'<img src="http://cdn.tribalwars.com.br/graphic/command/'+(r[p].support?"support":"attack")+'.png"/>',units:m,state:r[p].state}))}t.find(".TWA_DEL").click(function(){var a=$(this).parent().parent().data("cmdi");d(a);f()});e();b(!0)}function e(a){h("COMMAND_PLANNER->UPDATE_COORDS_INFO()");
t.find(".coord").each(function(a,b){I(b.innerHTML,function(a){a.error?b.innerHTML=a.error+" ("+b.innerHTML+")":(b.innerHTML='<a href="'+w("info_village&id="+a.id)+'">'+a.name+"</a>",Y(b,u("{lang.command_planner.player}: <strong>{player}</strong>",{player:0==a.player?g.command_planner.abandoned:a.playerName})))})})}function d(a){h("COMMAND_PLANNER->REMOVE("+a+")");l=l.sort(function(a,b){return a.time-b.time});if(!0===a){a=D();for(var b=0;b<l.length;b++)a-5E3>l[b].time&&l.splice(b,1)}else l.splice(a,
1);A();return!1}function b(a){h("COMMAND_PLANNER->CHECK_IN()");var c=D(),e,p,n;for(n in m)clearTimeout(m[n]);for(n=0;l[n];){l[n].index=n;p=l[n++];if(!a&&c-5E3>p.time){a=(c-p.time)/1E3/60;O(u(g.command_planner.error_commands_late,{minutes:a}),[{text:g.command_planner.send,callback:function(){b(!0)}},{text:g.command_planner.cancel,callback:function(){d(!0);b(!0)}}]);break}e=p.time-c-7E3;2147483648>e&&(m[n]=setTimeout(function(){q(p)},e))}return!1}function q(a){h("COMMAND_PLANNER->PREPARE_COMMAND()");
var b=a.from.join("|"),d={x:a.to[0],y:a.to[1],template_id:""};d[a.support?"support":"attack"]=!0;E(a.from.join("|"),function(c){for(var m in a.units)d[m]=!0===a.units[m]?c[m]:a.units[m];I(b,function(b){J(a,d,b.id)})})}function J(a,b,c){h("COMMAND_PLANNER->SEND( "+JSON.strigify(a)+" )");$.post(w("place&try=confirm",c),b,function(b){var c=$(".error_box",b);if(c=c.text())return c=$.trim(c),a.state=c,r.push(a),d(a.index),A(),f(),h("COMMAND_PLANNER ERROR: "+c);var m=$("form",b);b=a.time-
D();setTimeout(function(){$.post(m[0].action,m.serialize(),function(){a.state=g.command_planner.sended;r.push(a);d(a.index);A();f();h("COMMAND_PLANNER: "+g.command_planner.success)})},b)})}function A(){h("COMMAND_PLANNER->SAVE()");localStorage["TWA COMMAND_PLANNER COMMANDS_SEND"]=JSON.stringify(r);localStorage["TWA COMMAND_PLANNER COMMANDS"]=JSON.stringify(l)}h("COMMAND_PLANNER()");var l=x("TWA COMMAND_PLANNER COMMANDS"),r=x("TWA COMMAND_PLANNER COMMANDS_SEND"),m={},n="",p="";$.each([["spear",
"sword","axe","archer"],["spy","heavy","light","marcher"],["ram","catapult"],["knight","snob"]],function(){n+='<td valign="top">';$.each(this,function(a,b){k.units[b]&&(n+='<span><img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+b+'.png"/> <input name="'+b+'" class="TWA_UNITS" type="text" style="width:40px"> <input class="TWA_ALL" type="checkbox"></span>',p+='<th><img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+b+'.png"/></th>')});n+="</td>"});var t=y.createApp(g.command_planner.command_planner,
s.command_planner.html,{inputs:n,header:p});t.find("input[type=button]").click(function(){c.apply(window,a())});t.find("form").keypress(function(b){27===b.keyCode&&c.apply(window,a())});t.find(".TWA_CURRENT").click(function(){$("[name=CMDPLANNER_FROM]").val(game_data.village.coord);return!1});t.find(".TWA_ALL").click(function(){var a=$(this);if(!this.checked)return a.prev().prop("disabled",!1).val("");var b=$("[name=CMDPLANNER_FROM]").val();if(F.test(b)){var d=a.prev().prop("disabled",
!0);E(b,function(a){d.val(a[d.attr("name")])},function(){UI.InfoMessage(g.command_planner.error_coord_own);d.prop("disabled",!1);a.prop("checked",!1)})}else a.prop("checked",!1),UI.InfoMessage(g.command_planner.error_coords_from);return!0});t.find(".TWA_EMPTY_SENDED").click(function(){localStorage.removeItem("TWA COMMAND_PLANNER COMMANDS_SEND");f();return!1});$.getScript("http://relaxeaza.aws.af.cm/TWA/jquery.datetimepicker.js",function(){t.find("[name=CMDPLANNER_TIME]").datetimepicker({value:L(D()),
format:"H:i:s d/m/Y",formatDate:"d/m/Y",formatTime:"H:i",minDate:0,step:5})});b();f();return!1},aa=function(){function a(){h("AUTO_FARM->UPDATE()");l.find(".TWA_MODEL").remove();var a=$("#TWA_AUTO_FARM .TWA_MODELS"),b,c;for(c in d){q[c]||(q[c]=new e(c));b="";for(var f in k.units)b+='<td><input type="text" class="TWA_UNITSINPUT" name="'+f+'" value="'+(d[c].units[f]||0)+'"/></td>';a.append(u(s.auto_farm.model,{mid:c,header:A,inputs:b,coords:d[c].coords.join(" "),checked:d[c].stopNoUnits?" checked":
""}))}for(c in q)q[c].paused||l.find('[data-mid="'+c+'"] .TWA_START').addClass("start").val(g.auto_farm.pause)}function c(a,c,d,e){h("AUTO_FARM->ADD_LOG");e=G.text()+" "+H.text();a=a.x+"|"+a.y;b.push({mid:d,time:e,units:c,coords:a});localStorage["TWA AUTO_FARM ATTACK_LOG"]=JSON.stringify(b);var f="";$.each(c,function(a,b){parseInt(b,10)&&(f+='<img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+a+'.png"/> '+b)});$("#TWA_ATTACK_LOG tbody").prepend(u("<tr><td>{time}</td><td>{units}</td><td>{coords}</td><td>{mid}</td></tr>",
{time:e,units:f,coords:a,mid:d}));$("#TWA_ATTACK_LOG").show()}function f(){h("AUTO_FARM->SAVE()");localStorage["TWA AUTO_FARM MODELS"]=JSON.stringify(d)}function e(a){h("AUTO_FARM->Autofarm( "+a+" )");this.mid=a;this.data=d[a];this.paused=!0;return this}h("AUTO_FARM()");var d=x("TWA AUTO_FARM MODELS"),b=x("TWA AUTO_FARM ATTACK_LOG"),q={},J={},A="";$.get(w("place"),function(a){a=$("#units_form input:first",a)[0];J[a.name]=a.value});var l=y.createApp(g.auto_farm.auto_farm,s.auto_farm.html),
r;for(r in k.units)A+='<th><img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+r+'.png"/></th>';l.find(".TWA_ADDMODEL").click(function(){var b=$("[name=TWA_MODELNAME]").val();if(d[b])return UI.ErrorMessage(g.auto_farm.error_already_exists);if(3>b.length)return UI.ErrorMessage(g.auto_farm.error_min_name);d[b]={units:{},coords:[],index:0,stopNoUnits:!1};f();a();UI.SuccessMessage(u(g.auto_farm.model_created,{name:b}));return!1});l.find("[name=TWA_MODELNAME]").keypress(function(a){if(13===
a.keyCode)return l.find(".TWA_ADDMODEL").trigger("click"),!1});$(document).on("click",".TWA_SAVE",function(){var b=$(this).parent().data("mid"),c=$('form[id="'+b+'"]').serializeArray();d[b].stopNoUnits=!1;for(var e=0;e<c.length;e++)switch(c[e].name){default:d[b].units[c[e].name]="x"===c[e].value?"x":+c[e].value;break;case "coords":d[b].coords=$.trim(c[e].value).split(/\s+/);break;case "stop_no_units":d[b].stopNoUnits=!0}f();a();UI.SuccessMessage(u(g.auto_farm.model_saved,{name:name}))}).on("click",
".TWA_START",function(){var a=$(this),b=a.parent().data("mid");if(a.hasClass("paused")||"TWA_START"===this.className){if(q[b].check())return q[b].start(),a.removeClass("paused").addClass("start").val(g.auto_farm.pause)}else if(a.hasClass("start"))return q[b].pause(),a.removeClass("start").addClass("paused").val(g.auto_farm.start);return!1}).on("click",".TWA_REMOVE",function(){var b=$(this).parent().data("mid");O(g.auto_farm.remove_confirm,[{text:g.auto_farm.remove,callback:function(){delete d[b];
q[b].paused||q[b].pause();UI.SuccessMessage(u(g.auto_farm.model_removed,{name:b}));f();a()}}]);return!1}).on("click",".TWA_EMPTY_LOG",function(){localStorage.removeItem("TWA AUTO_FARM ATTACK_LOG");$("#TWA_ATTACK_LOG").hide().empty()});0<b.length&&$("#TWA_ATTACK_LOG").show();$.each(b,function(){var a="";$.each(this.units,function(b,c){parseInt(c,10)&&(a+='<img src="http://cdn.tribalwars.com.br/graphic/unit/unit_'+b+'.png"/> '+c)});$("#TWA_ATTACK_LOG tbody").prepend(u("<tr><td>{time}</td><td>{units}</td><td>{coords}</td><td>{mid}</td></tr>",
{time:this.time,units:a,coords:this.coords,mid:this.mid}))});e.prototype.start=function(){h("AUTO_FARM->START( "+this.mid+" )");return this.paused?(this.paused=!1,this.next()):this};e.prototype.pause=function(){h("AUTO_FARM->PAUSE( "+this.mid+" )");this.paused||(this.paused=!0);return this};e.prototype.check=function(){h("AUTO_FARM->CHECK( "+this.mid+" )");if(!this.data.coords.length)return UI.ErrorMessage(g.auto_farm.error_no_coords),!1;for(var a in this.data.units)if("x"===this.data.units[a]||0<
Number(this.data.units[a]))return!0;UI.ErrorMessage(g.auto_farm.error_no_units);return!1};e.prototype.next=function(){h("AUTO_FARM->NEXT( "+this.mid+" )");++this.data.index>=this.data.coords.length&&(this.data.index=0);this.prepare(this.data.coords[this.data.index].split("|"));f();return this};e.prototype.prepare=function(a){h("AUTO_FARM->PREPARE( "+a+", "+this.mid+" )");if(this.paused)return this;h("AUTO_FARM->PREPARE(%i)",a.join("|"));var b=this,c=[],d={x:a[0],y:a[1],attack:!0,template_id:""};$.extend(d,
J);$.extend(d,b.data.units);for(var e in this.data.units)"x"===this.data.units[e]&&c.push(e);return c.length?E(game_data.village.id,function(a){for(var e=0;e<c.length;e++)d[c[e]]=a[c[e]];b.send(d)}):b.send(d)};e.prototype.send=function(a){h("AUTO_FARM->SEND( "+this.mid+" )");var b=this;$.post(w("place&try=confirm"),a,function(d){var e=$(".error_box",d);if(e=e.text()){var e=$.trim(e),f={};E(d,function(a){for(var c in b.data.units){var d=Number(b.data.units[c]);0!==d&&"x"!==b.data.units[c]&&
a[c]<d&&(f[c]=d-a[c])}$.isEmptyObject(f)||P(game_data.village.id,function(a){if(!1===a){if(b.stopNoUnits)return!1;a=6E4-137.5*k.settings.speed}setTimeout(function(){b.prepare(b.data.coords[b.data.index].split("|"))},a)})});c(a,b.data.units,b.mid,e);return h("AUTO_FARM ERROR: "+e)}d=$("form",d);$.post(d[0].action,d.serialize(),function(){c(a,b.data.units,b.mid,g.auto_farm.attack_sended);b.next()})});return this};a(!0)},ba=function(){h("AUTO_BUILD()");var a="main barracks stable garage snob smith place statue market wood stone iron farm storage hide wall".split(" "),
c='<th><img src="http://cdn.tribalwars.com.br/graphic/buildings/'+a.join('.png"/></th><th><img src="http://cdn.tribalwars.com.br/graphic/buildings/')+'.png"></th>',f='<tr><td><input type="text" name="'+a.join('"/></td><td><input type="text" name="')+'"></td></tr>',e=y.createApp(g.auto_build.auto_build,s.auto_build.html,{thead:c,tbody:f}),d=x("TWA AUTO_BUILD LEVELS"),b=x("TWA AUTO_BUILD ORDERS");$.each(a,function(a,b){e.find("[name="+b+"]").val(d[b])});e.find("[name=max_orders]").val(b);e.find("input").change(function(){"max_orders"===
this.name?localStorage["TWA AUTO_BUILD ORDERS"]=b=this.value:(d[this.name]=this.value,localStorage["TWA AUTO_BUILD LEVELS"]=JSON.stringify(d))});if(document.getElementById("overview")&&"buildings"===document.getElementById("overview").value){!1===BuildingOverview._display_type&&BuildingOverview.show_all_upgrade_buildings();$("#buildings_table tr:first th:has(img[src*=buildings]) a").click(function(){var a=$("img",this)[0].src.match(V)[1];return q(a,BuildingOverview._display_type)});var q=
function(a,c){var e=$("#upgrade_building_link").val(),f=$("#downgrade_building_link").val(),g=d[c?1:0][a],h=c?"red":"green";b=c?5:b;$("#buildings_table tr:not(:first)").each(function(){var b=this.className.match(U)[0],d=BuildingOverview._upgrade_villages[b];if(c?d.can_destroy:d.buildings[a])for(var d=$("td:last li:has(.order-status-light[style*="+h+']) img[src*="'+a+'.png"]',this).length,d=parseInt($(".b_"+a,this).text(),10)+d,q=$("td:last li:has(.order-status-light[style*="+
h+"])",this).length;q<max;q++)(c?d-- >g:d++<g)&&$.ajax({url:(c?f:e).replace(M,"village="+b),data:{id:a,source:b,force:1},async:!1,dataType:"json",success:function(a){if(a.success){if(!$("#building_order_"+b).length){var c=$('<ul class="order_queue" id="building_order_'+b+'"></ul>');BuildingOverview.create_sortable(c);$("#v_"+b+" td:last-child").append(c)}$("#building_order_"+b).html(a.building_orders)}}})});return!1}}},ca=function(){h("AUTO_RESEARCH()");if(document.getElementById("overview")&&
"tech"===document.getElementById("overview").value){$("#techs_table tr:first a:has(img)").click(function(){return a(this.href.match(W)[1])});var a=function(a){$("#techs_table tr").each(function(){var f=this.id.split("_")[1];document.getElementById(f+"_"+a)&&$.ajax({type:"post",url:TechOverview.urls.ajax_research_link.replace(M,"village="+f),data:{tech_id:a},dataType:"json",vid:f,success:function(e){e.success&&($("#village_tech_order_"+this.vid).html(e.tech_order),TechOverview.change_dot($("#"+
this.vid+"_"+a),this.vid,a,"brown"),game_data.village.id==this.vid&&($("#wood").html(e.resources[0]),$("#stone").html(e.resources[1]),$("#iron").html(e.resources[2]),startTimer()))}})});return!1}}},da=function(){function a(){$.getJSON("http://relaxeaza.aws.af.cm/TWA/forum.php?action=get_topics&uid="+game_data.market+C,function(a){a.register?b.find("#TWA_FORUM_REGISTER").show().find(":submit").click(function(){var a=b.find("#TWA_FORUM_REGISTER :text").val();if(3>a.length||15<a.length)return UI.ErrorMessage(g.forum.error_nick_size);
$.post("http://relaxeaza.aws.af.cm/TWA/forum.php?action=register",{uid:game_data.market+C,nick:a},function(a){a.error?"Used Username"==a.error?UI.ErrorMessage(g.forum.error_used_username):UI.ErrorMessage(g.forum.error_register):(b.find("#TWA_FORUM_REGISTER").hide(),b.find("#TWA_FORUM_CENTER, #TWA_FORUM_TOPICS, #TWA_FORUM > header").show())},"json")}):b.find("#TWA_FORUM_CENTER, #TWA_FORUM_TOPICS, #TWA_FORUM > header").show();a.html&&(b.find("#TWA_FORUM_TOPICS tbody").html(a.html),c());b.find("#TWA_FORUM_BACK").click(function(){b.find("#TWA_TOPIC_CONTENT, #TWA_FORUM_BACK, #TWA_FORUM_POST_ANSWER, #TWA_FORUM_TOPIC_DELETE, #TWA_ANSWER_AREA, #TWA_CREATE_TOPIC_AREA").hide();
b.find("#TWA_FORUM_ANSWER_CONTENT, #TWA_FORUM_TOPIC_SUBJECT").val("");b.find("#TWA_FORUM_TOPICS, #TWA_FORUM_TOPIC_CREATE").show();d=!1});b.find("#TWA_FORUM_TOPIC_CREATE").click(function(){b.find("#TWA_FORUM_TOPICS, #TWA_FORUM_TOPIC_CREATE").hide();b.find("#TWA_CREATE_TOPIC_AREA, #TWA_ANSWER_AREA, #TWA_FORUM_BACK").show()});b.find("#TWA_FORUM_POST_ANSWER").click(function(){b.find("#TWA_FORUM_POST_ANSWER, #TWA_CREATE_TOPIC_AREA").hide();b.find("#TWA_ANSWER_AREA").show();b.find("#TWA_FORUM_ANSWER_CONTENT").focus()});
b.find("#TWA_FORUM_DO_POST").click(function(){!1===d?e():f();b.find("#TWA_FORUM_ANSWER_CONTENT, #TWA_FORUM_TOPIC_SUBJECT").val("");b.find("#TWA_CREATE_TOPIC_AREA, #TWA_ANSWER_AREA").hide();b.find("#TWA_FORUM_POST_ANSWER").show()})})}function c(){b.find("#TWA_FORUM_TOPICS .TWA_TOPIC_SUBJECT a").unbind("click").click(function(){d=Number($(this).parent().parent().attr("tid"));$.getJSON("http://relaxeaza.aws.af.cm/TWA/forum.php?action=get_topic_content&topic_id="+d,function(a){b.find("#TWA_TOPIC_CONTENT").html(a.html).show();
b.find("#TWA_FORUM_BACK, #TWA_FORUM_POST_ANSWER").show();b.find("#TWA_FORUM_TOPICS, #TWA_FORUM_TOPIC_CREATE").hide();a.uid==game_data.market+C&&b.find("#TWA_FORUM_TOPIC_DELETE").show()});return!1})}function f(){var a=b.find("#TWA_FORUM_ANSWER_CONTENT").val();2E3<a.length&&UI.ErrorMessage(g.forum.error_large_text);$.post("http://relaxeaza.aws.af.cm/TWA/forum.php?action=create_post",{tid:d,text:a,uid:game_data.market+C,time:Q()},function(a){a.error&&("Limit Post Time"===a.error?UI.ErrorMessage(g.forum.error_limit_post):
UI.ErrorMessage(g.forum.error_create_post));b.find("#TWA_TOPIC_CONTENT table").append(a.html)},"json")}function e(){var a=b.find("#TWA_FORUM_TOPIC_SUBJECT").val(),d=b.find("#TWA_FORUM_ANSWER_CONTENT").val();60<a.length?UI.ErrorMessage(g.forum.error_large_subject):2E3<d.length&&UI.ErrorMessage(g.forum.error_large_text);$.post("http://relaxeaza.aws.af.cm/TWA/forum.php?action=create_topic",{subject:a,text:d,uid:game_data.market+C,time:Q()},function(a){a.error&&("Limit Post Time"===a.error?UI.ErrorMessage(g.forum.error_limit_post):
UI.ErrorMessage(g.forum.error_create_topic));b.find("#TWA_FORUM_TOPICS tbody").append(a.topic_list_html);b.find("#TWA_TOPIC_CONTENT").html(a.topic_content_html).show();b.find("#TWA_FORUM_BACK, #TWA_FORUM_POST_ANSWER, #TWA_FORUM_TOPIC_DELETE").show();b.find("#TWA_FORUM_TOPICS, #TWA_FORUM_TOPIC_CREATE").hide();c()},"json")}h("FORUM()");var d=!1,b=y.createApp(g.forum.forum,s.forum.html,"",function(){a()})},ea=function(){var a="",c="",f;for(f in v)c+='<option value="'+f+'"'+(k.configs.lang===f?" selected":
"")+">"+v[f].lang_name+"</option>";$.each([{name:g.configs.lang,value:u('<select name="lang">{0}</select>',[c]),desc:g.configs.lang_desc}],function(){a+=u('<tr><td>{name}</td><td class="TWA_CONFIGS_VALUE">{value}</td><td>{desc}</td></tr>',this)});c=y.createApp(g.configs.configs,s.configs.html,{configs:a});c.find(".TWA_CONFIGS_VALUE :input").change(function(){k.configs[this.name]=this.value;localStorage["TWA DATA"]=JSON.stringify(k);"lang"===this.name&&UI.InfoMessage(g.configs.lang_changed,3500)});
c.find(".TWA_FEEDBACK a").click(function(){var a=$("#TWA_FEEDBACK_MODEL").show().animate({bottom:100},500),c=a.find("textarea");a.find("input:first").click(function(){if(10>c.val().length)return!1;$.post("http://relaxeaza.aws.af.cm/TWA/feedback.php",{message:c.val(),player:game_data.player.id,world:game_data.world,logHistory:JSON.stringify(N)},function(a){UI.SuccessMessage(g.configs.feedback_success)});a.hide()});a.find("input:last").click(function(){a.hide()});return!1})},y=function(){h("INTERFACE()");
var a={};z("body",s.twa.tooltip);z("#menu_row2",s.twa.icon);z("body",s.twa.background);B=$("#TWA_TOOLTIP");var c=$("#TWA_BG"),f=$("#TWA_MENU");$(document).keydown(function(a){27===a.keyCode&&c.hide()}).mousemove(function(a){B[0].style.top=a.pageY-20+"px";B[0].style.left=a.pageX+12+"px"});$("#TWA_ICON").click(function(){f.stop().slideToggle(100)});var e=function(d,b,e,g){this.id=d;this.content=a[d]=z(c,"<div/>").append(u(b,e));z(f,'<li><a href="#">\u00bb '+d+"</a></li>").click(function(){g&&
(g(),g=!1);c.show();f.hide();for(var b in a)a[b].hide();a[d].show();return!1});z(a[d],s.twa.window_close).click(function(){c.hide();a[d].hide()});return this};e.prototype.find=function(a){return this.content.find(a)};this.createApp=function(a,b,c,f){return new e(a,b,c,f)};return this},fa=function(a){h("SET_LANG()");var c=z("body",u(s.set_lang.html,{lang_select:v.en.lang_select})).animate({bottom:100},500),f="br"===game_data.market?"pt":game_data.market,e=c.find("select").change(function(){c.find("p").text(v[this.value].lang_select)}),
d,b,q;for(q in v)d=z(e,'<option value="'+q+'">'+v[q].lang_name+"</option>"),v[f]&&(d.prop("selected",!0),b=!0);b||e.find("option[value=en]").prop("selected",!0);c.find("input").click(function(){k.configs.lang=e.val();g=v[k.configs.lang];c.remove();localStorage["TWA DATA"]=JSON.stringify(k);a()})},h=function(a,c){N.push(a);c||console.log(a);return!1},z=function(a,c,f){h("HTML()");f=f||"appendTo";return $(c)[f](a)},w=function(a,c){h("URL()");return game_data.link_base_pure.replace(/village=\d+/,
"village="+(c||game_data.village.id))+(a||"")},L=function(a){h("TIMESTAMP_FORMAT()");var c=new Date(a);a=c.getHours();var f=c.getMinutes(),e=c.getSeconds(),d=c.getDate(),b=c.getMonth()+1,c=c.getFullYear();return(10>a?"0"+a:a)+":"+(10>f?"0"+f:f)+":"+(10>e?"0"+e:e)+" "+(10>d?"0"+d:d)+"/"+(10>b?"0"+b:b)+"/"+c},D=function(){h("CURRENT_TIME()");var a=G.text().split("/");return(new Date(a[1]+"/"+a[0]+"/"+a[2]+" "+H.text())).getTime()},Q=function(){h("CURRENT_TIME_STR()");return G.text()+" "+H.text()},u=
function(a,c){h("FORMAT()");a=a.replace(S,function(a,c){var d=g;if(/\./.test(c)){c=c.split(".");for(var b=0;b<c.length;b++)d=d[c[b]]}else d=d[c];return d});c&&(a=a.replace(T,function(a,e){isNaN(e)||(e=Number(e));return e in c?c[e]:a}));return a},I=function(a,c){h("GET_VILLAGE_INFO()");if(k.villages[a])return c?c(k.villages[a]):k.villages[a];k.villages[a]=!1;return $.post(w("mail")+"&mode=new&action=send&h="+K,{extended:0,preview:1,to:game_data.player.name,subject:"0",text:"[coord]"+a+"[/coord]"},
function(f){var e=$("table[width=590px]",f),d=e.find("a:first");if(d.length){f=d.text().match(R);var b=e.find("span").data();b.name=d.text();b.coords=[Number(f[2]),Number(f[3])];return $.get(w("info_village&id="+b.id),function(d){b.playerName=$("#content_value a[href*=info_player]",d).text();k.villages[a]=b;localStorage["TWA DATA"]=JSON.stringify(k);c(b,a)})}k.villages[a]={error:$("table[width=590px] td",f).text().trim()};localStorage["TWA DATA"]=JSON.stringify(k);c(k.villages[a],
a)})},E=function(a,c,f){function e(a){var b={};$(".unitsInput",a).each(function(){b[this.name]=Number(this.nextSibling.nextSibling.innerHTML.match(/\d+/)[0])});c(b)}h("GET_VILLAGE_UNITS()");return isNaN(a)?8<a.length?e(a):I(a,function(a){ga(a.id,function(){E(a.id,c)},f)}):$.get(w("place",a),e)},P=function(a,c){function f(a){var d=$("#show_outgoing_units tr:not(:first)",a),b=d.has('img[src*="return.png"]');a=1;if(b.length)d=b.eq(0);else if(d.length)d=d.eq(0),a=2;else return c(!1);d=
$(".timer",d).text().split(":");d=(36E8*d[0]+6E4*d[1]+1E3*d[2])*a;c(d+2E3)}h("GET_COMMAND_TIME()");return"string"===typeof a?(F.test(a)?I(a,function(a){P(a.id,c)}):f(a),!1):$.getJSON(w("overview&_partial",a),function(a){f(a.content)})},ga=function(a,c,f){h("TIMESTAMP_FORMAT()");return $.getJSON(w("wood&_partial",a),function(e){e.game_data.village.id==a?c&&c():f&&f()})},Y=function(a,c){h("TOOLTIP()");$(a).each(function(){$(this).hover(function(){B.html("function"===typeof c?
c.call(this):c).show()},function(){B.hide()})})},O=function(a,c){h("CONFIRM()");var f=$('<div id="fader" style="z-index:14999"><div class="confirmation-box" role="dialog"><div><p id="confirmation-msg" class="confirmation-msg">'+a+'</p><div class="confirmation-buttons"></div></div></div></div>'),e=f.find(".confirmation-buttons");$.each(c,function(a,b){var c=$('<button class="btn btn-default" aria-label"'+b.text+'">'+b.text+"</button>").click(function(){$("#fader").fadeOut(250,function(){$(this).remove()});
b.callback&&b.callback()}).appendTo(e);b.confirm?c.addClass("evt-confirm-btn btn-confirm-yes"):b.cancel&&c.addClass("evt-cancel-btn btn-confirm-no")});f.appendTo("body")},x=function(a){h("DEFAULTS()");var c=localStorage[a];return c?JSON.parse(c):X[a]};(function(a){k=x("TWA DATA");v=x("TWA TRANSLATES");s=x("TWA TEMPLATES");G=$("#serverDate");H=$("#serverTime");$("head").append('<link rel="stylesheet" type="text/css" href="http://relaxeaza.aws.af.cm/TWA/styles.css"/><link>');if($.isEmptyObject(k.units)){k.units=
{};k.settings={};var c=$.get("interface.php?func=get_config"),f=$.get("interface.php?func=get_unit_info"),e=$.getJSON(w("mail&_partial")),d=$.getJSON("http://relaxeaza.aws.af.cm/TWA/translates.js?"+$.now()),b=$.getJSON("http://relaxeaza.aws.af.cm/TWA/templates.js?"+$.now());$.when(c,f,e,d,b).then(function(b,c,d,e,f){K=d[0].game_data.csrf;v=e[0];s=f[0];$("config > *",b[0]).each(function(a,b){4>a?k.settings[b.nodeName]=$(b).text():$("*",b).each(function(){k.settings[this.nodeName]=
Number($(this).text())})});$("config > *",c[0]).each(function(){"militia"!==this.nodeName&&(k.units[this.nodeName]={speed:Math.round(24E3*Number($("speed",this).text())),carry:Number($("carry",this).text()),pop:Number($("pop",this).text())})});localStorage["TWA DATA"]=JSON.stringify(k);localStorage["TWA TRANSLATES"]=JSON.stringify(v);localStorage["TWA TEMPLATES"]=JSON.stringify(s);fa(function(){y=new y;a()})})}else y=new y,$.getJSON(w("mail&_partial"),function(b){g=v[k.configs.lang];
K=b.game_data.csrf;a()})})(function(){Z();aa();ba();ca();ea();da()})})(!0);